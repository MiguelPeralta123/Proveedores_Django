{% extends 'base.html' %}

{% block content %}
  <main class="pt-5 m-5">
    <div class="row mt-5 justify-content-center">
      <div style="max-width: 40rem;">
        <form class="card card-body" method="POST" enctype="multipart/form-data" style="background-color: rgb(255, 255, 255, 0.8);">
          
          {% if current_user.puede_crear_proveedor %}
            <h1 class="mb-4">Registrar proveedor</h1>
          {% endif %}

          {% if current_user.puede_crear_cliente %}
            <h1 class="mb-4">Registrar cliente</h1>
          {% endif %}

          {{ error }}

          {% csrf_token %}

          <!-- Es migracion field -->
          <div style="margin-bottom:1rem;">
            <p><b>En caso de que el registro ya exista en otra empresa, marque la siguiente casilla:</b></p>
            <label for="id_es_migracion">Es migración:</label>
            {{ form.es_migracion }}
            <p id="error-es-migracion" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Seleccione una opción válida</p>
          </div>

          <!-- Proveedor migración fields -->
          <div id="proveedor-migracion-fields" style="display: none;">

            <h6>Si desea migrar un cliente/proveedor que está en Datamine, debe conseguir la constancia de situación fiscal y el estado de cuenta bancario actualizados y <b>solicitarlo como un cliente/proveedor nuevo</b></h6>

            <div id="proveedor-migracion-empresas" style="display: flex; gap: 1rem;">
              <!-- Empresa origen -->
              <div style="width: 100%;">
                <p class="m-0">{{ form.empresa_origen.label_tag }}<span style="color: rgb(192, 0, 0);">*</span></p>
                {{ form.empresa_origen }}
                <p id="error-empresa-origen" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Seleccione una opción válida</p>
              </div>

              <!-- Empresa destino -->
              <div style="width: 100%;">
                <p class="m-0">{{ form.empresa_destino.label_tag }}<span style="color: rgb(192, 0, 0);">*</span></p>
                {{ form.empresa_destino }}
                <p id="error-empresa-destino" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Seleccione una opción válida</p>
              </div>
            </div>

            <p id="error-empresas-migracion" class="mt-0 mb-2" style="color:red; display:none;">Empresa origen y Empresa destino deben tener valores distintos</p>

            <!-- RFC migracion field -->
            <div class="mt-3 mb-3">
              <label for="id_rfc_migracion">RFC:<span style="color: rgb(192, 0, 0);">*</span></label>
              {{ form.rfc_migracion }}
              <datalist id="opciones_proveedor">
              </datalist>
              <p id="error-rfc-migracion" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Ingrese un RFC válido</p>
              {% if current_user.puede_crear_proveedor %}
                <p id="error-rfc-migracion-2" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">No existe ningún proveedor con ese RFC</p>
              {% endif %}
              {% if current_user.puede_crear_cliente %}
                <p id="error-rfc-migracion-2" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">No existe ningún cliente con ese RFC</p>
              {% endif %}
            </div>
          </div>

          <!-- Proveedor nuevo fields -->
          <div id="proveedor-nuevo-fields" style="display: block;">

            <!-- Empresa field -->
            <div style="margin-bottom:1rem;">
              <p class="m-0">{{ form.empresa.label_tag }}<span style="color: rgb(192, 0, 0);">*</span></p>
              {{ form.empresa }}
              <p id="error-empresa" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Seleccione una opción válida</p>
            </div>

            <div style="display: flex; gap: 1rem;">
              <!-- Tipo alta field -->
              <div style="width: 100%; margin-bottom:1rem;">
                <p class="m-0">{{ form.tipo_alta.label_tag }}<span style="color: rgb(192, 0, 0);">*</span></p>
                {{ form.tipo_alta }}
                <p id="error-tipo-alta" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Seleccione una opción válida</p>
              </div>

              <!-- Contribuyente field -->
              <div style="width: 100%; margin-bottom:1rem;">
                <p class="m-0">{{ form.contribuyente.label_tag }}<span style="color: rgb(192, 0, 0);">*</span></p>
                {{ form.contribuyente }}
                <p id="error-contribuyente" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Seleccione una opción válida</p>
              </div>
            </div>

            <div style="display: flex; gap: 1rem;">
              <!-- RFC field -->
              <div style="width: 100%; margin-bottom:1rem;">
                <label for="id_rfc">RFC:<span style="color: rgb(192, 0, 0);">*</span></label>
                {{ form.rfc }}
                <datalist id="opciones_proveedor">
                </datalist>
                <p id="error-rfc" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Ingrese un RFC válido</p>
                {% if current_user.puede_crear_proveedor %}
                  <p id="error-rfc-2" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Ya existe un proveedor con ese RFC</p>
                {% endif %}
                {% if current_user.puede_crear_cliente %}
                  <p id="error-rfc-2" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Ya existe un cliente con ese RFC</p>
                {% endif %}
              </div>

              <!-- CURP field -->
              <div style="width: 100%; margin-bottom:1rem;">
                <label for="id_curp">CURP:</label>
                {{ form.curp }}
                <p id="error-curp" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Ingrese una CURP válida</p>
              </div>
            </div>

            <!-- Nombre fiscal field -->
            <div style="margin-bottom:1rem;">
              <p class="m-0">{{ form.nombre_fiscal.label_tag }}<span style="color: rgb(192, 0, 0);">*</span> <span style="font-size: 0.8rem; font-style: italic;">(No se permiten acentos, carácteres especiales ni ñ)</span></p>
              {{ form.nombre_fiscal }}
              <p id="error-nombre-fiscal" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Este campo es requerido</p>
              <p id="error-nombre-fiscal-2" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Nombre fiscal no puede contener acentos, carácteres especiales ni ñ</p>
            </div>

            <!-- Regimen de capital field -->
            <div style="margin-bottom:1rem;">
              <label for="id_regimen_capital">Régimen de capital:<span style="color: rgb(192, 0, 0);">*</span></label>
              {{ form.regimen_capital }}
              <p id="error-regimen-capital" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Seleccione una opción válida</p>
            </div>

            <!-- Nombre comercial field -->
            <div style="margin-bottom:1rem;">
              <p class="m-0">{{ form.nombre_comercial.label_tag }}<span style="color: rgb(192, 0, 0);">*</span> <span style="font-size: 0.8rem; font-style: italic;">(No se permiten acentos, carácteres especiales ni ñ)</span></p>
              {{ form.nombre_comercial }}
              <p id="error-nombre-comercial" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Este campo es requerido</p>
              <p id="error-nombre-comercial-2" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Nombre comercial no puede contener acentos, carácteres especiales ni ñ</p>
            </div>

            <!-- Regimen fiscal field -->
            <div style="margin-bottom:1rem;">
              <label for="id_regimen_fiscal">Régimen fiscal:<span style="color: rgb(192, 0, 0);">*</span></label>
              {{ form.regimen_fiscal }}
              <p id="error-regimen-fiscal" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Seleccione una opción válida</p>
            </div>

            <!-- Uso cfdi field -->
            <div style="margin-bottom:1rem;">
              <label for="id_uso_cfdi">Uso CFDI:<span style="color: rgb(192, 0, 0);">*</span></label>
              {{ form.uso_cfdi }}
              <p id="error-uso-cfdi" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Seleccione una opción válida</p>
            </div>

            <div style="display: flex; gap: 1rem;">
              <!-- Telefono 1 field -->
              <div style="width: 100%; margin-bottom:1rem;">
                <label for="id_telefono_1">Teléfono 1:<span style="color: rgb(192, 0, 0);">*</span></label>
                {{ form.telefono_1 }}
                <p id="error-telefono-1" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Ingrese un número telefónico válido</p>
              </div>

              <!-- Telefono 2 field -->
              <div style="width: 100%; margin-bottom:1rem;">
                <label for="id_telefono_2">Teléfono 2:</label>
                {{ form.telefono_2 }}
                <p id="error-telefono-2" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Ingrese un número telefónico válido</p>
              </div>
            </div>

            <div style="display: flex; gap: 1rem;">
              <!-- Representante legal field -->
              <div style="width: 100%; margin-bottom:1rem;">
                {{ form.representante_legal.label_tag }}
                {{ form.representante_legal }}
                <p id="error-representante-legal" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Este campo es requerido</p>
              </div>

              <!-- Contacto field -->
              <div style="width: 100%; margin-bottom:1rem;">
                {{ form.contacto.label_tag }}
                {{ form.contacto }}
                <p id="error-contacto" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Este campo es requerido</p>
              </div>
            </div>

            <div style="display: flex; gap: 1rem;">
              <!-- Correo general field -->
              <div style="width: 100%; margin-bottom:1rem;">
                <p class="m-0">{{ form.correo_general.label_tag }}<span style="color: rgb(192, 0, 0);">*</span></p>
                {{ form.correo_general }}
                <p id="error-correo-general" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Ingrese un correo electrónico válido</p>
              </div>

              <!-- Correo pagos field -->
              <div style="width: 100%; margin-bottom:1rem;">
                <p class="m-0">{{ form.correo_pagos.label_tag }}<span style="color: rgb(192, 0, 0);">*</span></p>
                {{ form.correo_pagos }}
                <p id="error-correo-pagos" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Ingrese un correo electrónico válido</p>
              </div>
            </div>

            <div style="display: flex; gap: 1rem;">
              <!-- Sitio web field -->
              <div style="width: 100%; margin-bottom:1rem;">
                {{ form.sitio_web.label_tag }}
                {{ form.sitio_web }}
                <p id="error-sitio-web" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Este campo es requerido</p>
              </div>

              <!-- Rubro field -->
              <div style="width: 100%; margin-bottom:1rem;">
                <label for="id_rubro">Grupo / Rubro:<span style="color: rgb(192, 0, 0);">*</span></label>
                {{ form.rubro }}
                <p id="error-rubro" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Seleccione una opción válida</p>
              </div>
            </div>

            <div style="display: flex; gap: 1rem;">
              <!-- Tipo operacion field -->
              <div style="width: 100%; margin-bottom:1rem;">
                <label for="id_tipo_operacion">Tipo operación:<span style="color: rgb(192, 0, 0);">*</span></label>
                {{ form.tipo_operacion }}
                <p id="error-tipo-operacion" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Seleccione una opción válida</p>
              </div>

              <!-- Tipo tercero field -->
              <div style="width: 100%; margin-bottom:1rem;">
                <p class="m-0">{{ form.tipo_tercero.label_tag }}<span style="color: rgb(192, 0, 0);">*</span></p>
                {{ form.tipo_tercero }}
                <p id="error-tipo-tipo-tercero" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Seleccione una opción válida</p>
              </div>
            </div>

            <div style="display: flex; gap: 1rem; align-items: center;">
              <!-- id fiscal field -->
              <div style="width: 100%; margin-bottom:1rem;">
                <label for="id_id_fiscal">ID fiscal:</label>
                {{ form.id_fiscal }}
                <p id="error-id-fiscal" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Este campo es requerido</p>
              </div>

              <!-- Agente aduanal field -->
              <div style="width: 100%; margin-bottom:1rem;">
                <p class="m-0">{{ form.agente_aduanal.label_tag }}<span style="color: rgb(192, 0, 0);">*</span></p>
                {{ form.agente_aduanal }}
                <p id="error-agente-aduanal" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Seleccione una opción válida</p>
              </div>

              <!-- Identificación Fair Trade field -->
              <div id="fair_trade_container" style="width: 100%; margin-bottom:1rem; display: none;">
                <p class="m-0">Identificación Fair Trade<span style="color: rgb(192, 0, 0);">*</span></p>
                {{ form.fair_trade }}
                <p id="error-fair-trade" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Seleccione una opción válida</p>
              </div>
            </div>

            <div style="display: flex; gap: 1rem;">
              <!-- Dias credito field -->
              <div style="width: 100%; margin-bottom:1rem;">
                <label for="id_dias_credito">Días crédito:<span style="color: rgb(192, 0, 0);">*</span></label>
                {{ form.dias_credito }}
                <p id="error-dias-credito" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Debe ingresar un valor numérico</p>
              </div>

              <!-- Monto credito (moneda nacional) field -->
              <div style="width: 100%; margin-bottom:1rem;">
                <label for="id_monto_credito_mn">Monto crédito MN:<span style="color: rgb(192, 0, 0);">*</span></label>
                {{ form.monto_credito_mn }}
                <p id="error-monto-credito-mn" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Debe ingresar un valor numérico</p>
              </div>

              <!-- Monto credito (moneda extranjera) field -->
              <div style="width: 100%; margin-bottom:1rem;">
                <label for="id_monto_credito_me">Monto crédito ME:<span style="color: rgb(192, 0, 0);">*</span></label>
                {{ form.monto_credito_me }}
                <p id="error-monto-credito-me" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Debe ingresar un valor numérico</p>
              </div>
            </div>

            <div style="display: flex; gap: 1rem;">
              <!-- Retencion iva field -->
              <div style="width: 100%; margin-bottom:1rem;">
                <label for="id_retencion_iva">Retención IVA:<span style="color: rgb(192, 0, 0);">*</span></label>
                {{ form.retencion_iva }}
                <p id="error-retencion-iva" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Seleccione una opción válida</p>
              </div>

              <!-- Retencion isr field -->
              <div style="width: 100%; margin-bottom:1rem;">
                <label for="id_retencion_isr">Retención ISR:<span style="color: rgb(192, 0, 0);">*</span></label>
                {{ form.retencion_isr }}
                <p id="error-retencion-isr" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Seleccione una opción válida</p>
              </div>

              <!-- Iva frontera field -->
              <div style="width: 100%; margin-bottom:1rem;">
                <label for="id_iva_frontera">IVA frontera:<span style="color: rgb(192, 0, 0);">*</span></label>
                {{ form.iva_frontera }}
                <p id="error-iva-frontera" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Seleccione una opción válida</p>
              </div>
            </div>

            <div style="display: flex; gap: 1rem;">
              <!-- Codigo postal field -->
              <div style="width: 100%; margin-bottom:1rem;">
                <label for="id_codigo_postal">Código postal:<span style="color: rgb(192, 0, 0);">*</span></label>
                {{ form.codigo_postal }}
                <p id="error-codigo-postal" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Ingrese un código postal válido</p>
              </div>

              <!-- Pais field -->
              <div style="width: 100%; margin-bottom:1rem;">
                <label for="id_pais">País:<span style="color: rgb(192, 0, 0);">*</span></label>
                {{ form.pais }}
                <p id="error-pais" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Este campo es requerido</p>
              </div>
            </div>

            <div style="display: flex; gap: 1rem;">
              <!-- Estado field -->
              <div style="width: 100%; margin-bottom:1rem;">
                <p class="m-0">{{ form.estado.label_tag }}<span style="color: rgb(192, 0, 0);">*</span></p>
                {{ form.estado }}
                <p id="error-estado" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Este campo es requerido</p>
              </div>

              <!-- Ciudad field -->
              <div style="width: 100%; margin-bottom:1rem;">
                <p class="m-0">{{ form.ciudad.label_tag }}<span style="color: rgb(192, 0, 0);">*</span></p>
                {{ form.ciudad }}
                <p id="error-ciudad" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Este campo es requerido</p>
              </div>
            </div>

            <div style="display: flex; gap: 1rem;">
              <!-- Municipio field -->
              <div style="width: 100%; margin-bottom:1rem;">
                <p class="m-0">{{ form.municipio.label_tag }}<span style="color: rgb(192, 0, 0);">*</span></p>
                {{ form.municipio }}
                <p id="error-municipio" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Este campo es requerido</p>
              </div>

              <!-- Localidad field -->
              <div style="width: 100%; margin-bottom:1rem;">
                <p class="m-0">{{ form.localidad.label_tag }}<span style="color: rgb(192, 0, 0);">*</span></p>
                {{ form.localidad }}
                <p id="error-localidad" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Este campo es requerido</p>
              </div>
            </div>

            <!-- Colonia field -->
            <div style="margin-bottom:1rem;">
              <p class="m-0">{{ form.colonia.label_tag }}<span style="color: rgb(192, 0, 0);">*</span></p>
              {{ form.colonia }}
              <p id="error-colonia" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Este campo es requerido</p>
            </div>

            <!-- Calle field -->
            <div style="margin-bottom:1rem;">
              <p class="m-0">{{ form.calle.label_tag }}<span style="color: rgb(192, 0, 0);">*</span></p>
              {{ form.calle }}
              <p id="error-calle" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Este campo es requerido</p>
            </div>

            <div style="display: flex; gap: 1rem;">
              <!-- Número exterior field -->
              <div style="width: 50%; margin-bottom:1rem;">
                <label for="id_numero_exterior">Número exterior:<span style="color: rgb(192, 0, 0);">*</span></label>
                {{ form.numero_exterior }}
                <p id="error-numero-exterior" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Este campo es requerido</p>
              </div>

              <!-- Número interior field -->
              <div style="width: 50%; margin-bottom:1rem;">
                <label for="id_numero_interior">Número interior:</label>
                {{ form.numero_interior }}
                <p id="error-numero-interior" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Este campo es requerido</p>
              </div>
            </div>

            <!-- Banco field -->
            <div style="margin-bottom:1rem;">
              <p class="m-0">{{ form.banco.label_tag }}<span style="color: rgb(192, 0, 0);">*</span></p>
              {{ form.banco }}
              <p id="error-banco" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Seleccione una opción válida</p>
            </div>

            <div style="display: flex; gap: 1rem;">
              <!-- Cuenta field -->
              <div style="width: 40%; margin-bottom:1rem;">
                <p class="m-0">{{ form.cuenta.label_tag }}<span style="color: rgb(192, 0, 0);">*</span></p>
                {{ form.cuenta }}
                <p id="error-cuenta" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Ingrese un número de cuenta válido</p>
              </div>

              <!-- Clabe field -->
              <div style="width: 40%; margin-bottom:1rem;">
                <p class="m-0">{{ form.clabe.label_tag }}<span style="color: rgb(192, 0, 0);">*</span></p>
                {{ form.clabe }}
                <p id="error-clabe" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Ingrese un número de cuenta válido</p>
              </div>

              <!-- Moneda field -->
              <div style="width: 20%; margin-bottom:1rem;">
                <p class="m-0">{{ form.moneda.label_tag }}<span style="color: rgb(192, 0, 0);">*</span></p>
                {{ form.moneda }}
                <p id="error-moneda" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Seleccione una opción válida</p>
              </div>
            </div>

            <div style="display: flex; gap: 1rem;">
              <!-- Swift field -->
              <div style="width: 50%; margin-bottom:1rem;">
                {{ form.swift.label_tag }}
                {{ form.swift }}
                <p id="error-swift" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Este campo es requerido</p>
              </div>

              <!-- Otro codigo bancario field -->
              <div style="width: 50%; margin-bottom:1rem;">
                <label for="id_otro_codigo_bancario">Otro código bancario:</label>
                {{ form.otro_codigo_bancario }}
                <p id="error-otro-codigo-bancario" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Este campo es requerido</p>
              </div>
            </div>

            <!-- Container for banco 2 fields -->
            <div id="banco-2-container" style="display:none;">
              <hr />
              <!-- Banco 2 field -->
              <div style="margin-bottom:1rem;">
                <label for="id_banco_2">Banco:<span style="color: rgb(192, 0, 0);">*</span></label>
                {{ form.banco_2 }}
                <p id="error-banco-2" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Seleccione una opción válida</p>
              </div>

              <div style="display: flex; gap: 1rem;">
                <!-- Cuenta 2 field -->
                <div style="width: 40%; margin-bottom:1rem;">
                  <label for="id_cuenta_2">Cuenta:<span style="color: rgb(192, 0, 0);">*</span></label>
                  {{ form.cuenta_2 }}
                  <p id="error-cuenta-2" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Ingrese un número de cuenta válido</p>
                </div>

                <!-- Clabe 2 field -->
                <div style="width: 40%; margin-bottom:1rem;">
                  <label for="id_clabe_2">Clabe:<span style="color: rgb(192, 0, 0);">*</span></label>
                  {{ form.clabe_2 }}
                  <p id="error-clabe-2" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Ingrese un número de cuenta válido</p>
                </div>

                <!-- Moneda 2 field -->
                <div style="width: 20%; margin-bottom:1rem;">
                  <label for="id_moneda_2">Moneda:<span style="color: rgb(192, 0, 0);">*</span></label>
                  {{ form.moneda_2 }}
                  <p id="error-moneda-2" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Seleccione una opción válida</p>
                </div>
              </div>

              <div style="display: flex; gap: 1rem;">
                <!-- Swift 2 field -->
                <div style="width: 50%; margin-bottom:1rem;">
                  <label for="id_swift_2">Swift:</label>
                  {{ form.swift_2 }}
                  <p id="error-swift_2" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Este campo es requerido</p>
                </div>
  
                <!-- Otro codigo bancario 2 field -->
                <div style="width: 50%; margin-bottom:1rem;">
                  <label for="id_otro_codigo_bancario_2">Otro código bancario:</label>
                  {{ form.otro_codigo_bancario_2 }}
                  <p id="error-otro-codigo-bancario_2" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Este campo es requerido</p>
                </div>
              </div>
            </div>

            <button class="btn btn-secondary mb-3" type="button" id="add-banco-2">Agregar otro banco</button>

            <div id="checkbox-container" style="display: flex; justify-content: space-between; gap: 2rem;">
              <!-- Usar en portal proveedores field -->
              <div style="margin-bottom:1rem;">
                <label for="id_usar_en_portal_proveedores">¿Usar en portal de prov.?</label>
                {{ form.usar_en_portal_proveedores }}
                <p id="error-usar-en-portal-proveedores" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Seleccione una opción válida</p>
              </div>

              <!-- No aplica para rafaga field -->
              <div style="margin-bottom:1rem;">
                <label for="id_no_aplica_para_rafaga">No aplica para ráfaga:</label>
                {{ form.no_aplica_para_rafaga }}
                <p id="error-no-aplica-para-rafaga" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Seleccione una opción válida</p>
              </div>

              <!-- No relacionar OC field -->
              <div style="margin-bottom:1rem;">
                {{ form.no_relacionar_OC.label_tag }}
                {{ form.no_relacionar_OC }}
                <p id="error-no-relacionar-OC" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Seleccione una opción válida</p>
              </div>
            </div>
            
          </div> <!-- Proveedor nuevo -->

          <!-- Documentos -->
          <!-- Constancia situacion fiscal field -->
          <div style="margin-bottom:1rem;">
            <label for="id_constancia_situacion_fiscal" style="display: block;"><span id="constancia-situacion-fiscal-label">Constancia de situación fiscal:</span><span style="color: rgb(192, 0, 0);">*</span></label>
            {{ form.constancia_situacion_fiscal }}
            <p id="error-constancia-situacion-fiscal" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Seleccione una opción válida</p>
          </div>

          <!-- Estado cuenta bancario field -->
          <div style="margin-bottom:2rem;">
            <label for="id_estado_cuenta_bancario" style="display: block;"><span id="estado-cuenta-bancario-label">Estado de cuenta bancario:</span><span style="color: rgb(192, 0, 0);">*</span></label>
            {{ form.estado_cuenta_bancario }}
            <p id="error-estado-cuenta-bancario" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Seleccione una opción válida</p>
          </div>

          <div class="d-flex gap-3">
            <button id="btn-borrador" class="btn w-100" type="submit" name="borrador" value="True" style="background-color: #3498DB; color: white; font-weight: bold;">Guardar como borrador</button>
            <button id="btn-guardar" class="btn w-100" type="submit" value="True" style="background-color: #008841; color: white; font-weight: bold;">Enviar</button>
          </div>
        </form>

        <button id="btn-back" class="btn btn-secondary">Volver</button>
      </div>
    </div>
  </main>

  <style>
      #btn-back {
          width: 10rem;
          margin-top: 2rem;
          font-weight: bold;
          background-color: rgb(0, 128, 0, 0.6);
          transition: 0.2s ease-in-out;
      }
      #btn-back:hover {
          scale: 1.05;
          background-color: rgb(0, 128, 0);
      }
  </style>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      // Containers
      const proveedorNuevoFields = document.getElementById('proveedor-nuevo-fields')
      const proveedorMigracionFields = document.getElementById('proveedor-migracion-fields')
      const banco2Container = document.getElementById('banco-2-container')
      const checkboxContainer = document.getElementById('checkbox-container')
      const datalist = document.getElementById("opciones_proveedor")

      // Inputs
      const esMigracion = document.getElementById('id_es_migracion')
      const empresaOrigen = document.getElementById('id_empresa_origen')
      const empresaDestino = document.getElementById('id_empresa_destino')
      const rfcMigracion = document.getElementById('id_rfc_migracion')
      const empresa = document.getElementById('id_empresa')
      const tipoAlta = document.getElementById('id_tipo_alta')
      const contribuyente = document.getElementById('id_contribuyente')
      const rfc = document.getElementById('id_rfc')
      const curp = document.getElementById('id_curp')
      const regimenCapital = document.getElementById('id_regimen_capital')
      const nombreFiscal = document.getElementById('id_nombre_fiscal')
      const nombreComercial = document.getElementById('id_nombre_comercial')
      const regimenFiscal = document.getElementById('id_regimen_fiscal')
      const usoCfdi = document.getElementById('id_uso_cfdi')
      const representanteLegal = document.getElementById('id_representante_legal')
      const telefono1 = document.getElementById('id_telefono_1')
      const telefono2 = document.getElementById('id_telefono_2')
      const contacto = document.getElementById('id_contacto')
      const correoGeneral = document.getElementById('id_correo_general')
      const correoPagos = document.getElementById('id_correo_pagos')
      const sitioWeb = document.getElementById('id_sitio_web')
      const rubro = document.getElementById('id_rubro')
      const tipoOperacion = document.getElementById('id_tipo_operacion')
      const tipoTercero = document.getElementById('id_tipo_tercero')
      const idFiscal = document.getElementById('id_id_fiscal')
      const agenteAduanal = document.getElementById('id_agente_aduanal')
      const fairTrade = document.getElementById('id_fair_trade')
      const diasCredito = document.getElementById('id_dias_credito')
      const montoCreditoMn = document.getElementById('id_monto_credito_mn')
      const montoCreditoMe = document.getElementById('id_monto_credito_me')
      const retencionIva = document.getElementById('id_retencion_iva')
      const retencionIsr = document.getElementById('id_retencion_isr')
      const ivaFrontera = document.getElementById('id_iva_frontera')
      const codigoPostal = document.getElementById('id_codigo_postal')
      const pais = document.getElementById('id_pais')
      const estado = document.getElementById('id_estado')
      const ciudad = document.getElementById('id_ciudad')
      const municipio = document.getElementById('id_municipio')
      const localidad = document.getElementById('id_localidad')
      const colonia = document.getElementById('id_colonia')
      const calle = document.getElementById('id_calle')
      const numeroExterior = document.getElementById('id_numero_exterior')
      const numeroInterior = document.getElementById('id_numero_interior')
      const banco = document.getElementById('id_banco')
      const cuenta = document.getElementById('id_cuenta')
      const moneda = document.getElementById('id_moneda')
      const clabe = document.getElementById('id_clabe')
      const swift = document.getElementById('id_swift')
      const otroCodigoBancario = document.getElementById('id_otro_codigo_bancario')
      const banco2 = document.getElementById('id_banco_2')
      const cuenta2 = document.getElementById('id_cuenta_2')
      const moneda2 = document.getElementById('id_moneda_2')
      const clabe2 = document.getElementById('id_clabe_2')
      const swift2 = document.getElementById('id_swift_2')
      const otroCodigoBancario2 = document.getElementById('id_otro_codigo_bancario_2')
      const usarEnPortalProveedores = document.getElementById('id_usar_en_portal_proveedores')
      const noAplicaParaRafaga = document.getElementById('id_no_aplica_para_rafaga')
      const noRelacionarOc = document.getElementById('id_no_relacionar_OC')
      const constanciaSituacionFiscal = document.getElementById('id_constancia_situacion_fiscal')
      const estadoCuentaBancario = document.getElementById('id_estado_cuenta_bancario')

      // Buttons
      const btnAddBanco = document.getElementById('add-banco-2')
      const btnBorrador = document.getElementById('btn-borrador')
      const btnGuardar = document.getElementById('btn-guardar')
      const btnBack = document.getElementById('btn-back')
      
      // Error messages
      const errorEmpresaOrigen = document.getElementById('error-empresa-origen')
      const errorEmpresaDestino = document.getElementById('error-empresa-destino')
      const errorEmpresasMigracion = document.getElementById('error-empresas-migracion')
      const errorRfcMigracion = document.getElementById('error-rfc-migracion')
      const errorRfcMigracion2 = document.getElementById('error-rfc-migracion-2')
      const errorEmpresa = document.getElementById('error-empresa')
      const errorTipoAlta = document.getElementById('error-tipo-alta')
      const errorContribuyente = document.getElementById('error-contribuyente')
      const errorRfc = document.getElementById('error-rfc')
      const errorRfc2 = document.getElementById('error-rfc-2')
      const errorCurp = document.getElementById('error-curp')
      const errorRegimenCapital = document.getElementById('error-regimen-capital')
      const errorNombreFiscal = document.getElementById('error-nombre-fiscal')
      const errorNombreFiscal2 = document.getElementById('error-nombre-fiscal-2')
      const errorNombreComercial = document.getElementById('error-nombre-comercial')
      const errorNombreComercial2 = document.getElementById('error-nombre-comercial-2')
      const errorRegimenFiscal = document.getElementById('error-regimen-fiscal')
      const errorUsoCfdi = document.getElementById('error-uso-cfdi')
      const errorRepresentanteLegal = document.getElementById('error-representante-legal')
      const errorTelefono1 = document.getElementById('error-telefono-1')
      const errorTelefono2 = document.getElementById('error-telefono-2')
      const errorContacto = document.getElementById('error-contacto')
      const errorCorreoGeneral = document.getElementById('error-correo-general')
      const errorCorreoPagos = document.getElementById('error-correo-pagos')
      const errorSitioWeb = document.getElementById('error-sitio-web')
      const errorRubro = document.getElementById('error-rubro')
      const errorTipoOperacion = document.getElementById('error-tipo-operacion')
      const errorTipoTercero = document.getElementById('error-tipo-tercero')
      const errorIdFiscal = document.getElementById('error-id-fiscal')
      const errorAgenteAduanal = document.getElementById('error-agente-aduanal')
      const errorFairTrade = document.getElementById('error-fair-trade')
      const errorDiasCredito = document.getElementById('error-dias-credito')
      const errorMontoCreditoMn = document.getElementById('error-monto-credito-mn')
      const errorMontoCreditoMe = document.getElementById('error-monto-credito-me')
      const errorRetencionIva = document.getElementById('error-retencion-iva')
      const errorRetencionIsr = document.getElementById('error-retencion-isr')
      const errorIvaFrontera = document.getElementById('error-iva-frontera')
      const errorCodigoPostal = document.getElementById('error-codigo-postal')
      const errorPais = document.getElementById('error-pais')
      const errorEstado = document.getElementById('error-estado')
      const errorCiudad = document.getElementById('error-ciudad')
      const errorMunicipio = document.getElementById('error-municipio')
      const errorLocalidad = document.getElementById('error-localidad')
      const errorColonia = document.getElementById('error-colonia')
      const errorCalle = document.getElementById('error-calle')
      const errorNumeroExterior = document.getElementById('error-numero-exterior')
      const errorNumeroInterior = document.getElementById('error-numero-interior')
      const errorBanco = document.getElementById('error-banco')
      const errorCuenta = document.getElementById('error-cuenta')
      const errorMoneda = document.getElementById('error-moneda')
      const errorClabe = document.getElementById('error-clabe')
      const errorBanco2 = document.getElementById('error-banco-2')
      const errorCuenta2 = document.getElementById('error-cuenta-2')
      const errorMoneda2 = document.getElementById('error-moneda-2')
      const errorClabe2 = document.getElementById('error-clabe-2')
      const errorUsarEnPortalProveedores = document.getElementById('error-usar-en-portal-proveedores')
      const errorNoAplicaParaRafaga = document.getElementById('error-no-aplica-para-rafaga')
      const errorNoRelacionarOc = document.getElementById('error-no-relacionar-OC')
      
      // Regular expressions
      const rfcPattern = /^[A-Za-z]{3,4}\d{6}[A-Za-z\d]{3}$/
      const curpPattern = /^[A-Za-z]{4}\d{6}[A-Za-z]{6}[A-Za-z\d]{2}$/
      const telefonoPattern = /^[\d\s+\-]{10,}$/
      const correoPattern = /^[A-Za-z\d._%+-]+@[A-Za-z\d.-]+\.[A-Za-z]{2,}$/
      const codigoPostalPattern = /^\d{5}$/
      const cuentaPattern = /^\d{10,20}$/
      const clabePattern = /^\d{18}$/
      const nonAccentPattern = /^[A-Za-z\d\s]*$/
      const numberPattern = /^[\d,]*$/

      // Catalogo de proveedores existentes
      var catalogoProveedor = {{ catalogo_proveedor|safe }}
      rfcMigracion.setAttribute('list', 'opciones_proveedor')
      rfc.setAttribute('list', 'opciones_proveedor')

      btnBack.addEventListener('click', () => {
        window.history.back()
      })

      const handleEsMigracion = (esMigracionValue) => {
        const constanciaSituacionFiscalLabel = document.querySelector('#constancia-situacion-fiscal-label')
        const estadoCuentaBancarioLabel = document.querySelector('#estado-cuenta-bancario-label')

        if(esMigracionValue) {
          proveedorNuevoFields.style.display = 'none'
          proveedorMigracionFields.style.display = 'block'
          constanciaSituacionFiscalLabel.innerText = 'Constancia de situación fiscal actualizada'
          estadoCuentaBancarioLabel.innerText = 'Estado de cuenta bancario actualizado'
        }
        else {
          proveedorMigracionFields.style.display = 'none'
          proveedorNuevoFields.style.display = 'block'
          constanciaSituacionFiscalLabel.innerText = 'Constancia de situación fiscal'
          estadoCuentaBancarioLabel.innerText = 'Estado de cuenta bancario'
        }

        empresaOrigen.required = esMigracionValue
        empresaDestino.required = esMigracionValue
        rfcMigracion.required = esMigracionValue

        empresa.required = !esMigracionValue
        contribuyente.required = !esMigracionValue
        rfc.required = !esMigracionValue
        regimenCapital.required = !esMigracionValue
        nombreFiscal.required = !esMigracionValue
        nombreComercial.required = !esMigracionValue
        regimenFiscal.required = !esMigracionValue
        usoCfdi.required = !esMigracionValue
        telefono1.required = !esMigracionValue
        correoGeneral.required = !esMigracionValue
        correoPagos.required = !esMigracionValue
        rubro.required = !esMigracionValue
        tipoOperacion.required = !esMigracionValue
        tipoTercero.required = !esMigracionValue
        agenteAduanal.required = !esMigracionValue
        fairTrade.required = !esMigracionValue
        diasCredito.required = !esMigracionValue
        montoCreditoMn.required = !esMigracionValue
        retencionIva.required = !esMigracionValue
        retencionIsr.required = !esMigracionValue
        ivaFrontera.required = !esMigracionValue
        codigoPostal.required = !esMigracionValue
        pais.required = !esMigracionValue
        estado.required = !esMigracionValue
        ciudad.required = !esMigracionValue
        municipio.required = !esMigracionValue
        localidad.required = !esMigracionValue
        colonia.required = !esMigracionValue
        calle.required = !esMigracionValue
        numeroExterior.required = !esMigracionValue
        banco.required = !esMigracionValue
        cuenta.required = !esMigracionValue
        moneda.required = !esMigracionValue
        clabe.required = !esMigracionValue
        constanciaSituacionFiscal.required = true
        estadoCuentaBancario.required = true
      }

      // Handling EsMigracion state change
      esMigracion.addEventListener('change', () => {
        handleEsMigracion(esMigracion.checked)
        enableSaveButton()
      })

      handleEsMigracion(esMigracion.checked)

      // FIELD VALIDATION

      const firstLetterCapitalized = str => {
        return str[0].toUpperCase() + str.slice(1).toLowerCase()
      }

      const firstLetterOfEachWordCapitalized = str => {
        return str.toLowerCase().replace(/\b\w/g, char => char.toUpperCase());
      }
    
      // Validación empresa origen
      const validateEmpresaOrigen = () => {
        if (empresaOrigen.value == '') {
          errorEmpresaOrigen.style.display = 'block'
          errorEmpresasMigracion.style.display = 'none'
        } else {
          errorEmpresaOrigen.style.display = 'none'
        }
        // No se puede seleccionar la misma opción que en "Empresa destino"
        if (empresaOrigen.value == empresaDestino.value) {
          errorEmpresasMigracion.style.display = 'block'
        } else {
          errorEmpresasMigracion.style.display = 'none'
        }
        enableSaveButton()
      }
      empresaOrigen.addEventListener('focus', validateEmpresaOrigen)
      empresaOrigen.addEventListener('change', validateEmpresaOrigen)
      
      // Validación empresa destino
      const validateEmpresaDestino = () => {
        if (empresaDestino.value == '') {
          errorEmpresaDestino.style.display = 'block'
          errorEmpresasMigracion.style.display = 'none'
        } else {
          errorEmpresaDestino.style.display = 'none'
        }
        // No se puede seleccionar la misma opción que en "Empresa origen"
        if (empresaOrigen.value == empresaDestino.value) {
          errorEmpresasMigracion.style.display = 'block'
        } else {
          errorEmpresasMigracion.style.display = 'none'
        }
        enableSaveButton()
      }
      empresaDestino.addEventListener('focus', validateEmpresaDestino)
      empresaDestino.addEventListener('change', validateEmpresaDestino)
      
      // Validación rfc migracion
      const validateRfcMigracion = () => {
        if (rfcPattern.test(rfcMigracion.value)) {
          errorRfcMigracion.style.display = 'none'
        } else {
          errorRfcMigracion.style.display = 'block'
        }
        
        // Filtrando las opciones del catálogo que empiecen con el valor de rfc migracion
        datalist.innerHTML = ''
        for (var i = 0; i < catalogoProveedor.length; i++) {
          if (catalogoProveedor[i].value.toUpperCase().startsWith(rfcMigracion.value.toUpperCase())) {
            const option = document.createElement('option')
            option.value = catalogoProveedor[i].value
            option.innerText = catalogoProveedor[i].text
            datalist.appendChild(option)
          }
          if (datalist.childElementCount == 0) {
            errorRfcMigracion2.style.display = 'block'
            disableAllFieldsForMigracion()
          } else {
            errorRfcMigracion2.style.display = 'none'
            enableAllFieldsForMigracion()
          }
        }
        enableSaveButton()
      }
      const validateRfcMigracionOnChange = () => {
        // Todas las letras deben ser mayúsculas
        rfcMigracion.value = rfcMigracion.value.toUpperCase()
      }
      rfcMigracion.addEventListener('focus', validateRfcMigracion)
      rfcMigracion.addEventListener('input', validateRfcMigracion)
      rfcMigracion.addEventListener('change', validateRfcMigracionOnChange)
      
      // Validación empresa
      const validateEmpresa = () => {
        if (empresa.value == '') {
          errorEmpresa.style.display = 'block'
        } else {
          errorEmpresa.style.display = 'none'
        }
        enableSaveButton()
      }
      empresa.addEventListener('focus', validateEmpresa)
      empresa.addEventListener('change', validateEmpresa)
      
      // Validación tipo alta
      const validateTipoAlta = () => {
        tipoAlta.setAttribute('disabled', true)
        const fairTradeContainer = document.querySelector('#fair_trade_container')
        {% if current_user.puede_crear_proveedor %}
          tipoAlta.value = "Proveedor";
          idFiscal.setAttribute('placeholder', 'para proveedores extranjeros')
          fairTradeContainer.style.display = 'none'
          fairTrade.removeAttribute('required')
        {% endif %}

        {% if current_user.puede_crear_cliente %}
          tipoAlta.value = "Cliente";
          idFiscal.setAttribute('placeholder', 'para clientes extranjeros')
          fairTradeContainer.style.display = 'block'
          fairTrade.setAttribute('required', true)
        {% endif %}
      }
      validateTipoAlta()
      
      // Validación contribuyente
      const validateContribuyente = () => {
        if (contribuyente.value == '') {
          errorContribuyente.style.display = 'block'
        } else {
          errorContribuyente.style.display = 'none'

          // La curp es obligatoria solo para personas físicas
          // El régimen de capital no es necesario para personas físicas
          if (contribuyente.value == 'Persona física') {
            curp.required = true
            curp.disabled = false
            regimenCapital.required = false
            regimenCapital.disabled = true
            regimenCapital.value = ''
            errorRegimenCapital.style.display = 'none'
            // Si es persona física, la primera letra de cada palabra será mayúscula
            nombreFiscal.value = nombreFiscal.value != '' ? firstLetterOfEachWordCapitalized(nombreFiscal.value) : ''
            nombreComercial.value = nombreComercial.value != '' ? firstLetterOfEachWordCapitalized(nombreComercial.value) : ''
          }
          if (contribuyente.value == 'Persona moral') {
            curp.required = false
            curp.disabled = true
            curp.value = ''
            errorCurp.style.display = 'none'
            regimenCapital.required = true
            regimenCapital.disabled = false
            // Si es persona moral, solo la primera letra será mayúscula
            nombreFiscal.value = nombreFiscal.value != '' ? firstLetterCapitalized(nombreFiscal.value) : ''
            nombreComercial.value = nombreComercial.value != '' ? firstLetterCapitalized(nombreComercial.value) : ''
          }
        }
        enableSaveButton()
      }
      contribuyente.addEventListener('focus', validateContribuyente)
      contribuyente.addEventListener('change', validateContribuyente)

      // Validación rfc
      const validateRfc = () => {
        if (rfcPattern.test(rfc.value)) {
          errorRfc.style.display = 'none'
        } else {
          errorRfc.style.display = 'block'
        }

        // Filtrando las opciones del catálogo que empiecen con el valor de rfc
        datalist.innerHTML = ''

        // Clientes y proveedores extranjeros tienen un RFC genérico
        if (rfc.value.toUpperCase() == 'XAX010101000' || rfc.value.toUpperCase() == 'XEXX010101000') {
          const option = document.createElement('option')
          option.value = rfc.value.toUpperCase()
          if (rfc.value.toUpperCase() == 'XAX010101000') {
            option.innerText = `${rfc.value.toUpperCase()} - Cliente extranjero`
          }
          else {
            option.innerText = `${rfc.value.toUpperCase()} - Proveedor extranjero`
          }
          datalist.appendChild(option)
          // La clabe interbancaria no es obligatoria para clientes y proveedores extranjeros
          clabe.required = false
          errorClabe.style.display = 'none'
          /*if (clabe2) {
            clabe2.required = false
            errorClabe2.style.display = 'none'
          }*/
        }
        else {
          clabe.required = true
          /*if (clabe2) {
            clabe2.required = true
          }*/
          for (var i = 0; i < catalogoProveedor.length; i++) {
            if (catalogoProveedor[i].value.toUpperCase().startsWith(rfc.value.toUpperCase())) {
              const option = document.createElement('option')
              option.value = catalogoProveedor[i].value
              option.innerText = catalogoProveedor[i].text
              datalist.appendChild(option)
            }
            if (catalogoProveedor[i].value.toUpperCase() == rfc.value.toUpperCase() && rfc.value != '') {
              errorRfc2.style.display = 'block'
              disableAllFields(rfc)
              return
            }
            else {
              errorRfc2.style.display = 'none'
              enableAllFields()
            }
          }
        }

        enableSaveButton()
      }
      const validateRfcOnChange = () => {
        // Todas las letras deben ser mayúsculas
        rfc.value = rfc.value.toUpperCase()
      }
      rfc.addEventListener('focus', validateRfc)
      rfc.addEventListener('input', validateRfc)
      rfc.addEventListener('change', validateRfcOnChange)
      
      // Validación curp
      const validateCurp = () => {
        if (curpPattern.test(curp.value)) {
          errorCurp.style.display = 'none'
        } else {
          errorCurp.style.display = 'block'
        }
        enableSaveButton()
      }
      const validateCurpOnChange = () => {
        // Todas las letras deben ser mayúsculas
        curp.value = curp.value.toUpperCase()
      }
      curp.addEventListener('focus', validateCurp)
      curp.addEventListener('input', validateCurp)
      curp.addEventListener('change', validateCurpOnChange)
      
      // Validación nombre fiscal
      const validateNombreFiscal = () => {
        if (nombreFiscal.value == '') {
          errorNombreFiscal.style.display = 'block'
          errorNombreFiscal2.style.display = 'none'
          enableAllFields()
        } else {
          errorNombreFiscal.style.display = 'none'
          if (nonAccentPattern.test(nombreFiscal.value)) {
            errorNombreFiscal2.style.display = 'none'
            enableAllFields()
          }
          else {
            errorNombreFiscal2.style.display = 'block'
            disableAllFields(nombreFiscal)
          }
        }
        enableSaveButton()
      }
      const validateNombreFiscalOnChange = () => {
        // Si es persona física, la primera letra de cada palabra será mayúscula
        if (contribuyente.value == 'Persona física') {
          nombreFiscal.value = nombreFiscal.value != '' ? firstLetterOfEachWordCapitalized(nombreFiscal.value) : ''
        }
        // Si es persona moral, solo la primera letra será mayúscula
        if (contribuyente.value == 'Persona moral') {
          nombreFiscal.value = nombreFiscal.value != '' ? firstLetterCapitalized(nombreFiscal.value) : ''
        }
      }
      nombreFiscal.addEventListener('focus', validateNombreFiscal)
      nombreFiscal.addEventListener('input', validateNombreFiscal)
      nombreFiscal.addEventListener('change', validateNombreFiscalOnChange)
      
      // Validación regimen de capital
      const validateRegimenCapital = () => {
        if (regimenCapital.value == '') {
          errorRegimenCapital.style.display = 'block'
        } else {
          errorRegimenCapital.style.display = 'none'
        }
        enableSaveButton()
      }
      regimenCapital.addEventListener('focus', validateRegimenCapital)
      regimenCapital.addEventListener('change', validateRegimenCapital)
      
      // Validación nombre comercial
      const validateNombreComercial = () => {
        if (nombreComercial.value == '') {
          errorNombreComercial.style.display = 'block'
          errorNombreComercial2.style.display = 'none'
          enableAllFields()
        } else {
          errorNombreComercial.style.display = 'none'
          if (nonAccentPattern.test(nombreComercial.value)) {
            errorNombreComercial2.style.display = 'none'
            enableAllFields()
          }
          else {
            errorNombreComercial2.style.display = 'block'
            disableAllFields(nombreComercial)
          }
        }
        enableSaveButton()
      }
      const validateNombreComercialOnChange = () => {
        // Si es persona física, solo la primera letra de cada palabra será mayúscula
        if (contribuyente.value == 'Persona física') {
          nombreComercial.value = nombreComercial.value != '' ? firstLetterOfEachWordCapitalized(nombreComercial.value) : ''
        }
        // Si es persona moral, solo la primera letra será mayúscula
        if (contribuyente.value == 'Persona moral') {
          nombreComercial.value = nombreComercial.value != '' ? firstLetterCapitalized(nombreComercial.value) : ''
        }
      }
      nombreComercial.addEventListener('focus', validateNombreComercial)
      nombreComercial.addEventListener('input', validateNombreComercial)
      nombreComercial.addEventListener('change', validateNombreComercialOnChange)
      
      // Validación regimen fiscal
      const validateRegimenFiscal = () => {
        if (regimenFiscal.value == '') {
          errorRegimenFiscal.style.display = 'block'
        } else {
          errorRegimenFiscal.style.display = 'none'
        }
        enableSaveButton()
      }
      regimenFiscal.addEventListener('focus', validateRegimenFiscal)
      regimenFiscal.addEventListener('change', validateRegimenFiscal)
      
      // Validación representante legal
      const validateRepresentanteLegal = () => {
        // La primera letra de cada palabra será mayúscula
        representanteLegal.value = representanteLegal.value != '' ? firstLetterOfEachWordCapitalized(representanteLegal.value) : ''
      }
      representanteLegal.addEventListener('change', validateRepresentanteLegal)
      
      // Validación contacto
      const validateContacto = () => {
        // La primera letra de cada palabra será mayúscula
        contacto.value = contacto.value != '' ? firstLetterOfEachWordCapitalized(contacto.value) : ''
      }
      contacto.addEventListener('change', validateContacto)
      
      // Validación uso cfdi
      const validateUsoCfdi = () => {
        if (usoCfdi.value == '') {
          errorUsoCfdi.style.display = 'block'
        } else {
          errorUsoCfdi.style.display = 'none'
        }
        enableSaveButton()
      }
      usoCfdi.addEventListener('focus', validateUsoCfdi)
      usoCfdi.addEventListener('change', validateUsoCfdi)
      
      // Validación telefono 1
      const validateTelefono1 = () => {
        if (telefonoPattern.test(telefono1.value)) {
          errorTelefono1.style.display = 'none'
          enableAllFields()
        } else {
          errorTelefono1.style.display = 'block'
          disableAllFields(telefono1)
        }
        enableSaveButton()
      }
      telefono1.addEventListener('focus', validateTelefono1)
      telefono1.addEventListener('input', validateTelefono1)
      
      // Validación telefono 2
      const validateTelefono2 = () => {
        if (telefono2.value == '' || telefonoPattern.test(telefono2.value)) {
          errorTelefono2.style.display = 'none'
          enableAllFields()
        } else {
          errorTelefono2.style.display = 'block'
          disableAllFields(telefono2)
        }
        enableSaveButton()
      }
      telefono2.addEventListener('focus', validateTelefono2)
      telefono2.addEventListener('input', validateTelefono2)
      
      // Validación correo general
      const validateCorreoGeneral = () => {
        if (correoPattern.test(correoGeneral.value)) {
          errorCorreoGeneral.style.display = 'none'
          enableAllFields()
        } else {
          errorCorreoGeneral.style.display = 'block'
          disableAllFields(correoGeneral)
        }
        
        enableSaveButton()
      }
      const validateCorreoGeneralOnChange = () => {
        // Todas las letras deben ser minúsculas
        correoGeneral.value = correoGeneral.value.toLowerCase()
      }
      correoGeneral.addEventListener('focus', validateCorreoGeneral)
      correoGeneral.addEventListener('input', validateCorreoGeneral)
      correoGeneral.addEventListener('change', validateCorreoGeneralOnChange)
      
      // Validación correo pagos
      const validateCorreoPagos = () => {
        if (correoPattern.test(correoPagos.value)) {
          errorCorreoPagos.style.display = 'none'
          enableAllFields()
        } else {
          errorCorreoPagos.style.display = 'block'
          disableAllFields(correoPagos)
        }
        enableSaveButton()
      }
      const validateCorreoPagosOnChange = () => {
        // Todas las letras deben ser minúsculas
        correoPagos.value = correoPagos.value.toLowerCase()
      }
      correoPagos.addEventListener('focus', validateCorreoPagos)
      correoPagos.addEventListener('input', validateCorreoPagos)
      correoPagos.addEventListener('change', validateCorreoPagosOnChange)
      
      // Validación sitio web
      const validateSitioWeb = () => {
        // Todas las letras deben ser minúsculas
        sitioWeb.value = sitioWeb.value.toLowerCase()
      }
      sitioWeb.addEventListener('change', validateSitioWeb)
      
      // Validación rubro
      const validateRubro = () => {
        if (rubro.value == '') {
          errorRubro.style.display = 'block'
        } else {
          errorRubro.style.display = 'none'
        }
        enableSaveButton()
      }
      rubro.addEventListener('focus', validateRubro)
      rubro.addEventListener('change', validateRubro)
      
      // Validación tipo operacion
      const validateTipoOperacion = () => {
        if (tipoOperacion.value == '') {
          errorTipoOperacion.style.display = 'block'
        } else {
          errorTipoOperacion.style.display = 'none'
        }
        enableSaveButton()
      }
      tipoOperacion.addEventListener('focus', validateTipoOperacion)
      tipoOperacion.addEventListener('change', validateTipoOperacion)
      
      // Validación agente aduanal
      const validateAgenteAduanal = () => {
        if (agenteAduanal.value == '') {
          errorAgenteAduanal.style.display = 'block'
        } else {
          errorAgenteAduanal.style.display = 'none'
        }
        enableSaveButton()
      }
      agenteAduanal.addEventListener('focus', validateAgenteAduanal)
      agenteAduanal.addEventListener('change', validateAgenteAduanal)

      const numberWithCommas = (x) => {
        return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
      }
      
      // Validación Identificación Fair Trade
      if (fairTrade) {
        const validateFairTrade = () => {
          if (fairTrade.value == '') {
            errorFairTrade.style.display = 'block'
          } else {
            errorFairTrade.style.display = 'none'
          }
          enableSaveButton()
        }
        fairTrade.addEventListener('focus', validateFairTrade)
        fairTrade.addEventListener('input', validateFairTrade)
      }
      
      // Validación dias credito
      const validateDiasCredito = () => {
        if (diasCredito.value != '' && numberPattern.test(diasCredito.value)) {
          errorDiasCredito.style.display = 'none'
          // Eliminar carácteres no numéricos
          const numericValue = diasCredito.value.replace(/[^0-9]/g, '');
          // Formatear el valor con números y comas
          const formattedValue = numberWithCommas(numericValue)
          diasCredito.value = formattedValue;
        } else {
          errorDiasCredito.style.display = 'block'
        }
        enableSaveButton()
      }
      diasCredito.addEventListener('focus', validateDiasCredito)
      diasCredito.addEventListener('input', validateDiasCredito)
      
      // Validación monto credito (moneda nacional)
      const validateMontoCreditoMn = () => {
        if (montoCreditoMn.value != '' && numberPattern.test(montoCreditoMn.value)) {
          errorMontoCreditoMn.style.display = 'none'
          // Eliminar carácteres no numéricos
          const numericValue = montoCreditoMn.value.replace(/[^0-9]/g, '')
          // Formatear el valor con números y comas
          const formattedValue = numberWithCommas(numericValue)
          montoCreditoMn.value = formattedValue
        } else {
          errorMontoCreditoMn.style.display = 'block'
        }
        enableSaveButton()
      }
      montoCreditoMn.addEventListener('focus', validateMontoCreditoMn)
      montoCreditoMn.addEventListener('input', validateMontoCreditoMn)

      // Validación monto credito (moneda extranjera)
      const validateMontoCreditoMe = () => {
        if (montoCreditoMe.value != '' && numberPattern.test(montoCreditoMe.value)) {
          errorMontoCreditoMe.style.display = 'none'
          // Eliminar carácteres no numéricos
          const numericValue = montoCreditoMe.value.replace(/[^0-9]/g, '')
          // Formatear el valor con números y comas
          const formattedValue = numberWithCommas(numericValue)
          montoCreditoMe.value = formattedValue
        } else {
          errorMontoCreditoMe.style.display = 'block'
        }
        enableSaveButton()
      }
      montoCreditoMe.addEventListener('focus', validateMontoCreditoMe)
      montoCreditoMe.addEventListener('input', validateMontoCreditoMe)
      
      // Validación retencion iva
      const validateRetencionIva = () => {
        if (retencionIva.value == '') {
          errorRetencionIva.style.display = 'block'
        } else {
          errorRetencionIva.style.display = 'none'
        }
        enableSaveButton()
      }
      retencionIva.addEventListener('focus', validateRetencionIva)
      retencionIva.addEventListener('change', validateRetencionIva)
      
      // Validación retencion isr
      const validateRetencionIsr = () => {
        if (retencionIsr.value == '') {
          errorRetencionIsr.style.display = 'block'
        } else {
          errorRetencionIsr.style.display = 'none'
        }
        enableSaveButton()
      }
      retencionIsr.addEventListener('focus', validateRetencionIsr)
      retencionIsr.addEventListener('change', validateRetencionIsr)
      
      // Validación iva frontera
      const validateIvaFrontera = () => {
        if (ivaFrontera.value == '') {
          errorIvaFrontera.style.display = 'block'
        } else {
          errorIvaFrontera.style.display = 'none'
        }
        enableSaveButton()
      }
      ivaFrontera.addEventListener('focus', validateIvaFrontera)
      ivaFrontera.addEventListener('change', validateIvaFrontera)
      
      // Validación codigo postal
      const validateCodigoPostal = () => {
        if (codigoPostalPattern.test(codigoPostal.value)) {
          errorCodigoPostal.style.display = 'none'
          enableAllFields()
        } else {
          errorCodigoPostal.style.display = 'block'
          disableAllFields(codigoPostal)
        }
        enableSaveButton()
      }
      codigoPostal.addEventListener('focus', validateCodigoPostal)
      codigoPostal.addEventListener('input', validateCodigoPostal)
      
      // Validación país
      const validatePais = () => {
        if (pais.value == '') {
          errorPais.style.display = 'block'
        } else {
          errorPais.style.display = 'none'
        }
        enableSaveButton()
      }
      const validatePaisOnChange = () => {
        // La primera letra de cada palabra será mayúscula
        pais.value = pais.value != '' ? firstLetterOfEachWordCapitalized(pais.value) : ''
      }
      pais.addEventListener('focus', validatePais)
      pais.addEventListener('input', validatePais)
      pais.addEventListener('change', validatePaisOnChange)
      
      // Validación estado
      const validateEstado = () => {
        if (estado.value == '') {
          errorEstado.style.display = 'block'
        } else {
          errorEstado.style.display = 'none'
        }
        enableSaveButton()
      }
      const validateEstadoOnChange = () => {
        // La primera letra de cada palabra será mayúscula
        estado.value = estado.value != '' ? firstLetterOfEachWordCapitalized(estado.value) : ''
      }
      estado.addEventListener('focus', validateEstado)
      estado.addEventListener('input', validateEstado)
      estado.addEventListener('change', validateEstadoOnChange)
      
      // Validación ciudad
      const validateCiudad = () => {
        if (ciudad.value == '') {
          errorCiudad.style.display = 'block'
        } else {
          errorCiudad.style.display = 'none'
        }
        enableSaveButton()
      }
      const validateCiudadOnChange = () => {
        // La primera letra de cada palabra será mayúscula
        ciudad.value = ciudad.value != '' ? firstLetterOfEachWordCapitalized(ciudad.value) : ''
      }
      ciudad.addEventListener('focus', validateCiudad)
      ciudad.addEventListener('input', validateCiudad)
      ciudad.addEventListener('change', validateCiudadOnChange)
      
      // Validación municipio
      const validateMunicipio = () => {
        if (municipio.value == '') {
          errorMunicipio.style.display = 'block'
        } else {
          errorMunicipio.style.display = 'none'
        }
        enableSaveButton()
      }
      const validateMunicipioOnChange = () => {
        // La primera letra de cada palabra será mayúscula
        municipio.value = municipio.value != '' ? firstLetterOfEachWordCapitalized(municipio.value) : ''
      }
      municipio.addEventListener('focus', validateMunicipio)
      municipio.addEventListener('input', validateMunicipio)
      municipio.addEventListener('change', validateMunicipioOnChange)
      
      // Validación localidad
      const validateLocalidad = () => {
        if (localidad.value == '') {
          errorLocalidad.style.display = 'block'
        } else {
          errorLocalidad.style.display = 'none'
        }
        enableSaveButton()
      }
      const validateLocalidadOnChange = () => {
        // La primera letra de cada palabra será mayúscula
        localidad.value = localidad.value != '' ? firstLetterOfEachWordCapitalized(localidad.value) : ''
      }
      localidad.addEventListener('focus', validateLocalidad)
      localidad.addEventListener('input', validateLocalidad)
      localidad.addEventListener('change', validateLocalidadOnChange)
      
      // Validación colonia
      const validateColonia = () => {
        if (colonia.value == '') {
          errorColonia.style.display = 'block'
        } else {
          errorColonia.style.display = 'none'
        }
        enableSaveButton()
      }
      const validateColoniaOnChange = () => {
        // La primera letra de cada palabra será mayúscula
        colonia.value = colonia.value != '' ? firstLetterOfEachWordCapitalized(colonia.value) : ''
      }
      colonia.addEventListener('focus', validateColonia)
      colonia.addEventListener('input', validateColonia)
      colonia.addEventListener('change', validateColoniaOnChange)
      
      // Validación calle
      const validateCalle = () => {
        if (calle.value == '') {
          errorCalle.style.display = 'block'
        } else {
          errorCalle.style.display = 'none'
        }
        enableSaveButton()
      }
      const validateCalleOnChange = () => {
        // La primera letra de cada palabra será mayúscula
        calle.value = calle.value != '' ? firstLetterOfEachWordCapitalized(calle.value) : ''
      }
      calle.addEventListener('focus', validateCalle)
      calle.addEventListener('input', validateCalle)
      calle.addEventListener('change', validateCalleOnChange)
      
      // Validación número exterior
      const validateNumeroExterior = () => {
        if (numeroExterior.value == '') {
          errorNumeroExterior.style.display = 'block'
        } else {
          errorNumeroExterior.style.display = 'none'
        }
        enableSaveButton()
      }
      numeroExterior.addEventListener('focus', validateNumeroExterior)
      numeroExterior.addEventListener('input', validateNumeroExterior)
      
      // Validación banco
      const validateBanco = () => {
        if (banco.value == '') {
          errorBanco.style.display = 'block'
        } else {
          errorBanco.style.display = 'none'
        }
        enableSaveButton()
      }
      banco.addEventListener('focus', validateBanco)
      banco.addEventListener('change', validateBanco)
      
      // Validación cuenta
      const validateCuenta = () => {
        if (cuentaPattern.test(cuenta.value)) {
          errorCuenta.style.display = 'none'
        } else {
          errorCuenta.style.display = 'block'
        }
        enableSaveButton()
      }
      cuenta.addEventListener('focus', validateCuenta)
      cuenta.addEventListener('input', validateCuenta)
      
      // Validación moneda
      const validateMoneda = () => {
        if (moneda.value == '') {
          errorMoneda.style.display = 'block'
        } else {
          errorMoneda.style.display = 'none'
        }
        enableSaveButton()
      }
      moneda.addEventListener('focus', validateMoneda)
      moneda.addEventListener('change', validateMoneda)
      
      // Validación clabe
      const validateClabe = () => {
        if (rfc.value.toUpperCase() == 'XAX010101000' || rfc.value.toUpperCase() == 'XEXX010101000') {
          return
        }
        if (clabePattern.test(clabe.value)) {
          errorClabe.style.display = 'none'
        } else {
          errorClabe.style.display = 'block'
        }
        enableSaveButton()
      }
      clabe.addEventListener('focus', validateClabe)
      clabe.addEventListener('input', validateClabe)

      // Añadiendo un segundo banco
      btnAddBanco.addEventListener('click', () => {
        banco2.value = ''
        cuenta2.value = ''
        moneda2.value = ''
        clabe2.value = ''
        
        if(btnAddBanco.textContent == 'Agregar otro banco') {
          
          errorBanco2.style.display = 'none'
          errorCuenta2.style.display = 'none'
          errorMoneda2.style.display = 'none'
          errorClabe2.style.display = 'none'
          banco2Container.style.display = 'block'

          banco2.required = true
          cuenta2.required = true
          moneda2.required = true
          clabe2.required = true

          btnAddBanco.textContent = 'Eliminar banco'
        }
        else {
          banco2Container.style.display = 'none'

          banco2.required = false
          cuenta2.required = false
          moneda2.required = false
          clabe2.required = false

          btnAddBanco.textContent = 'Agregar otro banco'
        }
        enableSaveButton()
      })
      
      // Validación banco 2
      const validateBanco2 = () => {
        if (banco2.value == '') {
          errorBanco2.style.display = 'block'
        } else {
          errorBanco2.style.display = 'none'
        }
        enableSaveButton()
      }
      banco2.addEventListener('focus', validateBanco2)
      banco2.addEventListener('change', validateBanco2)
      
      // Validación cuenta 2
      const validateCuenta2 = () => {
        if (cuentaPattern.test(cuenta2.value)) {
          errorCuenta2.style.display = 'none'
        } else {
          errorCuenta2.style.display = 'block'
        }
        enableSaveButton()
      }
      cuenta2.addEventListener('focus', validateCuenta2)
      cuenta2.addEventListener('input', validateCuenta2)
      
      // Validación moneda 2
      const validateMoneda2 = () => {
        if (moneda2.value == '') {
          errorMoneda2.style.display = 'block'
        } else {
          errorMoneda2.style.display = 'none'
        }
        enableSaveButton()
      }
      moneda2.addEventListener('focus', validateMoneda2)
      moneda2.addEventListener('change', validateMoneda2)
      
      // Validación clabe 2
      const validateClabe2 = () => {
        if (rfc.value.toUpperCase() == 'XAX010101000' || rfc.value.toUpperCase() == 'XEXX010101000') {
          return
        }
        if (clabePattern.test(clabe2.value)) {
          errorClabe2.style.display = 'none'
        } else {
          errorClabe2.style.display = 'block'
        }
        enableSaveButton()
      }
      clabe2.addEventListener('focus', validateClabe2)
      clabe2.addEventListener('input', validateClabe2)

      const disableAllFieldsForMigracion = () => {
        esMigracion.setAttribute('disabled', true)
        empresaOrigen.setAttribute('disabled', true)
        empresaDestino.setAttribute('disabled', true)
        constanciaSituacionFiscal.setAttribute('disabled', true)
        estadoCuentaBancario.setAttribute('disabled', true)
      }

      const enableAllFieldsForMigracion = () => {
        esMigracion.removeAttribute('disabled')
        empresaOrigen.removeAttribute('disabled')
        empresaDestino.removeAttribute('disabled')
        constanciaSituacionFiscal.removeAttribute('disabled')
        estadoCuentaBancario.removeAttribute('disabled')
      }

      const disableAllFields = input => {
        esMigracion.setAttribute('disabled', true)
        empresa.setAttribute('disabled', true)
        contribuyente.setAttribute('disabled', true)
        if (input.name != 'rfc') {
          rfc.setAttribute('disabled', true)
        }
        if (input.name != 'curp') {
          curp.setAttribute('disabled', true)
        }
        regimenCapital.setAttribute('disabled', true)
        if (input.name != 'nombre_fiscal') {
          nombreFiscal.setAttribute('disabled', true)
        }
        if (input.name != 'nombre_comercial') {
          nombreComercial.setAttribute('disabled', true)
        }
        regimenFiscal.setAttribute('disabled', true)
        usoCfdi.setAttribute('disabled', true)
        representanteLegal.setAttribute('disabled', true)
        if (input.name != 'telefono_1') {
          telefono1.setAttribute('disabled', true)
        }
        if (input.name != 'telefono_2') {
          telefono2.setAttribute('disabled', true)
        }
        contacto.setAttribute('disabled', true)
        if (input.name != 'correo_general') {
          correoGeneral.setAttribute('disabled', true)
        }
        if (input.name != 'correo_pagos') {
          correoPagos.setAttribute('disabled', true)
        }
        sitioWeb.setAttribute('disabled', true)
        rubro.setAttribute('disabled', true)
        tipoOperacion.setAttribute('disabled', true)
        tipoTercero.setAttribute('disabled', true)
        idFiscal.setAttribute('disabled', true)
        agenteAduanal.setAttribute('disabled', true)
        fairTrade.setAttribute('disabled', true)
        diasCredito.setAttribute('disabled', true)
        montoCreditoMn.setAttribute('disabled', true)
        montoCreditoMe.setAttribute('disabled', true)
        retencionIva.setAttribute('disabled', true)
        retencionIsr.setAttribute('disabled', true)
        ivaFrontera.setAttribute('disabled', true)
        if (input.name != 'codigo_postal') {
          codigoPostal.setAttribute('disabled', true)
        }
        pais.setAttribute('disabled', true)
        estado.setAttribute('disabled', true)
        ciudad.setAttribute('disabled', true)
        municipio.setAttribute('disabled', true)
        localidad.setAttribute('disabled', true)
        colonia.setAttribute('disabled', true)
        calle.setAttribute('disabled', true)
        numeroExterior.setAttribute('disabled', true)
        numeroInterior.setAttribute('disabled', true)
        banco.setAttribute('disabled', true)
        cuenta.setAttribute('disabled', true)
        moneda.setAttribute('disabled', true)
        clabe.setAttribute('disabled', true)
        swift.setAttribute('disabled', true)
        otroCodigoBancario.setAttribute('disabled', true)
        btnAddBanco.setAttribute('disabled', true)
        banco2.setAttribute('disabled', true)
        cuenta2.setAttribute('disabled', true)
        moneda2.setAttribute('disabled', true)
        clabe2.setAttribute('disabled', true)
        swift2.setAttribute('disabled', true)
        otroCodigoBancario2.setAttribute('disabled', true)
        usarEnPortalProveedores.setAttribute('disabled', true)
        noAplicaParaRafaga.setAttribute('disabled', true)
        noRelacionarOc.setAttribute('disabled', true)
        constanciaSituacionFiscal.setAttribute('disabled', true)
        estadoCuentaBancario.setAttribute('disabled', true)
      }

      const enableAllFields = () => {
        esMigracion.removeAttribute('disabled')
        empresa.removeAttribute('disabled')
        contribuyente.removeAttribute('disabled')
        rfc.removeAttribute('disabled')
        if (contribuyente.value == 'Persona física') {
          curp.removeAttribute('disabled')
        }
        if (contribuyente.value == 'Persona moral') {
          regimenCapital.removeAttribute('disabled')
        }
        nombreFiscal.removeAttribute('disabled')
        nombreComercial.removeAttribute('disabled')
        regimenFiscal.removeAttribute('disabled')
        usoCfdi.removeAttribute('disabled')
        representanteLegal.removeAttribute('disabled')
        telefono1.removeAttribute('disabled')
        telefono2.removeAttribute('disabled')
        contacto.removeAttribute('disabled')
        correoGeneral.removeAttribute('disabled')
        correoPagos.removeAttribute('disabled')
        sitioWeb.removeAttribute('disabled')
        rubro.removeAttribute('disabled')
        tipoOperacion.removeAttribute('disabled')
        tipoTercero.removeAttribute('disabled')
        idFiscal.removeAttribute('disabled')
        agenteAduanal.removeAttribute('disabled')
        fairTrade.removeAttribute('disabled')
        diasCredito.removeAttribute('disabled')
        montoCreditoMn.removeAttribute('disabled')
        montoCreditoMe.removeAttribute('disabled')
        retencionIva.removeAttribute('disabled')
        retencionIsr.removeAttribute('disabled')
        ivaFrontera.removeAttribute('disabled')
        codigoPostal.removeAttribute('disabled')
        pais.removeAttribute('disabled')
        estado.removeAttribute('disabled')
        ciudad.removeAttribute('disabled')
        municipio.removeAttribute('disabled')
        localidad.removeAttribute('disabled')
        colonia.removeAttribute('disabled')
        calle.removeAttribute('disabled')
        numeroExterior.removeAttribute('disabled')
        numeroInterior.removeAttribute('disabled')
        banco.removeAttribute('disabled')
        cuenta.removeAttribute('disabled')
        moneda.removeAttribute('disabled')
        clabe.removeAttribute('disabled')
        swift.removeAttribute('disabled')
        otroCodigoBancario.removeAttribute('disabled')
        btnAddBanco.removeAttribute('disabled')
        banco2.removeAttribute('disabled')
        cuenta2.removeAttribute('disabled')
        moneda2.removeAttribute('disabled')
        clabe2.removeAttribute('disabled')
        swift2.removeAttribute('disabled')
        otroCodigoBancario2.removeAttribute('disabled')
        usarEnPortalProveedores.removeAttribute('disabled')
        noAplicaParaRafaga.removeAttribute('disabled')
        noRelacionarOc.removeAttribute('disabled')
        constanciaSituacionFiscal.removeAttribute('disabled')
        estadoCuentaBancario.removeAttribute('disabled')
      }

      function enableSaveButton() {
        if(esMigracion.checked) {
          if(errorEmpresaOrigen.style.display == 'block' || errorEmpresaDestino.style.display == 'block' || errorEmpresasMigracion.style.display == 'block' || errorRfcMigracion.style.display == 'block' || errorRfcMigracion2.style.display == 'block') {
            btnGuardar.disabled = true
            btnBorrador.disabled = true
          }
          else {
            btnGuardar.disabled = false
            btnBorrador.disabled = false
          }
        }
        else {
          if (errorEmpresa.style.display == 'block' || errorContribuyente.style.display == 'block' || errorRfc.style.display == 'block' || errorRfc2.style.display == 'block' || errorCurp.style.display == 'block' || errorRegimenCapital.style.display == 'block' || errorNombreFiscal.style.display == 'block' || errorNombreFiscal2.style.display == 'block' || errorNombreComercial.style.display == 'block' || errorNombreComercial2.style.display == 'block' || errorRegimenFiscal.style.display == 'block' || errorUsoCfdi.style.display == 'block' || errorRepresentanteLegal.style.display == 'block' || errorTelefono1.style.display == 'block' ||errorTelefono2.style.display == 'block' || errorContacto.style.display == 'block' || errorCorreoGeneral.style.display == 'block' || errorCorreoPagos.style.display == 'block' || errorSitioWeb.style.display == 'block' || errorRubro.style.display == 'block' || errorTipoOperacion.style.display == 'block' || errorIdFiscal.style.display == 'block' || errorAgenteAduanal.style.display == 'block' || errorFairTrade.style.display == 'block' || errorDiasCredito.style.display == 'block' || errorMontoCreditoMn.style.display == 'block' || errorMontoCreditoMe.style.display == 'block' || errorRetencionIva.style.display == 'block' || errorRetencionIsr.style.display == 'block' || errorIvaFrontera.style.display == 'block' || errorCodigoPostal.style.display == 'block' || errorPais.style.display == 'block' || errorEstado.style.display == 'block' || errorCiudad.style.display == 'block' || errorMunicipio.style.display == 'block' || errorLocalidad.style.display == 'block' || errorColonia.style.display == 'block' || errorCalle.style.display == 'block' || errorNumeroExterior.style.display == 'block' || errorNumeroInterior.style.display == 'block' || errorBanco.style.display == 'block' || errorCuenta.style.display == 'block' || errorMoneda.style.display == 'block' || errorClabe.style.display == 'block' || errorBanco2.style.display == 'block' || errorCuenta2.style.display == 'block' || errorMoneda2.style.display == 'block' || errorClabe2.style.display == 'block') {
            btnGuardar.disabled = true
            btnBorrador.disabled = true
          }
          else {
            btnGuardar.disabled = false
            btnBorrador.disabled = false
          }
        }
      }

      const handleBorradorSubmit = () => {
        tipoAlta.removeAttribute('disabled')
        empresaOrigen.removeAttribute('required')
        empresaDestino.removeAttribute('required')
        rfcMigracion.removeAttribute('required')
        empresa.removeAttribute('required')
        contribuyente.removeAttribute('required')
        rfc.removeAttribute('required')
        curp.removeAttribute('required')
        regimenCapital.removeAttribute('required')
        nombreFiscal.removeAttribute('required')
        nombreComercial.removeAttribute('required')
        regimenFiscal.removeAttribute('required')
        usoCfdi.removeAttribute('required')
        telefono1.removeAttribute('required')
        correoGeneral.removeAttribute('required')
        correoPagos.removeAttribute('required')
        sitioWeb.removeAttribute('required')
        rubro.removeAttribute('required')
        tipoOperacion.removeAttribute('required')
        tipoTercero.removeAttribute('required')
        idFiscal.removeAttribute('required')
        agenteAduanal.removeAttribute('required')
        fairTrade.removeAttribute('required')
        diasCredito.removeAttribute('required')
        montoCreditoMn.removeAttribute('required')
        montoCreditoMe.removeAttribute('required')
        retencionIva.removeAttribute('required')
        retencionIsr.removeAttribute('required')
        ivaFrontera.removeAttribute('required')
        codigoPostal.removeAttribute('required')
        pais.removeAttribute('required')
        estado.removeAttribute('required')
        ciudad.removeAttribute('required')
        municipio.removeAttribute('required')
        localidad.removeAttribute('required')
        colonia.removeAttribute('required')
        calle.removeAttribute('required')
        numeroExterior.removeAttribute('required')
        banco.removeAttribute('required')
        cuenta.removeAttribute('required')
        moneda.removeAttribute('required')
        clabe.removeAttribute('required')
        banco2.removeAttribute('required')
        cuenta2.removeAttribute('required')
        moneda2.removeAttribute('required')
        clabe2.removeAttribute('required')
      }

      btnBorrador.addEventListener('click', () => {
        handleBorradorSubmit()
      })

      btnGuardar.addEventListener('click', () => {
        tipoAlta.removeAttribute('disabled')
        // Si es migración, se envia directo a sistemas
        if (esMigracion.checked) {
          btnGuardar.setAttribute('name', 'finanzas');
        }
        else {
          // Clientes no pasan por compras
          if (tipoAlta.value == 'Cliente') {
            btnGuardar.setAttribute('name', 'compras');
          }
          else {
            btnGuardar.setAttribute('name', 'pendiente');
          }
        }
      })
    })
  </script>
{% endblock %}
