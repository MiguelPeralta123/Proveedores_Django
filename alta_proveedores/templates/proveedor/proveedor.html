{% extends 'base.html' %}

{% block content %}

<main class="py-5 m-5">
    <div class="row mt-5 justify-content-center">
        <div style="max-width: 40rem;">
            <h1 class="text-center font-weight-bold text-green">Solicitudes de proveedores</h1>

            {% if current_user.compras == False and current_user.finanzas == False and current_user.sistemas == False %}
                <div id="filtrar-solicitudes-container" class="d-flex justify-content-between gap-2 mt-5">
                    <button id="btn-filtrar-todas" class="btn btn-secondary btn-filtrar" style="background-color: green;">Todas</button>
                    <button id="btn-filtrar-pendientes" class="btn btn-secondary btn-filtrar" style="background-color: green;">Pendientes</button>
                    <button id="btn-filtrar-rechazadas" class="btn btn-secondary btn-filtrar" style="background-color: green;">Rechazadas</button>
                    <button id="btn-filtrar-aprobadas" class="btn btn-secondary btn-filtrar" style="background-color: green;">Aprobadas</button>
                    <button id="btn-filtrar-eliminadas" class="btn btn-secondary btn-filtrar" style="background-color: green;">Eliminadas</button>
                </div>
            {% endif %}

            <ul id="proveedores-list" style="list-style-type: none;" class="list-group mt-4">
                {% for proveedor in proveedores %}
                    <a class="list-group-item my-3 border rounded provider-card" 
                        href="{% url 'proveedor_detail' proveedor.id %}"
                        style="transition: 0.2s ease-in-out;">
                        <div class="d-flex justify-content-between gap-3 my-2">
                            {% if proveedor.nombre_comercial != '' %}
                                <h4 class="my-0">{{proveedor.nombre_comercial}}</h4>
                            {% else %}
                                <h4 class="my-0">Migraci√≥n - {{proveedor.rfc_migracion}}</h4>
                            {% endif %}
                            <p class="mt-1"><b>Folio solicitud:</b> {{proveedor.id}}</p>
                        </div>
                        <p><b>Solicitante:</b> {{proveedor.usuario.get_full_name}}</p>
                        <div class="d-flex justify-content-between gap-3">
                            {% if proveedor.empresa != '' %}
                                <p><b>Empresa:</b> {{proveedor.empresa}}</p>
                            {% else %}
                                <p><b>Empresa:</b> {{proveedor.empresa_destino}}</p>
                            {% endif %}
                            <p><b>Fecha:</b> {{proveedor.fecha}}</p>
                        </div>
                        {% if proveedor.pendiente %}
                        <p class="text-success">üïê Pendiente aprobaci√≥n</p>
                        {% endif %}
                        {% if proveedor.compras %}
                        <p class="text-success">‚úÖ Aprobado por compras</p>
                        {% endif %}
                        {% if proveedor.rechazado_compras %}
                        <p class="text-success">‚ùå Rechazado por compras</p>
                        <p class="text-danger"><b>Comentario:</b> {{proveedor.comentarios}}</p>
                        {% endif %}
                        {% if proveedor.finanzas %}
                        <p class="text-success">‚úÖ Aprobado por finanzas</p>
                        {% endif %}
                        {% if proveedor.rechazado_finanzas %}
                        <p class="text-success">‚ùå Rechazado por finanzas</p>
                        <p class="text-danger"><b>Comentario:</b> {{proveedor.comentarios}}</p>
                        {% endif %}
                        {% if proveedor.sistemas %}
                        <p class="text-success">‚úÖ Aprobado por sistemas</p>
                        {% endif %}
                        {% if proveedor.rechazado_sistemas %}
                        <p class="text-success">‚ùå Rechazado por sistemas</p>
                        <p class="text-danger"><b>Comentario:</b> {{proveedor.comentarios}}</p>
                        {% endif %}

                        {% for cambio in historial %}
                            {% if proveedor.id == cambio.id_proveedor %}
                                <p style="margin-right: 3rem; font-size: 0.8rem; color: gray;"><i class="d-flex justify-content-between gap-3"><span>üî∏{{cambio}}</span><span>{{cambio.fecha}}</span></i></p>
                            {% endif %}
                        {% endfor %}
                    </a>
                {% endfor %}
            </ul>

            {% if current_user.compras == False and current_user.finanzas == False and current_user.sistemas == False %}
                <ul id="proveedores-pendientes-list" style="list-style-type: none; display: none;" class="list-group mt-4">
                    {% for proveedor in proveedores_pendientes %}
                        <a class="list-group-item my-3 border rounded provider-card" 
                            href="{% url 'proveedor_detail' proveedor.id %}"
                            style="transition: 0.2s ease-in-out;">
                            <div class="d-flex justify-content-between gap-3 my-2">
                                {% if proveedor.nombre_comercial != '' %}
                                    <h4 class="my-0">{{proveedor.nombre_comercial}}</h4>
                                {% else %}
                                    <h4 class="my-0">Migraci√≥n - {{proveedor.rfc_migracion}}</h4>
                                {% endif %}
                                <p class="mt-1"><b>Folio solicitud:</b> {{proveedor.id}}</p>
                            </div>
                            <p><b>Solicitante:</b> {{proveedor.usuario.get_full_name}}</p>
                            <div class="d-flex justify-content-between gap-3">
                                {% if proveedor.empresa != '' %}
                                    <p><b>Empresa:</b> {{proveedor.empresa}}</p>
                                {% else %}
                                    <p><b>Empresa:</b> {{proveedor.empresa_destino}}</p>
                                {% endif %}
                                <p><b>Fecha:</b> {{proveedor.fecha}}</p>
                            </div>
                            {% if proveedor.pendiente %}
                            <p class="text-success">üïê Pendiente aprobaci√≥n</p>
                            {% endif %}
                            {% if proveedor.compras %}
                            <p class="text-success">‚úÖ Aprobado por compras</p>
                            {% endif %}
                            {% if proveedor.rechazado_compras %}
                            <p class="text-success">‚ùå Rechazado por compras</p>
                            <p class="text-danger"><b>Comentario:</b> {{proveedor.comentarios}}</p>
                            {% endif %}
                            {% if proveedor.finanzas %}
                            <p class="text-success">‚úÖ Aprobado por finanzas</p>
                            {% endif %}
                            {% if proveedor.rechazado_finanzas %}
                            <p class="text-success">‚ùå Rechazado por finanzas</p>
                            <p class="text-danger"><b>Comentario:</b> {{proveedor.comentarios}}</p>
                            {% endif %}
                            {% if proveedor.sistemas %}
                            <p class="text-success">‚úÖ Aprobado por sistemas</p>
                            {% endif %}
                            {% if proveedor.rechazado_sistemas %}
                            <p class="text-success">‚ùå Rechazado por sistemas</p>
                            <p class="text-danger"><b>Comentario:</b> {{proveedor.comentarios}}</p>
                            {% endif %}

                            {% for cambio in historial %}
                                {% if proveedor.id == cambio.id_proveedor %}
                                    <p style="margin-right: 3rem; font-size: 0.8rem; color: gray;"><i class="d-flex justify-content-between gap-3"><span>üî∏{{cambio}}</span><span>{{cambio.fecha}}</span></i></p>
                                {% endif %}
                            {% endfor %}
                        </a>
                    {% endfor %}
                </ul>

                <ul id="proveedores-rechazados-list" style="list-style-type: none; display: none;" class="list-group mt-4">
                    {% for proveedor in proveedores_rechazados %}
                        <a class="list-group-item my-3 border rounded provider-card" 
                            href="{% url 'proveedor_detail' proveedor.id %}"
                            style="transition: 0.2s ease-in-out;">
                            <div class="d-flex justify-content-between gap-3 my-2">
                                {% if proveedor.nombre_comercial != '' %}
                                    <h4 class="my-0">{{proveedor.nombre_comercial}}</h4>
                                {% else %}
                                    <h4 class="my-0">Migraci√≥n - {{proveedor.rfc_migracion}}</h4>
                                {% endif %}
                                <p class="mt-1"><b>Folio solicitud:</b> {{proveedor.id}}</p>
                            </div>
                            <p><b>Solicitante:</b> {{proveedor.usuario.get_full_name}}</p>
                            <div class="d-flex justify-content-between gap-3">
                                {% if proveedor.empresa != '' %}
                                    <p><b>Empresa:</b> {{proveedor.empresa}}</p>
                                {% else %}
                                    <p><b>Empresa:</b> {{proveedor.empresa_destino}}</p>
                                {% endif %}
                                <p><b>Fecha:</b> {{proveedor.fecha}}</p>
                            </div>
                            {% if proveedor.pendiente %}
                            <p class="text-success">üïê Pendiente aprobaci√≥n</p>
                            {% endif %}
                            {% if proveedor.compras %}
                            <p class="text-success">‚úÖ Aprobado por compras</p>
                            {% endif %}
                            {% if proveedor.rechazado_compras %}
                            <p class="text-success">‚ùå Rechazado por compras</p>
                            <p class="text-danger"><b>Comentario:</b> {{proveedor.comentarios}}</p>
                            {% endif %}
                            {% if proveedor.finanzas %}
                            <p class="text-success">‚úÖ Aprobado por finanzas</p>
                            {% endif %}
                            {% if proveedor.rechazado_finanzas %}
                            <p class="text-success">‚ùå Rechazado por finanzas</p>
                            <p class="text-danger"><b>Comentario:</b> {{proveedor.comentarios}}</p>
                            {% endif %}
                            {% if proveedor.sistemas %}
                            <p class="text-success">‚úÖ Aprobado por sistemas</p>
                            {% endif %}
                            {% if proveedor.rechazado_sistemas %}
                            <p class="text-success">‚ùå Rechazado por sistemas</p>
                            <p class="text-danger"><b>Comentario:</b> {{proveedor.comentarios}}</p>
                            {% endif %}

                            {% for cambio in historial %}
                                {% if proveedor.id == cambio.id_proveedor %}
                                    <p style="margin-right: 3rem; font-size: 0.8rem; color: gray;"><i class="d-flex justify-content-between gap-3"><span>üî∏{{cambio}}</span><span>{{cambio.fecha}}</span></i></p>
                                {% endif %}
                            {% endfor %}
                        </a>
                    {% endfor %}
                </ul>

                <ul id="proveedores-aprobados-list" style="list-style-type: none; display: none;" class="list-group mt-4">
                    {% for proveedor in proveedores_aprobados %}
                        <a class="list-group-item my-3 border rounded provider-card" 
                            href="{% url 'proveedor_detail' proveedor.id %}"
                            style="transition: 0.2s ease-in-out;">
                            <div class="d-flex justify-content-between gap-3 my-2">
                                {% if proveedor.nombre_comercial != '' %}
                                    <h4 class="my-0">{{proveedor.nombre_comercial}}</h4>
                                {% else %}
                                    <h4 class="my-0">Migraci√≥n - {{proveedor.rfc_migracion}}</h4>
                                {% endif %}
                                <p class="mt-1"><b>Folio solicitud:</b> {{proveedor.id}}</p>
                            </div>
                            <p><b>Solicitante:</b> {{proveedor.usuario.get_full_name}}</p>
                            <div class="d-flex justify-content-between gap-3">
                                {% if proveedor.empresa != '' %}
                                    <p><b>Empresa:</b> {{proveedor.empresa}}</p>
                                {% else %}
                                    <p><b>Empresa:</b> {{proveedor.empresa_destino}}</p>
                                {% endif %}
                                <p><b>Fecha:</b> {{proveedor.fecha}}</p>
                            </div>
                            {% if proveedor.pendiente %}
                            <p class="text-success">üïê Pendiente aprobaci√≥n</p>
                            {% endif %}
                            {% if proveedor.compras %}
                            <p class="text-success">‚úÖ Aprobado por compras</p>
                            {% endif %}
                            {% if proveedor.rechazado_compras %}
                            <p class="text-success">‚ùå Rechazado por compras</p>
                            <p class="text-danger"><b>Comentario:</b> {{proveedor.comentarios}}</p>
                            {% endif %}
                            {% if proveedor.finanzas %}
                            <p class="text-success">‚úÖ Aprobado por finanzas</p>
                            {% endif %}
                            {% if proveedor.rechazado_finanzas %}
                            <p class="text-success">‚ùå Rechazado por finanzas</p>
                            <p class="text-danger"><b>Comentario:</b> {{proveedor.comentarios}}</p>
                            {% endif %}
                            {% if proveedor.sistemas %}
                            <p class="text-success">‚úÖ Aprobado por sistemas</p>
                            {% endif %}
                            {% if proveedor.rechazado_sistemas %}
                            <p class="text-success">‚ùå Rechazado por sistemas</p>
                            <p class="text-danger"><b>Comentario:</b> {{proveedor.comentarios}}</p>
                            {% endif %}

                            {% for cambio in historial %}
                                {% if proveedor.id == cambio.id_proveedor %}
                                    <p style="margin-right: 3rem; font-size: 0.8rem; color: gray;"><i class="d-flex justify-content-between gap-3"><span>üî∏{{cambio}}</span><span>{{cambio.fecha}}</span></i></p>
                                {% endif %}
                            {% endfor %}
                        </a>
                    {% endfor %}
                </ul>

                <ul id="proveedores-eliminados-list" style="list-style-type: none; display: none;" class="list-group mt-4">
                    {% for proveedor in proveedores_eliminados %}
                        <a class="list-group-item my-3 border rounded provider-card" 
                            href="{% url 'proveedor_detail' proveedor.id %}"
                            style="transition: 0.2s ease-in-out;">
                            <div class="d-flex justify-content-between gap-3 my-2">
                                {% if proveedor.nombre_comercial != '' %}
                                    <h4 class="my-0">{{proveedor.nombre_comercial}}</h4>
                                {% else %}
                                    <h4 class="my-0">Migraci√≥n - {{proveedor.rfc_migracion}}</h4>
                                {% endif %}
                                <p class="mt-1"><b>Folio solicitud:</b> {{proveedor.id}}</p>
                            </div>
                            <p><b>Solicitante:</b> {{proveedor.usuario.get_full_name}}</p>
                            <div class="d-flex justify-content-between gap-3">
                                {% if proveedor.empresa != '' %}
                                    <p><b>Empresa:</b> {{proveedor.empresa}}</p>
                                {% else %}
                                    <p><b>Empresa:</b> {{proveedor.empresa_destino}}</p>
                                {% endif %}
                                <p><b>Fecha:</b> {{proveedor.fecha}}</p>
                            </div>
                            {% if proveedor.pendiente %}
                            <p class="text-success">üïê Pendiente aprobaci√≥n</p>
                            {% endif %}
                            {% if proveedor.compras %}
                            <p class="text-success">‚úÖ Aprobado por compras</p>
                            {% endif %}
                            {% if proveedor.rechazado_compras %}
                            <p class="text-success">‚ùå Rechazado por compras</p>
                            <p class="text-danger"><b>Comentario:</b> {{proveedor.comentarios}}</p>
                            {% endif %}
                            {% if proveedor.finanzas %}
                            <p class="text-success">‚úÖ Aprobado por finanzas</p>
                            {% endif %}
                            {% if proveedor.rechazado_finanzas %}
                            <p class="text-success">‚ùå Rechazado por finanzas</p>
                            <p class="text-danger"><b>Comentario:</b> {{proveedor.comentarios}}</p>
                            {% endif %}
                            {% if proveedor.sistemas %}
                            <p class="text-success">‚úÖ Aprobado por sistemas</p>
                            {% endif %}
                            {% if proveedor.rechazado_sistemas %}
                            <p class="text-success">‚ùå Rechazado por sistemas</p>
                            <p class="text-danger"><b>Comentario:</b> {{proveedor.comentarios}}</p>
                            {% endif %}

                            {% for cambio in historial %}
                                {% if proveedor.id == cambio.id_proveedor %}
                                    <p style="margin-right: 3rem; font-size: 0.8rem; color: gray;"><i class="d-flex justify-content-between gap-3"><span>üî∏{{cambio}}</span><span>{{cambio.fecha}}</span></i></p>
                                {% endif %}
                            {% endfor %}
                        </a>
                    {% endfor %}
                </ul>
            {% endif %}
        </div>
    </div>
</main>

<style>
    .btn-filtrar,
    .provider-card {
        transition: 0.2s ease-in-out;
    }
    .btn-filtrar:hover {
        scale: 1.05;
    }
    .provider-card:hover {
      scale: 1.02;
      background-color: #f5f5f5;
    }
</style>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        // Containers
        const proveedoresList = document.getElementById("proveedores-list")
        const proveedoresPendientesList = document.getElementById("proveedores-pendientes-list")
        const proveedoresRechazadosList = document.getElementById("proveedores-rechazados-list")
        const proveedoresAprobadosList = document.getElementById("proveedores-aprobados-list")
        const proveedoresEliminadosList = document.getElementById("proveedores-eliminados-list")
        // Buttons
        const btnTodas = document.getElementById('btn-filtrar-todas')
        const btnPendientes = document.getElementById('btn-filtrar-pendientes')
        const btnRechazadas = document.getElementById('btn-filtrar-rechazadas')
        const btnAprobadas = document.getElementById('btn-filtrar-aprobadas')
        const btnEliminadas = document.getElementById('btn-filtrar-eliminadas')

        // List all requests from newest to oldest
        const proveedoresItems = Array.from(proveedoresList.children).reverse()
        proveedoresList.innerHTML = ""
        proveedoresItems.forEach(item => {
            proveedoresList.appendChild(item)
        });

        // List pending requests from newest to oldest
        const proveedoresPendientesItems = Array.from(proveedoresPendientesList.children).reverse()
        proveedoresPendientesList.innerHTML = ""
        proveedoresPendientesItems.forEach(item => {
            proveedoresPendientesList.appendChild(item)
        });

        // List declined requests from newest to oldest
        const proveedoresRechazadosItems = Array.from(proveedoresRechazadosList.children).reverse()
        proveedoresRechazadosList.innerHTML = ""
        proveedoresRechazadosItems.forEach(item => {
            proveedoresRechazadosList.appendChild(item)
        });

        // List approved requests from newest to oldest
        const proveedoresAprobadosItems = Array.from(proveedoresAprobadosList.children).reverse()
        proveedoresAprobadosList.innerHTML = ""
        proveedoresAprobadosItems.forEach(item => {
            proveedoresAprobadosList.appendChild(item)
        });

        // List deleted requests from newest to oldest
        const proveedoresEliminadosItems = Array.from(proveedoresEliminadosList.children).reverse()
        proveedoresEliminadosList.innerHTML = ""
        proveedoresEliminadosItems.forEach(item => {
            proveedoresEliminadosList.appendChild(item)
        });

        // Filter items by status
        if (btnTodas) {
            btnTodas.addEventListener('click', () => {
                proveedoresList.style.display = 'block'
                proveedoresPendientesList.style.display = 'none'
                proveedoresRechazadosList.style.display = 'none'
                proveedoresAprobadosList.style.display = 'none'
                proveedoresEliminadosList.style.display = 'none'
            })
        }

        if (btnPendientes) {
            btnPendientes.addEventListener('click', () => {
                proveedoresList.style.display = 'none'
                proveedoresPendientesList.style.display = 'block'
                proveedoresRechazadosList.style.display = 'none'
                proveedoresAprobadosList.style.display = 'none'
                proveedoresEliminadosList.style.display = 'none'
            })
        }

        if (btnRechazadas) {
            btnRechazadas.addEventListener('click', () => {
                proveedoresList.style.display = 'none'
                proveedoresPendientesList.style.display = 'none'
                proveedoresRechazadosList.style.display = 'block'
                proveedoresAprobadosList.style.display = 'none'
                proveedoresEliminadosList.style.display = 'none'
            })
        }

        if (btnAprobadas) {
            btnAprobadas.addEventListener('click', () => {
                proveedoresList.style.display = 'none'
                proveedoresPendientesList.style.display = 'none'
                proveedoresRechazadosList.style.display = 'none'
                proveedoresAprobadosList.style.display = 'block'
                proveedoresEliminadosList.style.display = 'none'
            })
        }

        if (btnEliminadas) {
            btnEliminadas.addEventListener('click', () => {
                proveedoresList.style.display = 'none'
                proveedoresPendientesList.style.display = 'none'
                proveedoresRechazadosList.style.display = 'none'
                proveedoresAprobadosList.style.display = 'none'
                proveedoresEliminadosList.style.display = 'block'
            })
        }
    });
</script>

{% endblock %}