{% extends 'base.html' %}

{% block content %}
  <main class="pt-5 m-5">
    <div class="row mt-5 justify-content-center">
      <div style="max-width: 40rem;">
        <form class="card card-body" method="POST" enctype="multipart/form-data" style="background-color: rgb(255, 255, 255, 0.8);">

          {% if proveedor.es_migracion %}
            <h1 class="mb-4">Detalle del registro</h1>
          {% else %}
            <h1 class="mb-4">Detalle del {{ proveedor.tipo_alta }}</h1>
          {% endif %}

          {{ error }}

          {% csrf_token %}

          <div style="display: none;">
            {{ form.es_migracion.label_tag }}
            {{ form.es_migracion }}
            <p id="error-es-migracion" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Seleccione una opción válida</p>
          </div>

          {% if proveedor.es_migracion %}
            <!-- Proveedor migración fields -->
            <h2 style="margin-bottom: 2rem;">Migración - {{ proveedor.rfc_migracion }}</h2>

            <div id="proveedor-migracion-empresas" style="display: flex; gap: 1rem;">
              <!-- Empresa origen -->
              <div style="width: 100%;">
                <p class="m-0">{{ form.empresa_origen.label_tag }}<span style="color: rgb(192, 0, 0);">*</span></p>
                {{ form.empresa_origen }}
                <p id="error-empresa-origen" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Seleccione una opción válida</p>
              </div>

              <!-- Empresa destino -->
              <div style="width: 100%;">
                <p class="m-0">{{ form.empresa_destino.label_tag }}<span style="color: rgb(192, 0, 0);">*</span></p>
                {{ form.empresa_destino }}
                <p id="error-empresa-destino" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Seleccione una opción válida</p>
              </div>
            </div>

            <p id="error-empresas-migracion" class="mt-0 mb-2" style="color:red; display:none;">Empresa origen y Empresa destino deben tener valores distintos</p>

            <!-- RFC migracion field -->
            <div class="mt-3 mb-3">
              <label for="id_rfc_migracion">RFC:<span style="color: rgb(192, 0, 0);">*</span></label>
              {{ form.rfc_migracion }}
              <datalist id="opciones_proveedor">
              </datalist>
              <p id="error-rfc-migracion" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Ingrese un RFC válido</p>
              <p id="error-rfc-migracion-2" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">No existe ningún proveedor con ese RFC</p>
            </div>

          {% else %}

            <!-- Proveedor nuevo fields -->
            <h2 style="margin-bottom: 2rem;">{{ proveedor.nombre_comercial }}</h2>

            <!-- Empresa field -->
            <div style="margin-bottom:1rem;">
              <p class="m-0">{{ form.empresa.label_tag }}<span style="color: rgb(192, 0, 0);">*</span></p>
              {{ form.empresa }}
              <p id="error-empresa" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Seleccione una opción válida</p>
            </div>

            <div style="display: flex; gap: 1rem;">
              <!-- Tipo alta field -->
              <div style="width: 100%; margin-bottom:1rem;">
                <p class="m-0">{{ form.tipo_alta.label_tag }}<span style="color: rgb(192, 0, 0);">*</span></p>
                {{ form.tipo_alta }}
                <p id="error-tipo-alta" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Seleccione una opción válida</p>
              </div>

              <!-- Contribuyente field -->
              <div style="width: 100%; margin-bottom:1rem;">
                <p class="m-0">{{ form.contribuyente.label_tag }}<span style="color: rgb(192, 0, 0);">*</span></p>
                {{ form.contribuyente }}
                <p id="error-contribuyente" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Seleccione una opción válida</p>
              </div>
            </div>

            <div style="display: flex; gap: 1rem;">
              <!-- RFC field -->
              <div style="width: 100%; margin-bottom:1rem;">
                <label for="id_rfc">RFC:<span style="color: rgb(192, 0, 0);">*</span></label>
                {{ form.rfc }}
                <datalist id="opciones_proveedor">
                </datalist>
                <p id="error-rfc" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Ingrese un RFC válido</p>
                <p id="error-rfc-2" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Ya existe un proveedor con ese RFC</p>
              </div>

              <!-- CURP field -->
              <div style="width: 100%; margin-bottom:1rem;">
                <label for="id_curp">CURP:</label>
                {{ form.curp }}
                <p id="error-curp" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Ingrese una CURP válida</p>
              </div>
            </div>

            <!-- Nombre fiscal field -->
            <div style="margin-bottom:1rem;">
              <p class="m-0">{{ form.nombre_fiscal.label_tag }}<span style="color: rgb(192, 0, 0);">*</span> <span style="font-size: 0.8rem; font-style: italic;">(No se permiten acentos, carácteres especiales ni ñ)</span></p>
              {{ form.nombre_fiscal }}
              <p id="error-nombre-fiscal" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Este campo es requerido</p>
              <p id="error-nombre-fiscal-2" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Nombre fiscal no puede contener acentos, carácteres especiales ni ñ</p>
            </div>

            <!-- Regimen de capital field -->
            <div style="margin-bottom:1rem;">
              <label for="id_regimen_capital">Régimen de capital:<span style="color: rgb(192, 0, 0);">*</span></label>
              {{ form.regimen_capital }}
              <p id="error-regimen-capital" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Seleccione una opción válida</p>
            </div>

            <!-- Nombre comercial field -->
            <div style="margin-bottom:1rem;">
              <p class="m-0">{{ form.nombre_comercial.label_tag }}<span style="color: rgb(192, 0, 0);">*</span> <span style="font-size: 0.8rem; font-style: italic;">(No se permiten acentos, carácteres especiales ni ñ)</span></p>
              {{ form.nombre_comercial }}
              <p id="error-nombre-comercial" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Este campo es requerido</p>
              <p id="error-nombre-comercial-2" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Nombre comercial no puede contener acentos, carácteres especiales ni ñ</p>
            </div>

            <!-- Regimen fiscal field -->
            <div style="margin-bottom:1rem;">
              <label for="id_regimen_fiscal">Régimen fiscal:<span style="color: rgb(192, 0, 0);">*</span></label>
              {{ form.regimen_fiscal }}
              <p id="error-regimen-fiscal" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Seleccione una opción válida</p>
            </div>

            <!-- Uso CFDI field -->
            <div style="margin-bottom:1rem;">
              <label for="id_uso_cfdi">Uso CFDI:<span style="color: rgb(192, 0, 0);">*</span></label>
              {{ form.uso_cfdi }}
              <p id="error-uso-cfdi" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Seleccione una opción válida</p>
            </div>

            <div style="display: flex; gap: 1rem;">
              <!-- Telefono 1 field -->
              <div style="width: 100%; margin-bottom:1rem;">
                <label for="id_telefono_1">Teléfono 1:<span style="color: rgb(192, 0, 0);">*</span></label>
                {{ form.telefono_1 }}
                <p id="error-telefono-1" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Ingrese un número telefónico válido</p>
              </div>

              <!-- Telefono 2 field -->
              <div style="width: 100%; margin-bottom:1rem;">
                <label for="id_telefono_2">Teléfono 2:<span style="color: rgb(192, 0, 0);">*</span></label>
                {{ form.telefono_2 }}
                <p id="error-telefono-2" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Ingrese un número telefónico válido</p>
              </div>
            </div>

            <div style="display: flex; gap: 1rem;">
              <!-- Representante legal field -->
              <div style="width: 100%; margin-bottom:1rem;">
                {{ form.representante_legal.label_tag }}
                {{ form.representante_legal }}
                <p id="error-representante-legal" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Este campo es requerido</p>
              </div>

              <!-- Contacto field -->
              <div style="width: 100%; margin-bottom:1rem;">
                {{ form.contacto.label_tag }}
                {{ form.contacto }}
                <p id="error-contacto" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Este campo es requerido</p>
              </div>
            </div>

            <div style="display: flex; gap: 1rem;">
              <!-- Correo general field -->
              <div style="width: 100%; margin-bottom:1rem;">
                <p class="m-0">{{ form.correo_general.label_tag }}<span style="color: rgb(192, 0, 0);">*</span></p>
                {{ form.correo_general }}
                <p id="error-correo-general" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Ingrese un correo electrónico válido</p>
              </div>

              <!-- Correo pagos field -->
              <div style="width: 100%; margin-bottom:1rem;">
                <p class="m-0">{{ form.correo_pagos.label_tag }}<span style="color: rgb(192, 0, 0);">*</span></p>
                {{ form.correo_pagos }}
                <p id="error-correo-pagos" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Ingrese un correo electrónico válido</p>
              </div>
            </div>

            <div style="display: flex; gap: 1rem;">
              <!-- Sitio web field -->
              <div style="width: 100%; margin-bottom:1rem;">
                {{ form.sitio_web.label_tag }}
                {{ form.sitio_web }}
                <p id="error-sitio-web" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Este campo es requerido</p>
              </div>

              <!-- Rubro field -->
              <div style="width: 100%; margin-bottom:1rem;">
                <label for="id_rubro">Grupo / Rubro:<span style="color: rgb(192, 0, 0);">*</span></label>
                {{ form.rubro }}
                <p id="error-rubro" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Seleccione una opción válida</p>
              </div>
            </div>

            <div style="display: flex; gap: 1rem;">
              <!-- Tipo operacion field -->
              <div style="width: 100%; margin-bottom:1rem;">
                <label for="id_tipo_operacion">Tipo operación:<span style="color: rgb(192, 0, 0);">*</span></label>
                {{ form.tipo_operacion }}
                <p id="error-tipo-operacion" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Seleccione una opción válida</p>
              </div>

              <!-- Tipo tercero field -->
              <div style="width: 100%; margin-bottom:1rem;">
                <p class="m-0">{{ form.tipo_tercero.label_tag }}<span style="color: rgb(192, 0, 0);">*</span></p>
                {{ form.tipo_tercero }}
                <p id="error-tipo-tercero" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Seleccione una opción válida</p>
              </div>
            </div>

            <div style="display: flex; gap: 1rem; align-items: center;">
              <!-- id fiscal field -->
              <div style="width: 100%; margin-bottom:1rem;">
                <label for="id_id_fiscal">ID fiscal:</label>
                {{ form.id_fiscal }}
                <p id="error-id-fiscal" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Este campo es requerido</p>
              </div>

              <!-- Agente aduanal field -->
              <div style="width: 100%; margin-bottom:1rem;">
                <p class="m-0">{{ form.agente_aduanal.label_tag }}<span style="color: rgb(192, 0, 0);">*</span></p>
                {{ form.agente_aduanal }}
                <p id="error-agente-aduanal" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Seleccione una opción válida</p>
              </div>

              <!-- Identificación Fair Trade field -->
              {% if proveedor.tipo_alta == 'Cliente' %}
                <div style="width: 100%; margin-bottom:1rem;">
                  <p class="m-0">Identificación Fair Trade<span style="color: rgb(192, 0, 0);">*</span></p>
                  {{ form.fair_trade }}
                  <p id="error-fair-trade" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Este campo es requerido</p>
                </div>
              {% endif %}
            </div>

            <div style="display: flex; gap: 1rem;">
              <!-- Dias credito field -->
              <div style="width: 100%; margin-bottom:1rem;">
                <label for="id_dias_credito">Días crédito:<span style="color: rgb(192, 0, 0);">*</span></label>
                {{ form.dias_credito }}
                <p id="error-dias-credito" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Debe ingresar un valor numérico</p>
              </div>

              <!-- Monto credito (moneda nacional) field -->
              <div style="width: 100%; margin-bottom:1rem;">
                <label for="id_monto_credito_mn">Monto crédito MN:<span style="color: rgb(192, 0, 0);">*</span></label>
                {{ form.monto_credito_mn }}
                <p id="error-monto-credito-mn" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Debe ingresar un valor numérico</p>
              </div>

              <!-- Monto credito (moneda extranjera) field -->
              <div style="width: 100%; margin-bottom:1rem;">
                <label for="id_monto_credito_me">Monto crédito ME:<span style="color: rgb(192, 0, 0);">*</span></label>
                {{ form.monto_credito_me }}
                <p id="error-monto-credito-me" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Debe ingresar un valor numérico</p>
              </div>
            </div>

            <div style="display: flex; gap: 1rem;">
              <!-- Retencion iva field -->
              <div style="width: 100%; margin-bottom:1rem;">
                <label for="id_retencion_iva">Retención IVA:<span style="color: rgb(192, 0, 0);">*</span></label>
                {{ form.retencion_iva }}
                <p id="error-retencion-iva" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Seleccione una opción válida</p>
              </div>

              <!-- Retencion isr field -->
              <div style="width: 100%; margin-bottom:1rem;">
                <label for="id_retencion_isr">Retención ISR:<span style="color: rgb(192, 0, 0);">*</span></label>
                {{ form.retencion_isr }}
                <p id="error-retencion-isr" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Seleccione una opción válida</p>
              </div>

              <!-- Iva frontera field -->
              <div style="width: 100%; margin-bottom:1rem;">
                <label for="id_iva_frontera">IVA frontera:<span style="color: rgb(192, 0, 0);">*</span></label>
                {{ form.iva_frontera }}
                <p id="error-iva-frontera" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Seleccione una opción válida</p>
              </div>
            </div>

            <div style="display: flex; gap: 1rem;">
              <!-- Codigo postal field -->
              <div style="width: 100%; margin-bottom:1rem;">
                <label for="id_codigo_postal">Código postal:<span style="color: rgb(192, 0, 0);">*</span></label>
                {{ form.codigo_postal }}
                <p id="error-codigo-postal" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Ingrese un código postal válido</p>
              </div>

              <!-- Pais field -->
              <div style="width: 100%; margin-bottom:1rem;">
                <label for="id_pais">País:<span style="color: rgb(192, 0, 0);">*</span></label>
                {{ form.pais }}
                <p id="error-pais" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Este campo es requerido</p>
              </div>
            </div>

            <div style="display: flex; gap: 1rem;">
              <!-- Estado field -->
              <div style="width: 100%; margin-bottom:1rem;">
                <p class="m-0">{{ form.estado.label_tag }}<span style="color: rgb(192, 0, 0);">*</span></p>
                {{ form.estado }}
                <p id="error-estado" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Este campo es requerido</p>
              </div>

              <!-- Ciudad field -->
              <div style="width: 100%; margin-bottom:1rem;">
                <p class="m-0">{{ form.ciudad.label_tag }}<span style="color: rgb(192, 0, 0);">*</span></p>
                {{ form.ciudad }}
                <p id="error-ciudad" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Este campo es requerido</p>
              </div>
            </div>

            <div style="display: flex; gap: 1rem;">
              <!-- Municipio field -->
              <div style="width: 100%; margin-bottom:1rem;">
                <p class="m-0">{{ form.municipio.label_tag }}<span style="color: rgb(192, 0, 0);">*</span></p>
                {{ form.municipio }}
                <p id="error-municipio" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Este campo es requerido</p>
              </div>

              <!-- Localidad field -->
              <div style="width: 100%; margin-bottom:1rem;">
                <p class="m-0">{{ form.localidad.label_tag }}<span style="color: rgb(192, 0, 0);">*</span></p>
                {{ form.localidad }}
                <p id="error-localidad" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Este campo es requerido</p>
              </div>
            </div>

            <!-- Colonia field -->
            <div style="margin-bottom:1rem;">
              <p class="m-0">{{ form.colonia.label_tag }}<span style="color: rgb(192, 0, 0);">*</span></p>
              {{ form.colonia }}
              <p id="error-colonia" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Este campo es requerido</p>
            </div>

            <!-- Calle field -->
            <div style="margin-bottom:1rem;">
              <p class="m-0">{{ form.calle.label_tag }}<span style="color: rgb(192, 0, 0);">*</span></p>
              {{ form.calle }}
              <p id="error-calle" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Este campo es requerido</p>
            </div>

            <div style="display: flex; gap: 1rem;">
              <!-- Numero exterior field -->
              <div style="width: 50%; margin-bottom:1rem;">
                <label for="id_numero_exterior">Número exterior:<span style="color: rgb(192, 0, 0);">*</span></label>
                {{ form.numero_exterior }}
                <p id="error-numero-exterior" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Este campo es requerido</p>
              </div>

              <!-- Numero interior field -->
              <div style="width: 50%; margin-bottom:1rem;">
                <label for="id_numero_interior">Número interior:</label>
                {{ form.numero_interior }}
                <p id="error-numero-interior" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Este campo es requerido</p>
              </div>
            </div>

            <!-- Banco field -->
            <div style="margin-bottom:1rem;">
              <p class="m-0">{{ form.banco.label_tag }}<span style="color: rgb(192, 0, 0);">*</span></p>
              {{ form.banco }}
              <p id="error-banco" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Seleccione una opción válida</p>
            </div>

            <div style="display: flex; gap: 1rem;">
              <!-- Cuenta field -->
              <div style="width: 40%; margin-bottom:1rem;">
                <p class="m-0">{{ form.cuenta.label_tag }}<span style="color: rgb(192, 0, 0);">*</span></p>
                {{ form.cuenta }}
                <p id="error-cuenta" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Ingrese un número de cuenta a 10 dígitos</p>
              </div>

              <!-- Clabe field -->
              <div style="width: 40%; margin-bottom:1rem;">
                <p class="m-0">{{ form.clabe.label_tag }}<span style="color: rgb(192, 0, 0);">*</span></p>
                {{ form.clabe }}
                <p id="error-clabe" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Ingrese un número de cuenta a 18 dígitos</p>
              </div>

              <!-- Moneda field -->
              <div style="width: 20%; margin-bottom:1rem;">
                <p class="m-0">{{ form.moneda.label_tag }}<span style="color: rgb(192, 0, 0);">*</span></p>
                {{ form.moneda }}
                <p id="error-moneda" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Seleccione una opción válida</p>
              </div>
            </div>

            <div style="display: flex; gap: 1rem;">
              <!-- Swift field -->
              <div style="width: 50%; margin-bottom:1rem;">
                {{ form.swift.label_tag }}
                {{ form.swift }}
                <p id="error-swift" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Este campo es requerido</p>
              </div>

              <!-- Otro codigo bancario field -->
              <div style="width: 50%; margin-bottom:1rem;">
                <label for="id_otro_codigo_bancario">Otro código bancario:</label>
                {{ form.otro_codigo_bancario }}
                <p id="error-otro-codigo-bancario" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Este campo es requerido</p>
              </div>
            </div>

            <!-- Container for banco 2 fields -->
            <div id="banco-2-container" style="display:none;">
              <hr />
              <!-- Banco 2 field -->
              <div style="margin-bottom:1rem;">
                <label for="id_banco_2">Banco:<span style="color: rgb(192, 0, 0);">*</span></label>
                {{ form.banco_2 }}
                <p id="error-banco-2" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Seleccione una opción válida</p>
              </div>

              <div style="display: flex; gap: 1rem;">
                <!-- Cuenta 2 field -->
                <div style="width: 40%; margin-bottom:1rem;">
                  <label for="id_cuenta_2">Cuenta:<span style="color: rgb(192, 0, 0);">*</span></label>
                  {{ form.cuenta_2 }}
                  <p id="error-cuenta-2" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Ingrese un número de cuenta a 10 dígitos</p>
                </div>

                <!-- Clabe 2 field -->
                <div style="width: 40%; margin-bottom:1rem;">
                  <label for="id_clabe_2">Clabe:<span style="color: rgb(192, 0, 0);">*</span></label>
                  {{ form.clabe_2 }}
                  <p id="error-clabe-2" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Ingrese un número de cuenta a 18 dígitos</p>
                </div>

                <!-- Moneda 2 field -->
                <div style="width: 20%; margin-bottom:1rem;">
                  <label for="id_moneda_2">Moneda:<span style="color: rgb(192, 0, 0);">*</span></label>
                  {{ form.moneda_2 }}
                  <p id="error-moneda-2" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Seleccione una opción válida</p>
                </div>
              </div>

              <div style="display: flex; gap: 1rem;">
                <!-- Swift 2 field -->
                <div style="width: 50%; margin-bottom:1rem;">
                  <label for="id_swift_2">Swift:</label>
                  {{ form.swift_2 }}
                  <p id="error-swift_2" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Este campo es requerido</p>
                </div>
  
                <!-- Otro codigo bancario 2 field -->
                <div style="width: 50%; margin-bottom:1rem;">
                  <label for="id_otro_codigo_bancario_2">Otro código bancario:</label>
                  {{ form.otro_codigo_bancario_2 }}
                  <p id="error-otro-codigo-bancario_2" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Este campo es requerido</p>
                </div>
              </div>
            </div>

            <button class="btn btn-secondary mb-3" type="button" id="add-banco-2">Agregar otro banco</button>

            <div id="checkbox-container" style="display: flex; justify-content: space-between; gap: 2rem; margin-bottom:1rem;">
              <!-- Usar en portal proveedores field -->
              <div>
                <label for="id_usar_en_portal_proveedores">¿Usar en portal de prov.?</label>
                {{ form.usar_en_portal_proveedores }}
                <p id="error-usar-en-portal-proveedores" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Seleccione una opción válida</p>
              </div>

              <!-- No aplica para rafaga field -->
              <div>
                <label for="id_no_aplica_para_rafaga">No aplica para ráfaga:</label>
                {{ form.no_aplica_para_rafaga }}
                <p id="error-no-aplica-para-rafaga" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Seleccione una opción válida</p>
              </div>

              <!-- No relacionar OC field -->
              <div>
                {{ form.no_relacionar_OC.label_tag }}
                {{ form.no_relacionar_OC }}
                <p id="error-no-relacionar-OC" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Seleccione una opción válida</p>
              </div>
            </div>

          {% endif %}

          <!-- Documentos -->
          {% if proveedor.rechazado_compras or proveedor.rechazado_finanzas or proveedor.rechazado_sistemas or proveedor.pendiente and current_user.compras and proveedor.usuario.id == current_user.id or proveedor.compras and current_user.finanzas and proveedor.usuario.id == current_user.id or proveedor.finanzas and current_user.sistemas and proveedor.usuario.id == current_user.id %}
            <!-- Constancia situación fiscal field -->
            <div style="margin-bottom:1rem;">
              <label for="id_constancia_situacion_fiscal" style="display: block;"><span id="constancia-situacion-fiscal-label">{{ form.constancia_situacion_fiscal.label_tag }}</span></label>
              {{ form.constancia_situacion_fiscal }}
              <p id="error-constancia-situacion-fiscal" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Seleccione una opción válida</p>
            </div>

            <!-- Estado cuenta bancario field -->
            <div style="margin-bottom:1rem;">
              <label for="id_estado_cuenta_bancario" style="display: block;"><span id="estado-cuenta-bancario-label">{{ form.estado_cuenta_bancario.label_tag }}</span></label>
              {{ form.estado_cuenta_bancario }}
              <p id="error-estado-cuenta-bancario" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Seleccione una opción válida</p>
            </div>
          {% endif %}

          <!-- Descargar documentos -->
          {% if proveedor.es_migracion %}
            <a href="/{{ proveedor.constancia_situacion_fiscal }}" class="d-inline-block mb-3" style="width:fit-content;" download="">Descargar constancia de situación fiscal actualizada</a>
            <a href="/{{ proveedor.estado_cuenta_bancario }}" class="d-inline-block mb-3" style="width:fit-content;" download="">Descargar estado de cuenta bancario actualizado</a>
          {% else %}
            {% if proveedor.constancia_situacion_fiscal %}
              <a href="/{{ proveedor.constancia_situacion_fiscal }}" class="d-inline-block mb-3" style="width:fit-content;" download="">Descargar constancia de situación fiscal</a>
            {% endif %}
            {% if proveedor.estado_cuenta_bancario %}
              <a href="/{{ proveedor.estado_cuenta_bancario }}" class="d-inline-block mb-3" style="width:fit-content;" download="">Descargar estado de cuenta bancario</a>
            {% endif %}
          {% endif %}

          <!-- Comentarios field -->
          {% if proveedor.pendiente and current_user.compras or proveedor.compras and current_user.finanzas or proveedor.finanzas and current_user.sistemas or proveedor.comentarios != '' %}
            <div style="margin-bottom:1rem;">
              {{ form.comentarios.label_tag }}
              {{ form.comentarios }}
              <p id="error-comentarios" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Este campo es obligatorio</p>
            </div>
          {% endif %}

          <div id="buttons-container" class="d-flex justify-content-between gap-2">
            {% if proveedor.rechazado_compras or proveedor.rechazado_finanzas or proveedor.rechazado_sistemas or proveedor.borrador %}
              {% if proveedor.es_migracion %}
                <button id="btn-save" class="btn w-100 btn-save" style="margin-top: 0.5rem; background-color: #008841; color: white; font-weight: bold;" type="submit" name="finanzas" value="True">Enviar</button>
              {% else %}
                <button id="btn-save" class="btn w-100 btn-save" style="margin-top: 0.5rem; background-color: #008841; color: white; font-weight: bold;" type="submit" name="pendiente" value="True">Enviar</button>
              {% endif %}

              <button id="btn-delete" class="btn btn-delete w-100" style="margin-top: 0.5rem; background-color: tomato; color: white; font-weight: bold;" type="submit" name="eliminado" value="True">Eliminar solicitud</button>
            {% endif %}

            {% if proveedor.pendiente and current_user.compras and not proveedor.borrador %}
              <button id="btn-approve" class="btn btn-approve w-100" style="margin-top: 0.5rem; background-color: #008841; color: white; font-weight: bold;" type="submit" name="compras" value="True">Aprobar</button>
              <button id="btn-decline" class="btn btn-decline w-100" style="margin-top: 0.5rem; background-color: tomato; color: white; font-weight: bold;" type="submit" name="rechazado_compras" value="True">Rechazar</button>
            {% endif %}

            {% if proveedor.compras and current_user.finanzas and not proveedor.borrador %}
              <button id="btn-approve" class="btn btn-approve w-100" style="margin-top: 0.5rem; background-color: #008841; color: white; font-weight: bold;" type="submit" name="finanzas" value="True">Aprobar</button>
              <button id="btn-decline" class="btn btn-decline w-100" style="margin-top: 0.5rem; background-color: tomato; color: white; font-weight: bold;" type="submit" name="rechazado_finanzas" value="True">Rechazar</button>
            {% endif %}

            {% if proveedor.finanzas and current_user.sistemas and not proveedor.borrador %}
              <button id="btn-approve" class="btn btn-approve w-100" style="margin-top: 0.5rem; background-color: #008841; color: white; font-weight: bold;" type="submit" name="sistemas" value="True">Aprobar</button>
              <button id="btn-decline" class="btn btn-decline w-100" style="margin-top: 0.5rem; background-color: tomato; color: white; font-weight: bold;" type="submit" name="rechazado_sistemas" value="True">Rechazar</button>
            {% endif %}
          </div>
        </form>

        <button id="btn-back" class="btn btn-secondary mb-4">Volver</button>
      </div>
    </div>
  </main>

  <style>
      #btn-back {
          width: 10rem;
          margin-top: 2rem;
          font-weight: bold;
          background-color: rgb(0, 128, 0, 0.6);
          transition: 0.2s ease-in-out;
      }
      #btn-back:hover {
          scale: 1.05;
          background-color: rgb(0, 128, 0);
      }
  </style>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      // Containers
      const banco2Container = document.getElementById('banco-2-container')
      const buttonsContainer = document.getElementById('buttons-container')
      const checkboxContainer = document.getElementById('checkbox-container')
      const datalist = document.getElementById("opciones_proveedor")
      
      // Inputs
      const empresaOrigen = document.getElementById('id_empresa_origen')
      const empresaDestino = document.getElementById('id_empresa_destino')
      const rfcMigracion = document.getElementById('id_rfc_migracion')
      const empresa = document.getElementById('id_empresa')
      const tipoAlta = document.getElementById('id_tipo_alta')
      const contribuyente = document.getElementById('id_contribuyente')
      const rfc = document.getElementById('id_rfc')
      const curp = document.getElementById('id_curp')
      const regimenCapital = document.getElementById('id_regimen_capital')
      const nombreFiscal = document.getElementById('id_nombre_fiscal')
      const nombreComercial = document.getElementById('id_nombre_comercial')
      const regimenFiscal = document.getElementById('id_regimen_fiscal')
      const usoCfdi = document.getElementById('id_uso_cfdi')
      const representanteLegal = document.getElementById('id_representante_legal')
      const telefono1 = document.getElementById('id_telefono_1')
      const telefono2 = document.getElementById('id_telefono_2')
      const contacto = document.getElementById('id_contacto')
      const correoGeneral = document.getElementById('id_correo_general')
      const correoPagos = document.getElementById('id_correo_pagos')
      const sitioWeb = document.getElementById('id_sitio_web')
      const rubro = document.getElementById('id_rubro')
      const tipoOperacion = document.getElementById('id_tipo_operacion')
      const tipoTercero = document.getElementById('id_tipo_tercero')
      const idFiscal = document.getElementById('id_id_fiscal')
      const agenteAduanal = document.getElementById('id_agente_aduanal')
      const fairTrade = document.getElementById('id_fair_trade')
      const diasCredito = document.getElementById('id_dias_credito')
      const montoCreditoMn = document.getElementById('id_monto_credito_mn')
      const montoCreditoMe = document.getElementById('id_monto_credito_me')
      const retencionIva = document.getElementById('id_retencion_iva')
      const retencionIsr = document.getElementById('id_retencion_isr')
      const ivaFrontera = document.getElementById('id_iva_frontera')
      const codigoPostal = document.getElementById('id_codigo_postal')
      const pais = document.getElementById('id_pais')
      const estado = document.getElementById('id_estado')
      const ciudad = document.getElementById('id_ciudad')
      const municipio = document.getElementById('id_municipio')
      const localidad = document.getElementById('id_localidad')
      const colonia = document.getElementById('id_colonia')
      const calle = document.getElementById('id_calle')
      const numeroExterior = document.getElementById('id_numero_exterior')
      const numeroInterior = document.getElementById('id_numero_interior')
      const banco = document.getElementById('id_banco')
      const cuenta = document.getElementById('id_cuenta')
      const moneda = document.getElementById('id_moneda')
      const clabe = document.getElementById('id_clabe')
      const swift = document.getElementById('id_swift')
      const otroCodigoBancario = document.getElementById('id_otro_codigo_bancario')
      const banco2 = document.getElementById('id_banco_2')
      const cuenta2 = document.getElementById('id_cuenta_2')
      const moneda2 = document.getElementById('id_moneda_2')
      const clabe2 = document.getElementById('id_clabe_2')
      const swift2 = document.getElementById('id_swift_2')
      const otroCodigoBancario2 = document.getElementById('id_otro_codigo_bancario_2')
      const usarEnPortalProveedores = document.getElementById('id_usar_en_portal_proveedores')
      const noAplicaParaRafaga = document.getElementById('id_no_aplica_para_rafaga')
      const noRelacionarOc = document.getElementById('id_no_relacionar_OC')
      const comentarios = document.getElementById('id_comentarios')
      
      // Buttons
      const btnAddBanco = document.getElementById('add-banco-2')
      const btnSave = document.getElementById('btn-save')
      const btnDelete = document.getElementById('btn-delete')
      const btnApprove = document.getElementById('btn-approve')
      const btnDecline = document.getElementById('btn-decline')
      const btnBack = document.getElementById('btn-back')
      
      // Error messages
      const errorEmpresaOrigen = document.getElementById('error-empresa-origen')
      const errorEmpresaDestino = document.getElementById('error-empresa-destino')
      const errorEmpresasMigracion = document.getElementById('error-empresas-migracion')
      const errorRfcMigracion = document.getElementById('error-rfc-migracion')
      const errorRfcMigracion2 = document.getElementById('error-rfc-migracion-2')
      const errorEmpresa = document.getElementById('error-empresa')
      const errorTipoAlta = document.getElementById('error-tipo-alta')
      const errorContribuyente = document.getElementById('error-contribuyente')
      const errorRfc = document.getElementById('error-rfc')
      const errorRfc2 = document.getElementById('error-rfc-2')
      const errorCurp = document.getElementById('error-curp')
      const errorRegimenCapital = document.getElementById('error-regimen-capital')
      const errorNombreFiscal = document.getElementById('error-nombre-fiscal')
      const errorNombreFiscal2 = document.getElementById('error-nombre-fiscal-2')
      const errorNombreComercial = document.getElementById('error-nombre-comercial')
      const errorNombreComercial2 = document.getElementById('error-nombre-comercial-2')
      const errorRegimenFiscal = document.getElementById('error-regimen-fiscal')
      const errorUsoCfdi = document.getElementById('error-uso-cfdi')
      const errorRepresentanteLegal = document.getElementById('error-representante-legal')
      const errorTelefono1 = document.getElementById('error-telefono-1')
      const errorTelefono2 = document.getElementById('error-telefono-2')
      const errorContacto = document.getElementById('error-contacto')
      const errorCorreoGeneral = document.getElementById('error-correo-general')
      const errorCorreoPagos = document.getElementById('error-correo-pagos')
      const errorSitioWeb = document.getElementById('error-sitio-web')
      const errorRubro = document.getElementById('error-rubro')
      const errorTipoOperacion = document.getElementById('error-tipo-operacion')
      const errorTipoTercero = document.getElementById('error-tipo-tercero')
      const errorIdFiscal = document.getElementById('error-id-fiscal')
      const errorAgenteAduanal = document.getElementById('error-agente-aduanal')
      const errorFairTrade = document.getElementById('error-fair-trade')
      const errorDiasCredito = document.getElementById('error-dias-credito')
      const errorMontoCreditoMn = document.getElementById('error-monto-credito-mn')
      const errorMontoCreditoMe = document.getElementById('error-monto-credito-me')
      const errorRetencionIva = document.getElementById('error-retencion-iva')
      const errorRetencionIsr = document.getElementById('error-retencion-isr')
      const errorIvaFrontera = document.getElementById('error-iva-frontera')
      const errorCodigoPostal = document.getElementById('error-codigo-postal')
      const errorPais = document.getElementById('error-pais')
      const errorEstado = document.getElementById('error-estado')
      const errorCiudad = document.getElementById('error-ciudad')
      const errorMunicipio = document.getElementById('error-municipio')
      const errorLocalidad = document.getElementById('error-localidad')
      const errorColonia = document.getElementById('error-colonia')
      const errorCalle = document.getElementById('error-calle')
      const errorNumeroExterior = document.getElementById('error-numero-exterior')
      const errorNumeroInterior = document.getElementById('error-numero-interior')
      const errorBanco = document.getElementById('error-banco')
      const errorCuenta = document.getElementById('error-cuenta')
      const errorMoneda = document.getElementById('error-moneda')
      const errorClabe = document.getElementById('error-clabe')
      const errorBanco2 = document.getElementById('error-banco-2')
      const errorCuenta2 = document.getElementById('error-cuenta-2')
      const errorMoneda2 = document.getElementById('error-moneda-2')
      const errorClabe2 = document.getElementById('error-clabe-2')
      const errorUsarEnPortalProveedores = document.getElementById('error-usar-en-portal-proveedores')
      const errorNoAplicaParaRafaga = document.getElementById('error-no-aplica-para-rafaga')
      const errorNoRelacionarOc = document.getElementById('error-no-relacionar-OC')
      const errorComentarios = document.getElementById('error-comentarios')
      
      // Regular expressions
      const rfcPattern = /^[A-Za-z]{3,4}\d{6}[A-Za-z\d]{3}$/
      const curpPattern = /^[A-Za-z]{4}\d{6}[A-Za-z]{6}[A-Za-z\d]{2}$/
      const telefonoPattern = /^[\d\s+\-]{10,}$/
      const correoPattern = /^[A-Za-z\d._%+-]+@[A-Za-z\d.-]+\.[A-Za-z]{2,}$/
      const codigoPostalPattern = /^\d{5}$/
      const cuentaPattern = /^\d{5,20}$/
      const clabePattern = /^\d{18}$/
      const nonAccentPattern = /^[A-Za-z\d\s]*$/
      const numberPattern = /^[\d,]*$/

      // Catalogo de proveedores existentes
      var catalogoProveedor = {{ catalogo_proveedor|safe }}
      if (rfcMigracion) {
        rfcMigracion.setAttribute('list', 'opciones_proveedor')
      }
      else {
        rfc.setAttribute('list', 'opciones_proveedor')
      }

      btnBack.addEventListener('click', () => {
        window.history.back()
      })
    
      buttonsContainer.addEventListener('click', function (event) {
        if (event.target && event.target.classList.contains('btn-save')) {
          if (tipoAlta) {
            tipoAlta.removeAttribute('disabled')
            if (tipoAlta.value == 'Cliente') {
              btnSave.name = 'compras'
            }
          }
          if (comentarios) {
            comentarios.value = ''
          }
        }
        if (event.target && event.target.classList.contains('btn-decline')) {
          if (tipoAlta) {
            tipoAlta.removeAttribute('disabled')
          }
          if (comentarios) {
            comentarios.setAttribute('required', 'true')
            if(comentarios.value == '') {
              errorComentarios.style.display = 'block'
            }
          }
        }
        if (event.target && event.target.classList.contains('btn-approve')) {
          if (tipoAlta) {
            tipoAlta.removeAttribute('disabled')
          }
          if (comentarios) {
            comentarios.removeAttribute('required')
            comentarios.value = ''
          }
        }
      })
    
      // Los checkbox se muestran solo para proveedores, no para clientes
      if (tipoAlta && tipoAlta.value == 'Cliente') {
        checkboxContainer.style.display = 'none'
      }
    
      // La curp es obligatoria solo para personas físicas
      if (contribuyente && contribuyente.value == 'Persona moral') {
        curp.removeAttribute('required')
        curp.setAttribute('disabled', true)
        regimenCapital.removeAttribute('required')
        regimenCapital.setAttribute('disabled', true)
      }
    
      // Si se añadió un segundo banco, mostrar el elemento "banco-2-container"
      if (banco2 && banco2.value != '') {
        banco2Container.style.display = 'block'
        banco2.setAttribute('required', true)
        cuenta2.setAttribute('required', true)
        moneda2.setAttribute('required', true)
        clabe2.setAttribute('required', true)
        btnAddBanco.textContent = 'Eliminar banco'
      }

      const makeFieldsMandatory = () => {
        if (empresaOrigen) {
          empresaOrigen.setAttribute('required', true);
        }
        if (empresaDestino) {
          empresaDestino.setAttribute('required', true);
        }
        if (rfcMigracion) {
          rfcMigracion.setAttribute('required', true);
        }
        if (empresa) {
          empresa.setAttribute('required', true);
        }
        if (contribuyente) {
          contribuyente.setAttribute('required', true);
        }
        if (rfc) {
          rfc.setAttribute('required', true);
        }
        if (regimenCapital) {
          regimenCapital.setAttribute('required', true);
        }
        if (nombreFiscal) {
          nombreFiscal.setAttribute('required', true);
        }
        if (nombreComercial) {
          nombreComercial.setAttribute('required', true);
        }
        if (regimenFiscal) {
          regimenFiscal.setAttribute('required', true);
        }
        if (usoCfdi) {
          usoCfdi.setAttribute('required', true);
        }
        if (telefono1) {
          telefono1.setAttribute('required', true);
        }
        if (correoGeneral) {
          correoGeneral.setAttribute('required', true);
        }
        if (correoPagos) {
          correoPagos.setAttribute('required', true);
        }
        if (rubro) {
          rubro.setAttribute('required', true);
        }
        if (tipoOperacion) {
          tipoOperacion.setAttribute('required', true);
        }
        if (agenteAduanal) {
          agenteAduanal.setAttribute('required', true);
        }
        if (fairTrade) {
          fairTrade.setAttribute('required', true);
        }
        if (diasCredito) {
          diasCredito.setAttribute('required', true);
        }
        if (montoCreditoMn) {
          montoCreditoMn.setAttribute('required', true);
        }
        if (montoCreditoMe) {
          montoCreditoMe.setAttribute('required', true);
        }
        if (retencionIva) {
          retencionIva.setAttribute('required', true);
        }
        if (retencionIsr) {
          retencionIsr.setAttribute('required', true);
        }
        if (ivaFrontera) {
          ivaFrontera.setAttribute('required', true);
        }
        if (codigoPostal) {
          codigoPostal.setAttribute('required', true);
        }
        if (pais) {
          pais.setAttribute('required', true);
        }
        if (estado) {
          estado.setAttribute('required', true);
        }
        if (ciudad) {
          ciudad.setAttribute('required', true);
        }
        if (municipio) {
          municipio.setAttribute('required', true);
        }
        if (localidad) {
          localidad.setAttribute('required', true);
        }
        if (colonia) {
          colonia.setAttribute('required', true);
        }
        if (calle) {
          calle.setAttribute('required', true);
        }
        if (numeroExterior) {
          numeroExterior.setAttribute('required', true);
        }
        if (banco) {
          banco.setAttribute('required', true);
        }
        if (cuenta) {
          cuenta.setAttribute('required', true);
        }
        if (moneda) {
          moneda.setAttribute('required', true);
        }
        if (clabe) {
          clabe.setAttribute('required', true);
        }
      }

      makeFieldsMandatory()

      const makeFieldsOptional = () => {
        if (empresaOrigen) {
          empresaOrigen.removeAttribute('required');
        }
        if (empresaDestino) {
          empresaDestino.removeAttribute('required');
        }
        if (rfcMigracion) {
          rfcMigracion.removeAttribute('required');
        }
        if (empresa) {
          empresa.removeAttribute('required');
        }
        if (contribuyente) {
          contribuyente.removeAttribute('required');
        }
        if (rfc) {
          rfc.removeAttribute('required');
        }
        if (regimenCapital) {
          regimenCapital.removeAttribute('required');
        }
        if (nombreFiscal) {
          nombreFiscal.removeAttribute('required');
        }
        if (nombreComercial) {
          nombreComercial.removeAttribute('required');
        }
        if (regimenFiscal) {
          regimenFiscal.removeAttribute('required');
        }
        if (usoCfdi) {
          usoCfdi.removeAttribute('required');
        }
        if (telefono1) {
          telefono1.removeAttribute('required');
        }
        if (correoGeneral) {
          correoGeneral.removeAttribute('required');
        }
        if (correoPagos) {
          correoPagos.removeAttribute('required');
        }
        if (rubro) {
          rubro.removeAttribute('required');
        }
        if (tipoOperacion) {
          tipoOperacion.removeAttribute('required');
        }
        if (idFiscal) {
          idFiscal.removeAttribute('required');
        }
        if (agenteAduanal) {
          agenteAduanal.removeAttribute('required');
        }
        if (fairTrade) {
          fairTrade.removeAttribute('required');
        }
        if (diasCredito) {
          diasCredito.removeAttribute('required');
        }
        if (montoCreditoMn) {
          montoCreditoMn.removeAttribute('required');
        }
        if (montoCreditoMe) {
          montoCreditoMe.removeAttribute('required');
        }
        if (retencionIva) {
          retencionIva.removeAttribute('required');
        }
        if (retencionIsr) {
          retencionIsr.removeAttribute('required');
        }
        if (ivaFrontera) {
          ivaFrontera.removeAttribute('required');
        }
        if (codigoPostal) {
          codigoPostal.removeAttribute('required');
        }
        if (pais) {
          pais.removeAttribute('required');
        }
        if (estado) {
          estado.removeAttribute('required');
        }
        if (ciudad) {
          ciudad.removeAttribute('required');
        }
        if (municipio) {
          municipio.removeAttribute('required');
        }
        if (localidad) {
          localidad.removeAttribute('required');
        }
        if (colonia) {
          colonia.removeAttribute('required');
        }
        if (calle) {
          calle.removeAttribute('required');
        }
        if (numeroExterior) {
          numeroExterior.removeAttribute('required');
        }
        if (banco) {
          banco.removeAttribute('required');
        }
        if (cuenta) {
          cuenta.removeAttribute('required');
        }
        if (moneda) {
          moneda.removeAttribute('required');
        }
        if (clabe) {
          clabe.removeAttribute('required');
        }
      }

      // FIELD VALIDATION

      const firstLetterCapitalized = str => {
        return str[0].toUpperCase() + str.slice(1).toLowerCase()
      }

      const firstLetterOfEachWordCapitalized = str => {
        return str.toLowerCase().replace(/\b\w/g, char => char.toUpperCase());
      }

      // Validación empresa origen
      if (empresaOrigen) {
        const validateEmpresaOrigen = () => {
          if (empresaOrigen.value == '') {
            errorEmpresaOrigen.style.display = 'block'
            errorEmpresasMigracion.style.display = 'none'
          } else {
            errorEmpresaOrigen.style.display = 'none'
            // No se puede seleccionar la misma opción que en "Empresa destino"
            if (empresaOrigen.value == empresaDestino.value) {
              errorEmpresasMigracion.style.display = 'block'
            }
            else {
              errorEmpresasMigracion.style.display = 'none'
            }
          }
          enableSaveButton()
        }
        empresaOrigen.addEventListener('focus', validateEmpresaOrigen)
        empresaOrigen.addEventListener('change', validateEmpresaOrigen)
      }
      
      // Validación empresa destino
      if (empresaDestino) {
        const validateEmpresaDestino = () => {
          if (empresaDestino.value == '') {
            errorEmpresaDestino.style.display = 'block'
            errorEmpresasMigracion.style.display = 'none'
          } else {
            errorEmpresaDestino.style.display = 'none'
            // No se puede seleccionar la misma opción que en "Empresa destino"
            if (empresaOrigen.value == empresaDestino.value) {
              errorEmpresasMigracion.style.display = 'block'
            }
            else {
              errorEmpresasMigracion.style.display = 'none'
            }
          }
          enableSaveButton()
        }
        empresaDestino.addEventListener('focus', validateEmpresaDestino)
        empresaDestino.addEventListener('change', validateEmpresaDestino)
      }
      
      // Validación rfc migracion
      if (rfcMigracion) {
        const validateRfcMigracion = () => {
          if (rfcPattern.test(rfcMigracion.value)) {
            errorRfcMigracion.style.display = 'none'
          } else {
            errorRfcMigracion.style.display = 'block'
          }
          // Filtrando las opciones del catálogo que empiecen con el valor de rfc migracion
          datalist.innerHTML = ''
          for (var i = 0; i < catalogoProveedor.length; i++) {
            if (catalogoProveedor[i].value.toUpperCase().startsWith(rfcMigracion.value.toUpperCase())) {
              const option = document.createElement('option')
              option.value = catalogoProveedor[i].value
              option.innerText = catalogoProveedor[i].text
              datalist.appendChild(option)
            }
            if (datalist.childElementCount == 0) {
              errorRfcMigracion2.style.display = 'block'
              disableAllFields(rfcMigracion)
            } else {
              errorRfcMigracion2.style.display = 'none'
              enableAllFields()
            }
          }
          enableSaveButton()
        }
        const validateRfcMigracionOnChange = () => {
          // Todas las letras deben ser mayúsculas
          rfcMigracion.value = rfcMigracion.value.toUpperCase()
        }
        rfcMigracion.addEventListener('focus', validateRfcMigracion)
        rfcMigracion.addEventListener('input', validateRfcMigracion)
        rfcMigracion.addEventListener('change', validateRfcMigracionOnChange)
      }
      
      // Validación empresa
      if (empresa) {
        const validateEmpresa = () => {
          if (empresa.value == '') {
            errorEmpresa.style.display = 'block'
          } else {
            errorEmpresa.style.display = 'none'
          }
          enableSaveButton()
        }
        empresa.addEventListener('focus', validateEmpresa)
        empresa.addEventListener('change', validateEmpresa)
      }
      
      // Validación tipo alta
      if (tipoAlta) {
        const validateTipoAlta = () => {
          tipoAlta.setAttribute('disabled', true)
        }
        validateTipoAlta()
      }
      
      // Validación contribuyente
      if (contribuyente) {
        const validateContribuyente = () => {
          if (contribuyente.value == '') {
            errorContribuyente.style.display = 'block'
          } else {
            errorContribuyente.style.display = 'none'
            
            if (contribuyente.value == 'Persona física') {
              // La curp es obligatoria solo para personas físicas
              curp.setAttribute('required', true)
              curp.removeAttribute('disabled')
              curp.removeAttribute('placeholder')
              // El régimen de capital no es necesario para personas físicas
              regimenCapital.removeAttribute('required')
              regimenCapital.setAttribute('disabled', true)
              regimenCapital.value = ''
              errorRegimenCapital.style.display = 'none'
              // Si es persona física, la primera letra de cada palabra será mayúscula
              nombreFiscal.value = nombreFiscal.value != '' ? firstLetterOfEachWordCapitalized(nombreFiscal.value) : ''
              nombreComercial.value = nombreComercial.value != '' ? firstLetterOfEachWordCapitalized(nombreComercial.value) : ''
            }
            if (contribuyente.value == 'Persona moral') {
              curp.removeAttribute('required')
              curp.setAttribute('disabled', true)
              curp.setAttribute('placeholder', 'persona moral no requiere CURP')
              curp.value = ''
              errorCurp.style.display = 'none'
              // Si el proveedor es nacional, el régimen de capital será obligatorio
              if (tipoTercero.value.toUpperCase() != 'EXTRANJERO' && tipoTercero.value.toUpperCase() != 'EXTRANJERO RELACIONADO') {
                regimenCapital.setAttribute('required', true)
                regimenCapital.removeAttribute('disabled')
              }
              // Si es persona moral, solo la primera letra será mayúscula
              nombreFiscal.value = nombreFiscal.value != '' ? firstLetterCapitalized(nombreFiscal.value) : ''
              nombreComercial.value = nombreComercial.value != '' ? firstLetterCapitalized(nombreComercial.value) : ''
            }
          }
          enableSaveButton()
        }
        contribuyente.addEventListener('focus', validateContribuyente)
        contribuyente.addEventListener('change', validateContribuyente)
        validateContribuyente()
      }
      
      // Validación rfc
      if (rfc) {
        const validateRfc = () => {
          if (rfcPattern.test(rfc.value)) {
            errorRfc.style.display = 'none'
          } else {
            errorRfc.style.display = 'block'
          }

          // Filtrando las opciones del catálogo que empiecen con el valor de rfc
          datalist.innerHTML = ''

          // Clientes y proveedores extranjeros tienen un RFC genérico
          if (rfc.value.toUpperCase() == 'XAX010101000' || rfc.value.toUpperCase() == 'XEXX010101000') {
            const option = document.createElement('option')
            option.value = rfc.value.toUpperCase()
            if (rfc.value.toUpperCase() == 'XAX010101000') {
              option.innerText = `${rfc.value.toUpperCase()} - Cliente extranjero`
            }
            else {
              option.innerText = `${rfc.value.toUpperCase()} - Proveedor extranjero`
            }
            datalist.appendChild(option)
          }
          else {
            for (var i = 0; i < catalogoProveedor.length; i++) {
              if (catalogoProveedor[i].value.toUpperCase().startsWith(rfc.value.toUpperCase())) {
                const option = document.createElement('option')
                option.value = catalogoProveedor[i].value
                option.innerText = catalogoProveedor[i].text
                datalist.appendChild(option)
              }
              if (catalogoProveedor[i].value.toUpperCase() == rfc.value.toUpperCase() && rfc.value != '') {
                errorRfc2.style.display = 'block'
                disableAllFields(rfc)
                return
              }
              else {
                errorRfc2.style.display = 'none'
                enableAllFields()
              }
            }
          }

          enableSaveButton()
        }
        const validateRfcOnChange = () => {
          // Todas las letras deben ser mayúsculas
          rfc.value = rfc.value.toUpperCase()
        }
        rfc.addEventListener('focus', validateRfc)
        rfc.addEventListener('input', validateRfc)
        rfc.addEventListener('change', validateRfcOnChange)
      }
      
      // Validación curp
      if (curp) {
        const validateCurp = () => {
          if (curpPattern.test(curp.value)) {
            errorCurp.style.display = 'none'
          } else {
            errorCurp.style.display = 'block'
          }
          enableSaveButton()
        }
        const validateCurpOnChange = () => {
          // Todas las letras deben ser mayúsculas
          curp.value = curp.value.toUpperCase()
        }
        curp.addEventListener('focus', validateCurp)
        curp.addEventListener('input', validateCurp)
        curp.addEventListener('change', validateCurpOnChange)
      }

      // Validación nombre fiscal
      if (nombreFiscal) {
        const validateNombreFiscal = () => {
          if (nombreFiscal.value == '') {
            errorNombreFiscal.style.display = 'block'
            errorNombreFiscal2.style.display = 'none'
            enableAllFields()
          } else {
            errorNombreFiscal.style.display = 'none'
            if (nonAccentPattern.test(nombreFiscal.value)) {
              errorNombreFiscal2.style.display = 'none'
              enableAllFields()
            }
            else {
              errorNombreFiscal2.style.display = 'block'
              disableAllFields(nombreFiscal)
            }
          }
          enableSaveButton()
        }
        const validateNombreFiscalOnChange = () => {
          // Si es persona física, la primera letra de cada palabra será mayúscula
          if (contribuyente.value == 'Persona física') {
            nombreFiscal.value = nombreFiscal.value != '' ? firstLetterOfEachWordCapitalized(nombreFiscal.value) : ''
          }
          // Si es persona moral, solo la primera letra será mayúscula
          if (contribuyente.value == 'Persona moral') {
            nombreFiscal.value = nombreFiscal.value != '' ? firstLetterCapitalized(nombreFiscal.value) : ''
          }
        }
        nombreFiscal.addEventListener('focus', validateNombreFiscal)
        nombreFiscal.addEventListener('input', validateNombreFiscal)
        nombreFiscal.addEventListener('change', validateNombreFiscalOnChange)
      }
        
      // Validación regimen de capital
      if (regimenCapital) {
        const validateRegimenCapital = () => {
          if (regimenCapital.value == '') {
            errorRegimenCapital.style.display = 'block'
          } else {
            errorRegimenCapital.style.display = 'none'
          }
          enableSaveButton()
        }
        regimenCapital.addEventListener('focus', validateRegimenCapital)
        regimenCapital.addEventListener('change', validateRegimenCapital)
      }
      
      // Validación nombre comercial
      if (nombreComercial) {
        const validateNombreComercial = () => {
          if (nombreComercial.value == '') {
            errorNombreComercial.style.display = 'block'
            errorNombreComercial2.style.display = 'none'
            enableAllFields()
          } else {
            errorNombreComercial.style.display = 'none'
            if (nonAccentPattern.test(nombreComercial.value)) {
              errorNombreComercial2.style.display = 'none'
              enableAllFields()
            }
            else {
              errorNombreComercial2.style.display = 'block'
              disableAllFields(nombreComercial)
            }
          }
          enableSaveButton()
        }
        const validateNombreComercialOnChange = () => {
          // Si es persona física, solo la primera letra de cada palabra será mayúscula
          if (contribuyente.value == 'Persona física') {
            nombreComercial.value = nombreComercial.value != '' ? firstLetterOfEachWordCapitalized(nombreComercial.value) : ''
          }
          // Si es persona moral, solo la primera letra será mayúscula
          if (contribuyente.value == 'Persona moral') {
            nombreComercial.value = nombreComercial.value != '' ? firstLetterCapitalized(nombreComercial.value) : ''
          }
        }
        nombreComercial.addEventListener('focus', validateNombreComercial)
        nombreComercial.addEventListener('input', validateNombreComercial)
        nombreComercial.addEventListener('change', validateNombreComercialOnChange)
      }
      
      // Validación regimen fiscal
      if (regimenFiscal) {
        const validateRegimenFiscal = () => {
          if (regimenFiscal.value == '') {
            errorRegimenFiscal.style.display = 'block'
          } else {
            errorRegimenFiscal.style.display = 'none'
          }
          enableSaveButton()
        }
        regimenFiscal.addEventListener('focus', validateRegimenFiscal)
        regimenFiscal.addEventListener('change', validateRegimenFiscal)
      }
      
      // Validación uso cfdi
      if (usoCfdi) {
        const validateUsoCfdi = () => {
          if (usoCfdi.value == '') {
            errorUsoCfdi.style.display = 'block'
          } else {
            errorUsoCfdi.style.display = 'none'
          }
          enableSaveButton()
        }
        usoCfdi.addEventListener('focus', validateUsoCfdi)
        usoCfdi.addEventListener('change', validateUsoCfdi)
      }
      
      // Validación telefono 1
      if (telefono1) {
        const validateTelefono1 = () => {
          if (telefonoPattern.test(telefono1.value)) {
            errorTelefono1.style.display = 'none'
            enableAllFields()
          } else {
            errorTelefono1.style.display = 'block'
            disableAllFields(telefono1)
          }
          enableSaveButton()
        }
        telefono1.addEventListener('focus', validateTelefono1)
        telefono1.addEventListener('input', validateTelefono1)
      }
      
      // Validación telefono 2
      if (telefono2) {
        const validateTelefono2 = () => {
          if (telefono2.value == '' || telefonoPattern.test(telefono2.value)) {
            errorTelefono2.style.display = 'none'
            enableAllFields()
          } else {
            errorTelefono2.style.display = 'block'
            disableAllFields(telefono2)
          }
          enableSaveButton()
        }
        telefono2.addEventListener('focus', validateTelefono2)
        telefono2.addEventListener('input', validateTelefono2)
      }

      // Validación representante legal
      if (representanteLegal) {
        const validateRepresentanteLegal = () => {
          // La primera letra de cada palabra será mayúscula
          representanteLegal.value = representanteLegal.value != '' ? firstLetterOfEachWordCapitalized(representanteLegal.value) : ''
        }
        representanteLegal.addEventListener('change', validateRepresentanteLegal)
      }
      
      // Validación contacto
      if (contacto) {
        const validateContacto = () => {
          // La primera letra de cada palabra será mayúscula
          contacto.value = contacto.value != '' ? firstLetterOfEachWordCapitalized(contacto.value) : ''
        }
        contacto.addEventListener('change', validateContacto)
      }
      
      // Validación correo general
      if (correoGeneral) {
        const validateCorreoGeneral = () => {
          if (correoPattern.test(correoGeneral.value)) {
            errorCorreoGeneral.style.display = 'none'
            enableAllFields()
          } else {
            errorCorreoGeneral.style.display = 'block'
            disableAllFields(correoGeneral)
          }
          enableSaveButton()
        }
        const validateCorreoGeneralOnChange = () => {
          // Todas las letras deben ser minúsculas
          correoGeneral.value = correoGeneral.value.toLowerCase()
        }
        correoGeneral.addEventListener('focus', validateCorreoGeneral)
        correoGeneral.addEventListener('input', validateCorreoGeneral)
        correoGeneral.addEventListener('change', validateCorreoGeneralOnChange)
      }
      
      // Validación correo pagos
      if (correoPagos) {
        const validateCorreoPagos = () => {
          if (correoPattern.test(correoPagos.value)) {
            errorCorreoPagos.style.display = 'none'
            enableAllFields()
          } else {
            errorCorreoPagos.style.display = 'block'
            disableAllFields(correoPagos)
          }
          enableSaveButton()
        }
        const validateCorreoPagosOnChange = () => {
          // Todas las letras deben ser minúsculas
          correoPagos.value = correoPagos.value.toLowerCase()
        }
        correoPagos.addEventListener('focus', validateCorreoPagos)
        correoPagos.addEventListener('input', validateCorreoPagos)
        correoPagos.addEventListener('change', validateCorreoPagosOnChange)
      }
      
      // Validación sitio web
      if (sitioWeb) {
        const validateSitioWeb = () => {
          // Todas las letras deben ser minúsculas
          sitioWeb.value = sitioWeb.value.toLowerCase()
        }
        sitioWeb.addEventListener('change', validateSitioWeb)
      }
      
      // Validación rubro
      if (rubro) {
        const validateRubro = () => {
          if (rubro.value == '') {
            errorRubro.style.display = 'block'
          } else {
            errorRubro.style.display = 'none'
          }
          enableSaveButton()
        }
        rubro.addEventListener('focus', validateRubro)
        rubro.addEventListener('change', validateRubro)
      }
      
      // Validación tipo operacion
      if (tipoOperacion) {
        const validateTipoOperacion = () => {
          if (tipoOperacion.value == '') {
            errorTipoOperacion.style.display = 'block'
          } else {
            errorTipoOperacion.style.display = 'none'
          }
          enableSaveButton()
        }
        tipoOperacion.addEventListener('focus', validateTipoOperacion)
        tipoOperacion.addEventListener('change', validateTipoOperacion)
      }

      // Validación tipo tercero
      if (tipoTercero) {
        const validateTipoTercero = () => {
          if (tipoTercero.value == '') {
            errorTipoTercero.style.display = 'block'
          } else {
            errorTipoTercero.style.display = 'none'
            // ID fiscal es obligatorio para proveedores y clientes extranjeros
            if (tipoTercero.value.toLowerCase() == 'extranjero' || tipoTercero.value.toLowerCase() == 'extranjero relacionado') {
              idFiscal.setAttribute('required', true)
              idFiscal.removeAttribute('disabled')
              // Régimen de capital no es obligatorio para proveedores y clientes extranjeros
              regimenCapital.removeAttribute('required')
              regimenCapital.setAttribute('disabled', true)
              regimenCapital.value = ''
              errorRegimenCapital.style.display = 'none'
            }
            else {
              idFiscal.setAttribute('disabled', true)
              idFiscal.removeAttribute('required')
              // Régimen de capital es obligatorio para proveedores y clientes nacionales (solo para personas morales)
              if (contribuyente.value.toUpperCase() == 'PERSONA MORAL') {
                regimenCapital.setAttribute('required', true)
                regimenCapital.removeAttribute('disabled')
              }
              if (codigoPostal.value) {
                if (codigoPostalPattern.test(codigoPostal.value)) {
                  errorCodigoPostal.style.display = 'none'
                  enableAllFields()
                } else {
                  errorCodigoPostal.style.display = 'block'
                  disableAllFields(codigoPostal)
                }
                enableSaveButton()
              }
            }
          }
          enableSaveButton()
        }
        tipoTercero.addEventListener('focus', validateTipoTercero)
        tipoTercero.addEventListener('change', validateTipoTercero)
        validateTipoTercero()
      }
      
      // Validación agente aduanal
      if (agenteAduanal) {
        const validateAgenteAduanal = () => {
          if (agenteAduanal.value == '') {
            errorAgenteAduanal.style.display = 'block'
          } else {
            errorAgenteAduanal.style.display = 'none'
          }
          enableSaveButton()
        }
        agenteAduanal.addEventListener('focus', validateAgenteAduanal)
        agenteAduanal.addEventListener('change', validateAgenteAduanal)
      }
      
      // Validación Identificación Fair Trade
      if (fairTrade) {
        const validateFairTrade = () => {
          if (fairTrade.value == '') {
            errorFairTrade.style.display = 'block'
          } else {
            errorFairTrade.style.display = 'none'
          }
          enableSaveButton()
        }
        fairTrade.addEventListener('focus', validateFairTrade)
        fairTrade.addEventListener('input', validateFairTrade)
      }

      const numberWithCommas = (x) => {
        return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
      }
      
      // Validación dias credito
      if (diasCredito) {
        const validateDiasCredito = () => {
          if (diasCredito.value != '' && numberPattern.test(diasCredito.value)) {
            errorDiasCredito.style.display = 'none'
            // Eliminar carácteres no numéricos
            const numericValue = diasCredito.value.replace(/[^0-9]/g, '');
            // Formatear el valor con números y comas
            const formattedValue = numberWithCommas(numericValue)
            diasCredito.value = formattedValue
          } else {
            errorDiasCredito.style.display = 'block'
          }
          enableSaveButton()
        }
        diasCredito.addEventListener('focus', validateDiasCredito)
        diasCredito.addEventListener('input', validateDiasCredito)
      }
      
      // Validación monto credito (moneda nacional)
      if (montoCreditoMn) {
        const validateMontoCreditoMn = () => {
          if (montoCreditoMn.value != '' && numberPattern.test(montoCreditoMn.value)) {
            errorMontoCreditoMn.style.display = 'none'
            // Eliminar carácteres no numéricos
            const numericValue = montoCreditoMn.value.replace(/[^0-9]/g, '');
            // Formatear el valor con números y comas
            const formattedValue = numberWithCommas(numericValue)
            montoCreditoMn.value = formattedValue
          } else {
            errorMontoCreditoMn.style.display = 'block'
          }
          enableSaveButton()
        }
        montoCreditoMn.addEventListener('focus', validateMontoCreditoMn)
        montoCreditoMn.addEventListener('input', validateMontoCreditoMn)
      }
      
      // Validación monto credito (moneda extranjera)
      if (montoCreditoMe) {
        const validateMontoCreditoMe = () => {
          if (montoCreditoMe.value != '' && numberPattern.test(montoCreditoMe.value)) {
            errorMontoCreditoMe.style.display = 'none'
            // Eliminar carácteres no numéricos
            const numericValue = montoCreditoMe.value.replace(/[^0-9]/g, '');
            // Formatear el valor con números y comas
            const formattedValue = numberWithCommas(numericValue)
            montoCreditoMe.value = formattedValue
          } else {
            errorMontoCreditoMe.style.display = 'block'
          }
          enableSaveButton()
        }
        montoCreditoMe.addEventListener('focus', validateMontoCreditoMe)
        montoCreditoMe.addEventListener('input', validateMontoCreditoMe)
      }
      
      // Validación retencion iva
      if (retencionIva) {
        const validateRetencionIva = () => {
          if (retencionIva.value == '') {
            errorRetencionIva.style.display = 'block'
          } else {
            errorRetencionIva.style.display = 'none'
          }
          enableSaveButton()
        }
        retencionIva.addEventListener('focus', validateRetencionIva)
        retencionIva.addEventListener('change', validateRetencionIva)
      }
      
      // Validación retencion isr
      if (retencionIsr) {
        const validateRetencionIsr = () => {
          if (retencionIsr.value == '') {
            errorRetencionIsr.style.display = 'block'
          } else {
            errorRetencionIsr.style.display = 'none'
          }
          enableSaveButton()
        }
        retencionIsr.addEventListener('focus', validateRetencionIsr)
        retencionIsr.addEventListener('change', validateRetencionIsr)
      }
      
      // Validación iva frontera
      if (ivaFrontera) {
        const validateIvaFrontera = () => {
          if (ivaFrontera.value == '') {
            errorIvaFrontera.style.display = 'block'
          } else {
            errorIvaFrontera.style.display = 'none'
          }
          enableSaveButton()
        }
        ivaFrontera.addEventListener('focus', validateIvaFrontera)
        ivaFrontera.addEventListener('change', validateIvaFrontera)
      }
      
      // Validación codigo postal
      if (codigoPostal) {
        const validateCodigoPostal = () => {
          if (tipoTercero.value.toLowerCase() == 'extranjero' || tipoTercero.value.toLowerCase() == 'extranjero relacionado') {
            errorCodigoPostal.style.display = 'none'
            enableAllFields()
            return
          }
          if (codigoPostalPattern.test(codigoPostal.value)) {
            errorCodigoPostal.style.display = 'none'
            enableAllFields()
          } else {
            errorCodigoPostal.style.display = 'block'
            disableAllFields(codigoPostal)
          }
          enableSaveButton()
        }
        codigoPostal.addEventListener('focus', validateCodigoPostal)
        codigoPostal.addEventListener('input', validateCodigoPostal)
      }
      
      // Validación país
      if (pais) {
        const validatePais = () => {
          if (pais.value == '') {
            errorPais.style.display = 'block'
          } else {
            errorPais.style.display = 'none'
          }
          enableSaveButton()
        }
        const validatePaisOnChange = () => {
          // La primera letra de cada palabra será mayúscula
          pais.value = pais.value != '' ? firstLetterOfEachWordCapitalized(pais.value) : ''
        }
        pais.addEventListener('focus', validatePais)
        pais.addEventListener('input', validatePais)
        pais.addEventListener('change', validatePaisOnChange)
      }
      
      // Validación estado
      if (estado) {
        const validateEstado = () => {
          if (estado.value == '') {
            errorEstado.style.display = 'block'
          } else {
            errorEstado.style.display = 'none'
          }
          enableSaveButton()
        }
        const validateEstadoOnChange = () => {
          // La primera letra de cada palabra será mayúscula
          estado.value = estado.value != '' ? firstLetterOfEachWordCapitalized(estado.value) : ''
        }
        estado.addEventListener('focus', validateEstado)
        estado.addEventListener('input', validateEstado)
        estado.addEventListener('change', validateEstadoOnChange)
      }
      
      // Validación ciudad
      if (ciudad) {
        const validateCiudad = () => {
          if (ciudad.value == '') {
            errorCiudad.style.display = 'block'
          } else {
            errorCiudad.style.display = 'none'
          }
          enableSaveButton()
        }
        const validateCiudadOnChange = () => {
          // La primera letra de cada palabra será mayúscula
          ciudad.value = ciudad.value != '' ? firstLetterOfEachWordCapitalized(ciudad.value) : ''
        }
        ciudad.addEventListener('focus', validateCiudad)
        ciudad.addEventListener('input', validateCiudad)
        ciudad.addEventListener('change', validateCiudadOnChange)
      }
      
      // Validación municipio
      if (municipio) {
        const validateMunicipio = () => {
          if (municipio.value == '') {
            errorMunicipio.style.display = 'block'
          } else {
            errorMunicipio.style.display = 'none'
          }
          enableSaveButton()
        }
        const validateMunicipioOnChange = () => {
          // La primera letra de cada palabra será mayúscula
          municipio.value = municipio.value != '' ? firstLetterOfEachWordCapitalized(municipio.value) : ''
        }
        municipio.addEventListener('focus', validateMunicipio)
        municipio.addEventListener('input', validateMunicipio)
        municipio.addEventListener('change', validateMunicipioOnChange)
      }
      
      // Validación localidad
      if (localidad) {
        const validateLocalidad = () => {
          if (localidad.value == '') {
            errorLocalidad.style.display = 'block'
          } else {
            errorLocalidad.style.display = 'none'
          }
          enableSaveButton()
        }
        const validateLocalidadOnChange = () => {
          // La primera letra de cada palabra será mayúscula
          localidad.value = localidad.value != '' ? firstLetterOfEachWordCapitalized(localidad.value) : ''
        }
        localidad.addEventListener('focus', validateLocalidad)
        localidad.addEventListener('input', validateLocalidad)
        localidad.addEventListener('change', validateLocalidadOnChange)
      }
      
      // Validación colonia
      if (colonia) {
        const validateColonia = () => {
          if (colonia.value == '') {
            errorColonia.style.display = 'block'
          } else {
            errorColonia.style.display = 'none'
          }
          enableSaveButton()
        }
        const validateColoniaOnChange = () => {
          // La primera letra de cada palabra será mayúscula
          colonia.value = colonia.value != '' ? firstLetterOfEachWordCapitalized(colonia.value) : ''
        }
        colonia.addEventListener('focus', validateColonia)
        colonia.addEventListener('input', validateColonia)
        colonia.addEventListener('change', validateColoniaOnChange)
      }
      
      // Validación calle
      if (calle) {
        const validateCalle = () => {
          if (calle.value == '') {
            errorCalle.style.display = 'block'
          } else {
            errorCalle.style.display = 'none'
          }
          enableSaveButton()
        }
        const validateCalleOnChange = () => {
          // La primera letra de cada palabra será mayúscula
          calle.value = calle.value != '' ? firstLetterOfEachWordCapitalized(calle.value) : ''
        }
        calle.addEventListener('focus', validateCalle)
        calle.addEventListener('input', validateCalle)
        calle.addEventListener('change', validateCalleOnChange)
      }
      
      // Validación numero exterior
      if (numeroExterior) {
        const validateNumeroExterior = () => {
          if (numeroExterior.value == '') {
            errorNumeroExterior.style.display = 'block'
          } else {
            errorNumeroExterior.style.display = 'none'
          }
          enableSaveButton()
        }
        numeroExterior.addEventListener('focus', validateNumeroExterior)
        numeroExterior.addEventListener('input', validateNumeroExterior)
      }
      
      // Validación banco
      if (banco) {
        const validateBanco = () => {
          if (banco.value == '') {
            errorBanco.style.display = 'block'
          } else {
            errorBanco.style.display = 'none'
          }
          enableSaveButton()
        }
        banco.addEventListener('focus', validateBanco)
        banco.addEventListener('change', validateBanco)
      }
      
      // Validación cuenta
      const validateCuenta = () => {
        // Si es extranjero, no se hace la validación
        if (moneda.value.toUpperCase() == 'USD') {
          return
        }
        if (cuentaPattern.test(cuenta.value)) {
          errorCuenta.style.display = 'none'
        } else {
          errorCuenta.style.display = 'block'
        }
        enableSaveButton()
      }
      if (cuenta) {
        cuenta.addEventListener('focus', validateCuenta)
        cuenta.addEventListener('input', validateCuenta)
      }
      
      // Validación moneda
      if (moneda) {
        const validateMoneda = () => {
          if (moneda.value == '') {
            errorMoneda.style.display = 'block'
          } else {
            errorMoneda.style.display = 'none'
            // La clabe interbancaria no es obligatoria para clientes y proveedores extranjeros
            if (moneda.value.toUpperCase() == 'USD') {
              cuenta.removeAttribute('required')
              errorCuenta.style.display = 'none'
              clabe.removeAttribute('required')
              errorClabe.style.display = 'none'
            }
            else {
              cuenta.setAttribute('required', true)
              clabe.setAttribute('required', true)
              setTimeout(() => {
                validateCuenta()
                validateClabe()
              }, 3000)
            }
          }
          enableSaveButton()
        }
        moneda.addEventListener('focus', validateMoneda)
        moneda.addEventListener('change', validateMoneda)
        validateMoneda()
      }
      
      // Validación clabe
      const validateClabe = () => {
        // Si es extranjero, no se hace la validación
        if (moneda.value.toUpperCase() == 'USD') {
          return
        }
        if (clabePattern.test(clabe.value)) {
          errorClabe.style.display = 'none'
        } else {
          errorClabe.style.display = 'block'
        }
        enableSaveButton()
      }
      if (clabe) {
        clabe.addEventListener('focus', validateClabe)
        clabe.addEventListener('input', validateClabe)
      }
      
      // Añadiendo un segundo banco
      if (btnAddBanco) {
        btnAddBanco.addEventListener('click', () => {
          banco2.value = ''
          cuenta2.value = ''
          moneda2.value = ''
          clabe2.value = ''
          
          if (btnAddBanco.textContent == 'Agregar otro banco') {
            banco2Container.style.display = 'block'
            banco2.setAttribute('required', true)
            cuenta2.setAttribute('required', true)
            moneda2.setAttribute('required', true)
            clabe2.setAttribute('required', true)
            
            btnAddBanco.textContent = 'Eliminar banco'
          }
          else {
            banco2Container.style.display = 'none'
            banco2.removeAttribute('required')
            cuenta2.removeAttribute('required')
            moneda2.removeAttribute('required')
            clabe2.removeAttribute('required')
            
            errorBanco2.style.display = 'none'
            errorCuenta2.style.display = 'none'
            errorMoneda2.style.display = 'none'
            errorClabe2.style.display = 'none'
            
            btnAddBanco.textContent = 'Agregar otro banco'
          }
        })
      }
      
      // Validación banco 2
      if (banco2) {
        const validateBanco2 = () => {
          if (banco2Container.style.display == 'none') {
            return
          }
          if (banco2.value == '') {
            errorBanco2.style.display = 'block'
          } else {
            errorBanco2.style.display = 'none'
          }
          enableSaveButton()
        }
        banco2.addEventListener('focus', validateBanco2)
        banco2.addEventListener('change', validateBanco2)
      }
      
      // Validación cuenta 2
      const validateCuenta2 = () => {
        if (banco2Container.style.display == 'none') {
          return
        }
        // Si es extranjero, no se hace la validación
        if (moneda2.value.toUpperCase() == 'USD') {
          return
        }
        if (cuentaPattern.test(cuenta2.value)) {
          errorCuenta2.style.display = 'none'
        } else {
          errorCuenta2.style.display = 'block'
        }
        enableSaveButton()
      }
      if (cuenta2) {
        cuenta2.addEventListener('focus', validateCuenta2)
        cuenta2.addEventListener('input', validateCuenta2)
      }
      
      // Validación moneda 2
      if (moneda2) {
        const validateMoneda2 = () => {
          if (banco2Container.style.display == 'none') {
            return
          }
          if (moneda2.style.display == 'block' && moneda2.value == '') {
            errorMoneda2.style.display = 'block'
          } else {
            errorMoneda2.style.display = 'none'
            // La clabe interbancaria no es obligatoria para clientes y proveedores extranjeros
            if (moneda2.value.toUpperCase() == 'USD') {
              cuenta2.removeAttribute('required')
              errorCuenta2.style.display = 'none'
              clabe2.removeAttribute('required')
              errorClabe2.style.display = 'none'
            }
            else {
              cuenta2.setAttribute('required', true)
              clabe2.setAttribute('required', true)
              setTimeout(() => {
                validateCuenta2()
                validateClabe2()
              }, 3000)
            }
          }
          enableSaveButton()
        }
        moneda2.addEventListener('focus', validateMoneda2)
        moneda2.addEventListener('change', validateMoneda2)
        validateMoneda2()
      }
      
      // Validación clabe 2
      const validateClabe2 = () => {
        if (banco2Container.style.display == 'none') {
          return
        }
        // Si es extranjero, no se hace la validación
        if (moneda2.value.toUpperCase() == 'USD') {
          return
        }
        if (clabePattern.test(clabe2.value)) {
          errorClabe2.style.display = 'none'
        } else {
          errorClabe2.style.display = 'block'
        }
        enableSaveButton()
      }
      if (clabe2) {
        clabe2.addEventListener('focus', validateClabe2)
        clabe2.addEventListener('input', validateClabe2)
      }

      if (btnDelete) {
        btnDelete.addEventListener('click', () => {
          makeFieldsOptional()
        })
      }

      const disableAllFields = input => {
        if (empresaOrigen) {
          empresaOrigen.setAttribute('disabled', true)
          empresaDestino.setAttribute('disabled', true)
          if (comentarios) {
            comentarios.setAttribute('disabled', true)
          }
        }
        else {
          empresa.setAttribute('disabled', true)
          contribuyente.setAttribute('disabled', true)
          if (input.name != 'rfc') {
            rfc.setAttribute('disabled', true)
          }
          if (input.name != 'curp') {
            curp.setAttribute('disabled', true)
          }
          regimenCapital.setAttribute('disabled', true)
          if (input.name != 'nombre_fiscal') {
            nombreFiscal.setAttribute('disabled', true)
          }
          if (input.name != 'nombre_comercial') {
            nombreComercial.setAttribute('disabled', true)
          }
          regimenFiscal.setAttribute('disabled', true)
          usoCfdi.setAttribute('disabled', true)
          representanteLegal.setAttribute('disabled', true)
          if (input.name != 'telefono_1') {
            telefono1.setAttribute('disabled', true)
          }
          if (input.name != 'telefono_2') {
            telefono2.setAttribute('disabled', true)
          }
          contacto.setAttribute('disabled', true)
          if (input.name != 'correo_general') {
            correoGeneral.setAttribute('disabled', true)
          }
          if (input.name != 'correo_pagos') {
            correoPagos.setAttribute('disabled', true)
          }
          sitioWeb.setAttribute('disabled', true)
          rubro.setAttribute('disabled', true)
          tipoOperacion.setAttribute('disabled', true)
          tipoTercero.setAttribute('disabled', true)
          idFiscal.setAttribute('disabled', true)
          agenteAduanal.setAttribute('disabled', true)
          if (fairTrade) {
            fairTrade.setAttribute('disabled', true)
          }
          diasCredito.setAttribute('disabled', true)
          montoCreditoMn.setAttribute('disabled', true)
          montoCreditoMe.setAttribute('disabled', true)
          retencionIva.setAttribute('disabled', true)
          retencionIsr.setAttribute('disabled', true)
          ivaFrontera.setAttribute('disabled', true)
          if (input.name != 'codigo_postal') {
            codigoPostal.setAttribute('disabled', true)
          }
          pais.setAttribute('disabled', true)
          estado.setAttribute('disabled', true)
          ciudad.setAttribute('disabled', true)
          municipio.setAttribute('disabled', true)
          localidad.setAttribute('disabled', true)
          colonia.setAttribute('disabled', true)
          calle.setAttribute('disabled', true)
          numeroExterior.setAttribute('disabled', true)
          numeroInterior.setAttribute('disabled', true)
          banco.setAttribute('disabled', true)
          cuenta.setAttribute('disabled', true)
          moneda.setAttribute('disabled', true)
          clabe.setAttribute('disabled', true)
          swift.setAttribute('disabled', true)
          otroCodigoBancario.setAttribute('disabled', true)
          btnAddBanco.setAttribute('disabled', true)
          banco2.setAttribute('disabled', true)
          cuenta2.setAttribute('disabled', true)
          moneda2.setAttribute('disabled', true)
          clabe2.setAttribute('disabled', true)
          swift2.setAttribute('disabled', true)
          otroCodigoBancario2.setAttribute('disabled', true)
          usarEnPortalProveedores.setAttribute('disabled', true)
          noAplicaParaRafaga.setAttribute('disabled', true)
          noRelacionarOc.setAttribute('disabled', true)
        }
        if (comentarios) {
          comentarios.setAttribute('disabled', true)
        }
        input.removeAttribute('disabled')
      }

      function enableAllFields() {
        if (empresaOrigen) {
          empresaOrigen.removeAttribute('disabled')
          empresaDestino.removeAttribute('disabled')
          if (comentarios) {
            comentarios.removeAttribute('disabled')
          }
        }
        else {
          empresa.removeAttribute('disabled')
          contribuyente.removeAttribute('disabled')
          rfc.removeAttribute('disabled')
          if (contribuyente.value == 'Persona física') {
            curp.removeAttribute('disabled')
          }
          if (contribuyente.value == 'Persona moral') {
            regimenCapital.removeAttribute('disabled')
          }
          nombreFiscal.removeAttribute('disabled')
          nombreComercial.removeAttribute('disabled')
          regimenFiscal.removeAttribute('disabled')
          usoCfdi.removeAttribute('disabled')
          representanteLegal.removeAttribute('disabled')
          telefono1.removeAttribute('disabled')
          telefono2.removeAttribute('disabled')
          contacto.removeAttribute('disabled')
          correoGeneral.removeAttribute('disabled')
          correoPagos.removeAttribute('disabled')
          sitioWeb.removeAttribute('disabled')
          rubro.removeAttribute('disabled')
          tipoOperacion.removeAttribute('disabled')
          tipoTercero.removeAttribute('disabled')
          idFiscal.removeAttribute('disabled')
          agenteAduanal.removeAttribute('disabled')
          if (fairTrade) {
            fairTrade.removeAttribute('disabled')
          }
          diasCredito.removeAttribute('disabled')
          montoCreditoMn.removeAttribute('disabled')
          montoCreditoMe.removeAttribute('disabled')
          retencionIva.removeAttribute('disabled')
          retencionIsr.removeAttribute('disabled')
          ivaFrontera.removeAttribute('disabled')
          codigoPostal.removeAttribute('disabled')
          pais.removeAttribute('disabled')
          estado.removeAttribute('disabled')
          ciudad.removeAttribute('disabled')
          municipio.removeAttribute('disabled')
          localidad.removeAttribute('disabled')
          colonia.removeAttribute('disabled')
          calle.removeAttribute('disabled')
          numeroExterior.removeAttribute('disabled')
          numeroInterior.removeAttribute('disabled')
          banco.removeAttribute('disabled')
          cuenta.removeAttribute('disabled')
          moneda.removeAttribute('disabled')
          clabe.removeAttribute('disabled')
          swift.removeAttribute('disabled')
          otroCodigoBancario.removeAttribute('disabled')
          btnAddBanco.removeAttribute('disabled')
          banco2.removeAttribute('disabled')
          cuenta2.removeAttribute('disabled')
          moneda2.removeAttribute('disabled')
          clabe2.removeAttribute('disabled')
          swift2.removeAttribute('disabled')
          otroCodigoBancario2.removeAttribute('disabled')
          usarEnPortalProveedores.removeAttribute('disabled')
          noAplicaParaRafaga.removeAttribute('disabled')
          noRelacionarOc.removeAttribute('disabled')
        }
        if (comentarios) {
          comentarios.removeAttribute('disabled')
        }
      }

      function enableSaveButton() {
        if(errorEmpresaOrigen) {
          if (errorEmpresaOrigen.style.display == 'block' || errorEmpresaDestino.style.display == 'block' || errorEmpresasMigracion.style.display == 'block' || errorRfcMigracion.style.display == 'block' || errorRfcMigracion2.style.display == 'block') {
            if(btnSave) {
              btnSave.setAttribute('disabled', true)
              btnDelete.setAttribute('disabled', true)
            }
            else {
              if (btnApprove) {
                btnApprove.setAttribute('disabled', true)
                btnDecline.setAttribute('disabled', true)
              }
            }
          }
          else {
            if(btnSave) {
              btnSave.removeAttribute('disabled')
              btnDelete.removeAttribute('disabled')
            }
            else {
              if (btnApprove) {
                if (btnApprove) {
                  btnApprove.removeAttribute('disabled')
                  btnDecline.removeAttribute('disabled')
                }
              }
            }
          }
        }
        else {
          if (errorEmpresa.style.display == 'block' || errorContribuyente.style.display == 'block' || errorRfc.style.display == 'block' || errorRfc2.style.display == 'block' || errorCurp.style.display == 'block' || errorRegimenCapital.style.display == 'block' || errorNombreFiscal.style.display == 'block' || errorNombreFiscal2.style.display == 'block' || errorNombreComercial.style.display == 'block' || errorNombreComercial2.style.display == 'block' || errorRegimenFiscal.style.display == 'block' || errorUsoCfdi.style.display == 'block' || errorRepresentanteLegal.style.display == 'block' || errorTelefono1.style.display == 'block' ||errorTelefono2.style.display == 'block' || errorContacto.style.display == 'block' || errorCorreoGeneral.style.display == 'block' || errorCorreoPagos.style.display == 'block' || errorSitioWeb.style.display == 'block' || errorRubro.style.display == 'block' || errorTipoOperacion.style.display == 'block' || errorIdFiscal.style.display == 'block' || errorAgenteAduanal.style.display == 'block' || errorDiasCredito.style.display == 'block' || errorMontoCreditoMn.style.display == 'block' || errorMontoCreditoMe.style.display == 'block' || errorRetencionIva.style.display == 'block' || errorRetencionIsr.style.display == 'block' || errorIvaFrontera.style.display == 'block' || errorCodigoPostal.style.display == 'block' || errorPais.style.display == 'block' || errorEstado.style.display == 'block' || errorCiudad.style.display == 'block' || errorMunicipio.style.display == 'block' || errorLocalidad.style.display == 'block' || errorColonia.style.display == 'block' || errorCalle.style.display == 'block' || errorNumeroExterior.style.display == 'block' || errorNumeroInterior.style.display == 'block' || errorBanco.style.display == 'block' || errorCuenta.style.display == 'block' || errorMoneda.style.display == 'block' || errorClabe.style.display == 'block' || errorBanco2.style.display == 'block' || errorCuenta2.style.display == 'block' || errorMoneda2.style.display == 'block' || errorClabe2.style.display == 'block') {
            //if (errorFairTrade && errorFairTrade.style.display == 'none') {
              if(btnSave) {
                btnSave.setAttribute('disabled', true)
                btnDelete.setAttribute('disabled', true)
              }
              else {
                if (btnApprove) {
                  btnApprove.setAttribute('disabled', true)
                  btnDecline.setAttribute('disabled', true)
                }
              }
            //}
          }
          else {
            if(btnSave) {
              btnSave.removeAttribute('disabled')
              btnDelete.removeAttribute('disabled')
            }
            else {
              if (btnApprove) {
                btnApprove.removeAttribute('disabled')
                btnDecline.removeAttribute('disabled')
              }
            }
          }
        }
      }
    })
  </script>
{% endblock %}
