{% extends 'base.html' %}

{% block content %}
  <main class="py-5 m-5">
    <div class="row mt-5 justify-content-center">
      <div style="max-width: 40rem;">
        <form class="card card-body" method="POST" style="background-color: rgb(255, 255, 255, 0.8);">
          <h1 class="mb-4">Detalle del proveedor</h1>

          {{ error }}

          {% csrf_token %}

          <div style="display: none;">
            {{ form.es_migracion.label_tag }}
            {{ form.es_migracion }}
            <p id="error-es-migracion" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Seleccione una opción válida</p>
          </div>

          {% if proveedor.es_migracion %}
            <!-- Proveedor migración fields -->
            <h2 style="margin-bottom: 2rem;">Migración - {{ proveedor.rfc_migracion }}</h2>

            <div id="proveedor-migracion-empresas" style="display: flex; gap: 1rem; margin-bottom: 1rem;">
              <!-- Empresa origen -->
              <div style="width: 100%;">
                <p class="m-0">{{ form.empresa_origen.label_tag }}<span style="color: rgb(192, 0, 0);">*</span></p>
                {{ form.empresa_origen }}
                <p id="error-empresa-origen" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Seleccione una opción válida</p>
              </div>

              <!-- Empresa destino -->
              <div style="width: 100%;">
                <p class="m-0">{{ form.empresa_destino.label_tag }}<span style="color: rgb(192, 0, 0);">*</span></p>
                {{ form.empresa_destino }}
                <p id="error-empresa-destino" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Seleccione una opción válida</p>
              </div>
            </div>

            <!-- RFC migracion field -->
            <div style="margin-bottom: 2rem;">
              <label for="id_rfc_migracion">RFC migración:<span style="color: rgb(192, 0, 0);">*</span></label>
              {{ form.rfc_migracion }}
              <p id="error-rfc-migracion" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Ingrese un RFC válido</p>
            </div>

          {% else %}

            <!-- Proveedor nuevo fields -->
            <h2 style="margin-bottom: 2rem;">{{ proveedor.nombre_comercial }}</h2>

            <!-- Empresa field -->
            <div style="margin-bottom:1rem;">
              <p class="m-0">{{ form.empresa.label_tag }}<span style="color: rgb(192, 0, 0);">*</span></p>
              {{ form.empresa }}
              <p id="error-empresa" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Seleccione una opción válida</p>
            </div>

            <div style="display: flex; gap: 1rem;">
              <!-- Tipo alta field -->
              <div style="width: 100%; margin-bottom:1rem;">
                <p class="m-0">{{ form.tipo_alta.label_tag }}<span style="color: rgb(192, 0, 0);">*</span></p>
                {{ form.tipo_alta }}
                <p id="error-tipo-alta" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Seleccione una opción válida</p>
              </div>

              <!-- Contribuyente field -->
              <div style="width: 100%; margin-bottom:1rem;">
                <p class="m-0">{{ form.contribuyente.label_tag }}<span style="color: rgb(192, 0, 0);">*</span></p>
                {{ form.contribuyente }}
                <p id="error-contribuyente" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Seleccione una opción válida</p>
              </div>
            </div>

            <div style="display: flex; gap: 1rem;">
              <!-- RFC field -->
              <div style="width: 100%; margin-bottom:1rem;">
                <label for="id_rfc">RFC:<span style="color: rgb(192, 0, 0);">*</span></label>
                {{ form.rfc }}
                <p id="error-rfc" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Ingrese un RFC válido</p>
              </div>

              <!-- CURP field -->
              <div style="width: 100%; margin-bottom:1rem;">
                <label for="id_curp">CURP:</label>
                {{ form.curp }}
                <p id="error-curp" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Ingrese una CURP válida</p>
              </div>
            </div>

            <!-- Nombre fiscal field -->
            <div style="margin-bottom:1rem;">
              <p class="m-0">{{ form.nombre_fiscal.label_tag }}<span style="color: rgb(192, 0, 0);">*</span></p>
              {{ form.nombre_fiscal }}
              <p id="error-nombre-fiscal" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Este campo es requerido</p>
            </div>

            <!-- Regimen de capital field -->
            <div style="margin-bottom:1rem;">
              <label for="id_regimen_capital">Régimen de capital:<span style="color: rgb(192, 0, 0);">*</span></label>
              {{ form.regimen_capital }}
              <p id="error-regimen-capital" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Seleccione una opción válida</p>
            </div>

            <!-- Nombre comercial field -->
            <div style="margin-bottom:1rem;">
              <p class="m-0">{{ form.nombre_comercial.label_tag }}<span style="color: rgb(192, 0, 0);">*</span></p>
              {{ form.nombre_comercial }}
              <p id="error-nombre-comercial" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Este campo es requerido</p>
            </div>

            <!-- Regimen fiscal field -->
            <div style="margin-bottom:1rem;">
              <label for="id_regimen_fiscal">Régimen fiscal:<span style="color: rgb(192, 0, 0);">*</span></label>
              {{ form.regimen_fiscal }}
              <p id="error-regimen-fiscal" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Seleccione una opción válida</p>
            </div>

            <!-- Uso cfdi field -->
            <div style="margin-bottom:1rem;">
              <label for="id_uso_cfdi">Uso CFDI:<span style="color: rgb(192, 0, 0);">*</span></label>
              {{ form.uso_cfdi }}
              <p id="error-uso-cfdi" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Seleccione una opción válida</p>
            </div>

            <div style="display: flex; gap: 1rem;">
              <!-- Telefono 1 field -->
              <div style="width: 100%; margin-bottom:1rem;">
                <label for="id_telefono_1">Teléfono 1:<span style="color: rgb(192, 0, 0);">*</span></label>
                {{ form.telefono_1 }}
                <p id="error-telefono-1" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Ingrese un número a 10 dígitos</p>
              </div>

              <!-- Telefono 2 field -->
              <div style="width: 100%; margin-bottom:1rem;">
                <label for="id_telefono_2">Teléfono 2:<span style="color: rgb(192, 0, 0);">*</span></label>
                {{ form.telefono_2 }}
                <p id="error-telefono-2" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Ingrese un número a 10 dígitos</p>
              </div>
            </div>

            <div style="display: flex; gap: 1rem;">
              <!-- Representante legal field -->
              <div style="width: 100%; margin-bottom:1rem;">
                {{ form.representante_legal.label_tag }}
                {{ form.representante_legal }}
                <p id="error-representante-legal" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Este campo es requerido</p>
              </div>

              <!-- Contacto field -->
              <div style="width: 100%; margin-bottom:1rem;">
                {{ form.contacto.label_tag }}
                {{ form.contacto }}
                <p id="error-contacto" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Este campo es requerido</p>
              </div>
            </div>

            <div style="display: flex; gap: 1rem;">
              <!-- Correo general field -->
              <div style="width: 100%; margin-bottom:1rem;">
                <p class="m-0">{{ form.correo_general.label_tag }}<span style="color: rgb(192, 0, 0);">*</span></p>
                {{ form.correo_general }}
                <p id="error-correo-general" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Ingrese un correo electrónico válido</p>
              </div>

              <!-- Correo pagos field -->
              <div style="width: 100%; margin-bottom:1rem;">
                <p class="m-0">{{ form.correo_pagos.label_tag }}<span style="color: rgb(192, 0, 0);">*</span></p>
                {{ form.correo_pagos }}
                <p id="error-correo-pagos" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Ingrese un correo electrónico válido</p>
              </div>
            </div>

            <div style="display: flex; gap: 1rem;">
              <!-- Sitio web field -->
              <div style="width: 100%; margin-bottom:1rem;">
                {{ form.sitio_web.label_tag }}
                {{ form.sitio_web }}
                <p id="error-sitio-web" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Este campo es requerido</p>
              </div>

              <!-- Rubro field -->
              <div style="width: 100%; margin-bottom:1rem;">
                <label for="id_rubro">Grupo / Rubro:<span style="color: rgb(192, 0, 0);">*</span></label>
                {{ form.rubro }}
                <p id="error-rubro" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Seleccione una opción válida</p>
              </div>
            </div>

            <div style="display: flex; gap: 1rem;">
              <!-- Tipo operacion field -->
              <div style="width: 100%; margin-bottom:1rem;">
                <label for="id_tipo_operacion">Tipo operación:<span style="color: rgb(192, 0, 0);">*</span></label>
                {{ form.tipo_operacion }}
                <p id="error-tipo-operacion" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Seleccione una opción válida</p>
              </div>

              <!-- Tipo tercero field -->
              <div style="width: 100%; margin-bottom:1rem;">
                <p class="m-0">{{ form.tipo_tercero.label_tag }}<span style="color: rgb(192, 0, 0);">*</span></p>
                {{ form.tipo_tercero }}
                <p id="error-tipo-tipo-tercero" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Seleccione una opción válida</p>
              </div>
            </div>

            <div style="display: flex; gap: 1rem;">
              <!-- id fiscal field -->
              <div style="width: 100%; margin-bottom:1rem;">
                <label for="id_id_fiscal">ID fiscal:</label>
                {{ form.id_fiscal }}
                <p id="error-id-fiscal" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Este campo es requerido</p>
              </div>

              <!-- Agente aduanal field -->
              <div style="width: 100%; margin-bottom:1rem;">
                <p class="m-0">{{ form.agente_aduanal.label_tag }}<span style="color: rgb(192, 0, 0);">*</span></p>
                {{ form.agente_aduanal }}
                <p id="error-agente-aduanal" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Seleccione una opción válida</p>
              </div>
            </div>

            <div style="display: flex; gap: 1rem;">
              <!-- Limite credito MN field -->
              <div style="width: 100%; margin-bottom:1rem;">
                <label for="id_limite_credito_MN">Límite crédito (MN):<span style="color: rgb(192, 0, 0);">*</span></label>
                {{ form.limite_credito_MN }}
                <p id="error-limite-credito-MN" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Este campo es requerido</p>
              </div>
              
              <!-- Limite credito ME field -->
              <div style="width: 100%; margin-bottom:1rem;">
                <label for="id_limite_credito_ME">Límite crédito (ME):<span style="color: rgb(192, 0, 0);">*</span></label>
                {{ form.limite_credito_ME }}
                <p id="error-limite-credito-ME" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Este campo es requerido</p>
              </div>
            </div>

            <div style="display: flex; gap: 1rem;">
              <!-- Dias credito field -->
              <div style="width: 100%; margin-bottom:1rem;">
                <label for="id_dias_credito">Días crédito:<span style="color: rgb(192, 0, 0);">*</span></label>
                {{ form.dias_credito }}
                <p id="error-dias-credito" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Este campo es requerido</p>
              </div>

              <!-- Monto credito field -->
              <div style="width: 100%; margin-bottom:1rem;">
                <label for="id_monto_credito">Monto crédito:<span style="color: rgb(192, 0, 0);">*</span></label>
                {{ form.monto_credito }}
                <p id="error-monto-credito" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Este campo es requerido</p>
              </div>
            </div>

            <div style="display: flex; gap: 1rem;">
              <!-- Retencion iva field -->
              <div style="width: 100%; margin-bottom:1rem;">
                <label for="id_retencion_iva">Retención IVA:<span style="color: rgb(192, 0, 0);">*</span></label>
                {{ form.retencion_iva }}
                <p id="error-retencion-iva" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Seleccione una opción válida</p>
              </div>

              <!-- Retencion isr field -->
              <div style="width: 100%; margin-bottom:1rem;">
                <label for="id_retencion_isr">Retención ISR:<span style="color: rgb(192, 0, 0);">*</span></label>
                {{ form.retencion_isr }}
                <p id="error-retencion-isr" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Seleccione una opción válida</p>
              </div>

              <!-- Iva frontera field -->
              <div style="width: 100%; margin-bottom:1rem;">
                <label for="id_iva_frontera">IVA frontera:<span style="color: rgb(192, 0, 0);">*</span></label>
                {{ form.iva_frontera }}
                <p id="error-iva-frontera" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Seleccione una opción válida</p>
              </div>
            </div>

            <div style="display: flex; gap: 1rem;">
              <!-- Codigo postal field -->
              <div style="width: 100%; margin-bottom:1rem;">
                <label for="id_codigo_postal">Código postal:<span style="color: rgb(192, 0, 0);">*</span></label>
                {{ form.codigo_postal }}
                <p id="error-codigo-postal" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Ingrese un código postal válido</p>
              </div>

              <!-- Pais field -->
              <div style="width: 100%; margin-bottom:1rem;">
                <label for="id_pais">País:<span style="color: rgb(192, 0, 0);">*</span></label>
                {{ form.pais }}
                <p id="error-pais" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Este campo es requerido</p>
              </div>
            </div>

            <div style="display: flex; gap: 1rem;">
              <!-- Estado field -->
              <div style="width: 100%; margin-bottom:1rem;">
                <p class="m-0">{{ form.estado.label_tag }}<span style="color: rgb(192, 0, 0);">*</span></p>
                {{ form.estado }}
                <p id="error-estado" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Este campo es requerido</p>
              </div>

              <!-- Ciudad field -->
              <div style="width: 100%; margin-bottom:1rem;">
                <p class="m-0">{{ form.ciudad.label_tag }}<span style="color: rgb(192, 0, 0);">*</span></p>
                {{ form.ciudad }}
                <p id="error-ciudad" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Este campo es requerido</p>
              </div>
            </div>

            <div style="display: flex; gap: 1rem;">
              <!-- Municipio field -->
              <div style="width: 100%; margin-bottom:1rem;">
                <p class="m-0">{{ form.municipio.label_tag }}<span style="color: rgb(192, 0, 0);">*</span></p>
                {{ form.municipio }}
                <p id="error-municipio" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Este campo es requerido</p>
              </div>

              <!-- Localidad field -->
              <div style="width: 100%; margin-bottom:1rem;">
                <p class="m-0">{{ form.localidad.label_tag }}<span style="color: rgb(192, 0, 0);">*</span></p>
                {{ form.localidad }}
                <p id="error-localidad" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Este campo es requerido</p>
              </div>
            </div>

            <!-- Colonia field -->
            <div style="margin-bottom:1rem;">
              <p class="m-0">{{ form.colonia.label_tag }}<span style="color: rgb(192, 0, 0);">*</span></p>
              {{ form.colonia }}
              <p id="error-colonia" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Este campo es requerido</p>
            </div>

            <!-- Calle field -->
            <div style="margin-bottom:1rem;">
              <p class="m-0">{{ form.calle.label_tag }}<span style="color: rgb(192, 0, 0);">*</span></p>
              {{ form.calle }}
              <p id="error-calle" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Este campo es requerido</p>
            </div>

            <div style="display: flex; gap: 1rem;">
              <!-- Numero exterior field -->
              <div style="width: 50%; margin-bottom:1rem;">
                <label for="id_numero_exterior">Número exterior:<span style="color: rgb(192, 0, 0);">*</span></label>
                {{ form.numero_exterior }}
                <p id="error-numero-exterior" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Este campo es requerido</p>
              </div>

              <!-- Numero interior field -->
              <div style="width: 50%; margin-bottom:1rem;">
                <label for="id_numero_interior">Número interior:</label>
                {{ form.numero_interior }}
                <p id="error-numero-interior" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Este campo es requerido</p>
              </div>
            </div>

            <!-- Banco field -->
            <div style="margin-bottom:1rem;">
              <p class="m-0">{{ form.banco.label_tag }}<span style="color: rgb(192, 0, 0);">*</span></p>
              {{ form.banco }}
              <p id="error-banco" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Seleccione una opción válida</p>
            </div>

            <div style="display: flex; gap: 1rem;">
              <!-- Cuenta field -->
              <div style="width: 40%; margin-bottom:1rem;">
                <p class="m-0">{{ form.cuenta.label_tag }}<span style="color: rgb(192, 0, 0);">*</span></p>
                {{ form.cuenta }}
                <p id="error-cuenta" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Ingrese un número de cuenta a 10 dígitos</p>
              </div>

              <!-- Clabe field -->
              <div style="width: 40%; margin-bottom:1rem;">
                <p class="m-0">{{ form.clabe.label_tag }}<span style="color: rgb(192, 0, 0);">*</span></p>
                {{ form.clabe }}
                <p id="error-clabe" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Ingrese un número de cuenta a 18 dígitos</p>
              </div>

              <!-- Moneda field -->
              <div style="width: 20%; margin-bottom:1rem;">
                <p class="m-0">{{ form.moneda.label_tag }}<span style="color: rgb(192, 0, 0);">*</span></p>
                {{ form.moneda }}
                <p id="error-moneda" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Seleccione una opción válida</p>
              </div>
            </div>

            <div style="display: flex; gap: 1rem;">
              <!-- Swift field -->
              <div style="width: 50%; margin-bottom:1rem;">
                {{ form.swift.label_tag }}
                {{ form.swift }}
                <p id="error-swift" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Este campo es requerido</p>
              </div>

              <!-- Otro codigo bancario field -->
              <div style="width: 50%; margin-bottom:1rem;">
                <label for="id_otro_codigo_bancario">Otro código bancario:</label>
                {{ form.otro_codigo_bancario }}
                <p id="error-otro-codigo-bancario" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Este campo es requerido</p>
              </div>
            </div>

            <!-- Container for banco 2 fields -->
            <div id="banco-2-container" style="display:none;">
              <hr />
              <!-- Banco 2 field -->
              <div style="margin-bottom:1rem;">
                <label for="id_banco_2">Banco:<span style="color: rgb(192, 0, 0);">*</span></label>
                {{ form.banco_2 }}
                <p id="error-banco-2" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Seleccione una opción válida</p>
              </div>

              <div style="display: flex; gap: 1rem;">
                <!-- Cuenta 2 field -->
                <div style="width: 40%; margin-bottom:1rem;">
                  <label for="id_cuenta_2">Cuenta:<span style="color: rgb(192, 0, 0);">*</span></label>
                  {{ form.cuenta_2 }}
                  <p id="error-cuenta-2" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Ingrese un número de cuenta a 10 dígitos</p>
                </div>

                <!-- Clabe 2 field -->
                <div style="width: 40%; margin-bottom:1rem;">
                  <label for="id_clabe_2">Clabe:<span style="color: rgb(192, 0, 0);">*</span></label>
                  {{ form.clabe_2 }}
                  <p id="error-clabe-2" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Ingrese un número de cuenta a 18 dígitos</p>
                </div>

                <!-- Moneda 2 field -->
                <div style="width: 20%; margin-bottom:1rem;">
                  <label for="id_moneda_2">Moneda:<span style="color: rgb(192, 0, 0);">*</span></label>
                  {{ form.moneda_2 }}
                  <p id="error-moneda-2" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Seleccione una opción válida</p>
                </div>
              </div>

              <div style="display: flex; gap: 1rem;">
                <!-- Swift 2 field -->
                <div style="width: 50%; margin-bottom:1rem;">
                  <label for="id_swift_2">Swift:</label>
                  {{ form.swift_2 }}
                  <p id="error-swift_2" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Este campo es requerido</p>
                </div>
  
                <!-- Otro codigo bancario 2 field -->
                <div style="width: 50%; margin-bottom:1rem;">
                  <label for="id_otro_codigo_bancario_2">Otro código bancario:</label>
                  {{ form.otro_codigo_bancario_2 }}
                  <p id="error-otro-codigo-bancario_2" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Este campo es requerido</p>
                </div>
              </div>
            </div>

            <button class="btn btn-secondary mb-3" type="button" id="add-banco-2">Agregar otro banco</button>

            <div style="display: flex; justify-content: space-between; gap: 2rem;">
              <!-- Usar en portal proveedores field -->
              <div style="margin-bottom:1rem;">
                {{ form.usar_en_portal_proveedores.label_tag }}
                {{ form.usar_en_portal_proveedores }}
                <p id="error-usar-en-portal-proveedores" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Seleccione una opción válida</p>
              </div>

              <!-- No aplica para rafaga field -->
              <div style="margin-bottom:1rem;">
                <label for="id_no_aplica_para_rafaga">No aplica para ráfaga:</label>
                {{ form.no_aplica_para_rafaga }}
                <p id="error-no-aplica-para-rafaga" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Seleccione una opción válida</p>
              </div>

              <!-- No relacionar OC field -->
              <div style="margin-bottom:1rem;">
                {{ form.no_relacionar_OC.label_tag }}
                {{ form.no_relacionar_OC }}
                <p id="error-no-relacionar-OC" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Seleccione una opción válida</p>
              </div>
            </div>

            <a href="/{{ proveedor.constancia_situacion_fiscal }}" class="d-inline-block my-2" style="width:fit-content;" download="">Descargar constancia de situación fiscal</a>
            <a href="/{{ proveedor.estado_cuenta_bancario }}" class="d-inline-block mt-2 mb-3" style="width:fit-content;" download="">Descargar estado de cuenta bancario</a>

          {% endif %}

          <!-- Comentarios field -->
          <div style="margin-bottom:1rem;">
            {{ form.comentarios.label_tag }}
            {{ form.comentarios }}
            <p id="error-comentarios" style="font-size: 0.9rem; color:red; margin-bottom:0; display:none;">Este campo es obligatorio</p>
          </div>

          <div id="buttons-container" class="d-flex justify-content-between gap-2">
            {% if proveedor.rechazado_compras == True or proveedor.rechazado_finanzas == True or proveedor.rechazado_sistemas == True or proveedor.borrador == True %}
              {% if proveedor.es_migracion %}
                <button id="btn-save" class="btn w-100 btn-save" style="margin-top: 0.5rem; background-color: #008841; color: white; font-weight: bold;" type="submit" name="finanzas" value="True">Enviar</button>
              {% else %}
                <button id="btn-save" class="btn w-100 btn-save" style="margin-top: 0.5rem; background-color: #008841; color: white; font-weight: bold;" type="submit" name="pendiente" value="True">Enviar</button>
              {% endif %}

              <button id="btn-delete" class="btn btn-delete w-100" style="margin-top: 0.5rem; background-color: tomato; color: white; font-weight: bold;" type="submit" name="eliminado" value="True">Eliminar solicitud</button>
            {% endif %}

            {% if current_user.compras == True %}
              <button id="btn-approve" class="btn btn-approve w-100" style="margin-top: 0.5rem; background-color: #008841; color: white; font-weight: bold;" type="submit" name="compras" value="True">Aprobar</button>
              <button id="btn-decline" class="btn btn-reject w-100" style="margin-top: 0.5rem; background-color: tomato; color: white; font-weight: bold;" type="submit" name="rechazado_compras" value="True">Rechazar</button>
            {% endif %}

            {% if current_user.finanzas == True %}
              <button id="btn-approve" class="btn btn-approve w-100" style="margin-top: 0.5rem; background-color: #008841; color: white; font-weight: bold;" type="submit" name="finanzas" value="True">Aprobar</button>
              <button id="btn-decline" class="btn btn-reject w-100" style="margin-top: 0.5rem; background-color: tomato; color: white; font-weight: bold;" type="submit" name="rechazado_finanzas" value="True">Rechazar</button>
            {% endif %}

            {% if current_user.sistemas == True %}
              <button id="btn-approve" class="btn btn-approve w-100" style="margin-top: 0.5rem; background-color: #008841; color: white; font-weight: bold;" type="submit" name="sistemas" value="True">Aprobar</button>
              <button id="btn-decline" class="btn btn-reject w-100" style="margin-top: 0.5rem; background-color: tomato; color: white; font-weight: bold;" type="submit" name="rechazado_sistemas" value="True">Rechazar</button>
            {% endif %}
          </div>
        </form>
      </div>
    </div>
  </main>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      // Containers
      const banco2Container = document.getElementById('banco-2-container')
      const buttonsContainer = document.getElementById('buttons-container')
      
      // Inputs
      const empresaOrigen = document.getElementById('id_empresa_origen')
      const empresaDestino = document.getElementById('id_empresa_destino')
      const rfcMigracion = document.getElementById('id_rfc_migracion')
      const empresa = document.getElementById('id_empresa')
      const tipoAlta = document.getElementById('id_tipo_alta')
      const contribuyente = document.getElementById('id_contribuyente')
      const rfc = document.getElementById('id_rfc')
      const curp = document.getElementById('id_curp')
      const regimenCapital = document.getElementById('id_regimen_capital')
      const nombreFiscal = document.getElementById('id_nombre_fiscal')
      const nombreComercial = document.getElementById('id_nombre_comercial')
      const regimenFiscal = document.getElementById('id_regimen_fiscal')
      const usoCfdi = document.getElementById('id_uso_cfdi')
      const representanteLegal = document.getElementById('id_representante_legal')
      const telefono1 = document.getElementById('id_telefono_1')
      const telefono2 = document.getElementById('id_telefono_2')
      const contacto = document.getElementById('id_contacto')
      const correoGeneral = document.getElementById('id_correo_general')
      const correoPagos = document.getElementById('id_correo_pagos')
      const sitioWeb = document.getElementById('id_sitio_web')
      const rubro = document.getElementById('id_rubro')
      const tipoOperacion = document.getElementById('id_tipo_operacion')
      const idFiscal = document.getElementById('id_id_fiscal')
      const agenteAduanal = document.getElementById('id_agente_aduanal')
      const limiteCreditoMN = document.getElementById('id_limite_credito_MN')
      const limiteCreditoME = document.getElementById('id_limite_credito_ME')
      const diasCredito = document.getElementById('id_dias_credito')
      const montoCredito = document.getElementById('id_monto_credito')
      const retencionIva = document.getElementById('id_retencion_iva')
      const retencionIsr = document.getElementById('id_retencion_isr')
      const ivaFrontera = document.getElementById('id_iva_frontera')
      const codigoPostal = document.getElementById('id_codigo_postal')
      const pais = document.getElementById('id_pais')
      const estado = document.getElementById('id_estado')
      const ciudad = document.getElementById('id_ciudad')
      const municipio = document.getElementById('id_municipio')
      const localidad = document.getElementById('id_localidad')
      const colonia = document.getElementById('id_colonia')
      const calle = document.getElementById('id_calle')
      const numeroExterior = document.getElementById('id_numero_exterior')
      const numeroInterior = document.getElementById('id_numero_interior')
      const banco = document.getElementById('id_banco')
      const cuenta = document.getElementById('id_cuenta')
      const moneda = document.getElementById('id_moneda')
      const clabe = document.getElementById('id_clabe')
      const banco2 = document.getElementById('id_banco_2')
      const cuenta2 = document.getElementById('id_cuenta_2')
      const moneda2 = document.getElementById('id_moneda_2')
      const clabe2 = document.getElementById('id_clabe_2')
      const usarEnPortalProveedores = document.getElementById('id_usar_en_portal_proveedores')
      const noAplicaParaRafaga = document.getElementById('id_no_aplica_para_rafaga')
      const noRelacionarOc = document.getElementById('id_no_relacionar_oc')
      const comentarios = document.getElementById('id_comentarios')
      
      // Buttons
      const addBanco = document.getElementById('add-banco-2')
      const btnSave = document.getElementById('btn-save')
      const btnDelete = document.getElementById('btn-delete')
      const btnApprove = document.getElementById('btn-approve')
      const btnDecline = document.getElementById('btn-decline')
      
      // Error messages
      const errorEmpresaOrigen = document.getElementById('error-empresa-origen')
      const errorEmpresaDestino = document.getElementById('error-empresa-destino')
      const errorRfcMigracion = document.getElementById('error-rfc-migracion')
      const errorEmpresa = document.getElementById('error-empresa')
      const errorTipoAlta = document.getElementById('error-tipo-alta')
      const errorContribuyente = document.getElementById('error-contribuyente')
      const errorRfc = document.getElementById('error-rfc')
      const errorCurp = document.getElementById('error-curp')
      const errorRegimenCapital = document.getElementById('error-regimen-capital')
      const errorNombreFiscal = document.getElementById('error-nombre-fiscal')
      const errorNombreComercial = document.getElementById('error-nombre-comercial')
      const errorRegimenFiscal = document.getElementById('error-regimen-fiscal')
      const errorUsoCfdi = document.getElementById('error-uso-cfdi')
      const errorRepresentanteLegal = document.getElementById('error-representante-legal')
      const errorTelefono1 = document.getElementById('error-telefono-1')
      const errorTelefono2 = document.getElementById('error-telefono-2')
      const errorContacto = document.getElementById('error-contacto')
      const errorCorreoGeneral = document.getElementById('error-correo-general')
      const errorCorreoPagos = document.getElementById('error-correo-pagos')
      const errorSitioWeb = document.getElementById('error-sitio-web')
      const errorRubro = document.getElementById('error-rubro')
      const errorTipoOperacion = document.getElementById('error-tipo-operacion')
      const errorIdFiscal = document.getElementById('error-id-fiscal')
      const errorAgenteAduanal = document.getElementById('error-agente-aduanal')
      const errorLimiteCreditoMN = document.getElementById('error-limite-credito-MN')
      const errorLimiteCreditoME = document.getElementById('error-limite-credito-ME')
      const errorDiasCredito = document.getElementById('error-dias-credito')
      const errorMontoCredito = document.getElementById('error-monto-credito')
      const errorRetencionIva = document.getElementById('error-retencion-iva')
      const errorRetencionIsr = document.getElementById('error-retencion-isr')
      const errorIvaFrontera = document.getElementById('error-iva-frontera')
      const errorCodigoPostal = document.getElementById('error-codigo-postal')
      const errorPais = document.getElementById('error-pais')
      const errorEstado = document.getElementById('error-estado')
      const errorCiudad = document.getElementById('error-ciudad')
      const errorMunicipio = document.getElementById('error-municipio')
      const errorLocalidad = document.getElementById('error-localidad')
      const errorColonia = document.getElementById('error-colonia')
      const errorCalle = document.getElementById('error-calle')
      const errorNumeroExterior = document.getElementById('error-numero-exterior')
      const errorNumeroInterior = document.getElementById('error-numero-interior')
      const errorBanco = document.getElementById('error-banco')
      const errorCuenta = document.getElementById('error-cuenta')
      const errorMoneda = document.getElementById('error-moneda')
      const errorClabe = document.getElementById('error-clabe')
      const errorBanco2 = document.getElementById('error-banco-2')
      const errorCuenta2 = document.getElementById('error-cuenta-2')
      const errorMoneda2 = document.getElementById('error-moneda-2')
      const errorClabe2 = document.getElementById('error-clabe-2')
      const errorUsarEnPortalProveedores = document.getElementById('error-usar-en-portal-proveedores')
      const errorNoAplicaParaRafaga = document.getElementById('error-no-aplica-para-rafaga')
      const errorNoRelacionarOc = document.getElementById('error-no-relacionar-OC')
      const errorComentarios = document.getElementById('error-comentarios')
      
      // Regular expressions
      const rfcPattern = /^[A-Za-z]{3,4}\d{6}[A-Za-z\d]{3}$/
      const curpPattern = /^[A-Za-z]{4}\d{6}[A-Za-z]{6}[A-Za-z\d]{2}$/
      const telefonoPattern = /^\d{10}$/
      const correoPattern = /^[A-Za-z\d._%+-]+@[A-Za-z\d.-]+\.[A-Za-z]{2,}$/
      const codigoPostalPattern = /^\d{5}$/
      const cuentaPattern = /^\d{10,20}$/
      const clabePattern = /^\d{18}$/
    
      buttonsContainer.addEventListener('click', function (event) {
        if (event.target && event.target.classList.contains('btn-save')) {
          comentarios.value = ''
        }
        if (event.target && event.target.classList.contains('btn-reject')) {
          comentarios.setAttribute('required', 'true')
          if(comentarios.value == '') {
            errorComentarios.style.display = 'block'
          }
        }
        if (event.target && event.target.classList.contains('btn-approve')) {
          comentarios.removeAttribute('required')
          comentarios.value = ''
        }
      })
    
      // Curp is mandatory only for personas físicas
      if (contribuyente) {
        if (contribuyente.value == 'Persona moral') {
          curp.required = false
          curp.disabled = true
        }
      }
    
      // If a second bank was added, display the "banco-2-container" element
      if (banco2) {
        if (banco2.value != '') {
          console.log(banco2.value)
          banco2Container.style.display = 'block'
          banco2.required = true
          cuenta2.required = true
          moneda2.required = true
          clabe2.required = true
          addBanco.textContent = 'Eliminar banco'
        }
      }

      const makeFieldsMandatory = () => {
        if (empresaOrigen) {
          empresaOrigen.setAttribute('required', true);
        }
        if (empresaDestino) {
          empresaDestino.setAttribute('required', true);
        }
        if (rfcMigracion) {
          rfcMigracion.setAttribute('required', true);
        }
        if (empresa) {
          empresa.setAttribute('required', true);
        }
        if (tipoAlta) {
          tipoAlta.setAttribute('required', true);
        }
        if (contribuyente) {
          contribuyente.setAttribute('required', true);
        }
        if (rfc) {
          rfc.setAttribute('required', true);
        }
        if (regimenCapital) {
          regimenCapital.setAttribute('required', true);
        }
        if (nombreFiscal) {
          nombreFiscal.setAttribute('required', true);
        }
        if (nombreComercial) {
          nombreComercial.setAttribute('required', true);
        }
        if (regimenFiscal) {
          regimenFiscal.setAttribute('required', true);
        }
        if (usoCfdi) {
          usoCfdi.setAttribute('required', true);
        }
        if (telefono1) {
          telefono1.setAttribute('required', true);
        }
        if (correoGeneral) {
          correoGeneral.setAttribute('required', true);
        }
        if (correoPagos) {
          correoPagos.setAttribute('required', true);
        }
        if (sitioWeb) {
          sitioWeb.setAttribute('required', true);
        }
        if (rubro) {
          rubro.setAttribute('required', true);
        }
        if (tipoOperacion) {
          tipoOperacion.setAttribute('required', true);
        }
        if (idFiscal) {
          idFiscal.setAttribute('required', true);
        }
        if (agenteAduanal) {
          agenteAduanal.setAttribute('required', true);
        }
        if (limiteCreditoMN) {
          limiteCreditoMN.setAttribute('required', true);
        }
        if (limiteCreditoME) {
          limiteCreditoME.setAttribute('required', true);
        }
        if (diasCredito) {
          diasCredito.setAttribute('required', true);
        }
        if (montoCredito) {
          montoCredito.setAttribute('required', true);
        }
        if (retencionIva) {
          retencionIva.setAttribute('required', true);
        }
        if (retencionIsr) {
          retencionIsr.setAttribute('required', true);
        }
        if (ivaFrontera) {
          ivaFrontera.setAttribute('required', true);
        }
        if (codigoPostal) {
          codigoPostal.setAttribute('required', true);
        }
        if (pais) {
          pais.setAttribute('required', true);
        }
        if (estado) {
          estado.setAttribute('required', true);
        }
        if (ciudad) {
          ciudad.setAttribute('required', true);
        }
        if (municipio) {
          municipio.setAttribute('required', true);
        }
        if (localidad) {
          localidad.setAttribute('required', true);
        }
        if (colonia) {
          colonia.setAttribute('required', true);
        }
        if (calle) {
          calle.setAttribute('required', true);
        }
        if (numeroExterior) {
          numeroExterior.setAttribute('required', true);
        }
        if (banco) {
          banco.setAttribute('required', true);
        }
        if (cuenta) {
          cuenta.setAttribute('required', true);
        }
        if (moneda) {
          moneda.setAttribute('required', true);
        }
        if (clabe) {
          clabe.setAttribute('required', true);
        }
      }

      makeFieldsMandatory()

      const makeFieldsOptional = () => {
        if (empresaOrigen) {
          empresaOrigen.removeAttribute('required');
        }
        if (empresaDestino) {
          empresaDestino.removeAttribute('required');
        }
        if (rfcMigracion) {
          rfcMigracion.removeAttribute('required');
        }
        if (empresa) {
          empresa.removeAttribute('required');
        }
        if (tipoAlta) {
          tipoAlta.removeAttribute('required');
        }
        if (contribuyente) {
          contribuyente.removeAttribute('required');
        }
        if (rfc) {
          rfc.removeAttribute('required');
        }
        if (regimenCapital) {
          regimenCapital.removeAttribute('required');
        }
        if (nombreFiscal) {
          nombreFiscal.removeAttribute('required');
        }
        if (nombreComercial) {
          nombreComercial.removeAttribute('required');
        }
        if (regimenFiscal) {
          regimenFiscal.removeAttribute('required');
        }
        if (usoCfdi) {
          usoCfdi.removeAttribute('required');
        }
        if (telefono1) {
          telefono1.removeAttribute('required');
        }
        if (correoGeneral) {
          correoGeneral.removeAttribute('required');
        }
        if (correoPagos) {
          correoPagos.removeAttribute('required');
        }
        if (sitioWeb) {
          sitioWeb.removeAttribute('required');
        }
        if (rubro) {
          rubro.removeAttribute('required');
        }
        if (tipoOperacion) {
          tipoOperacion.removeAttribute('required');
        }
        if (idFiscal) {
          idFiscal.removeAttribute('required');
        }
        if (agenteAduanal) {
          agenteAduanal.removeAttribute('required');
        }
        if (limiteCreditoMN) {
          limiteCreditoMN.removeAttribute('required');
        }
        if (limiteCreditoME) {
          limiteCreditoME.removeAttribute('required');
        }
        if (diasCredito) {
          diasCredito.removeAttribute('required');
        }
        if (montoCredito) {
          montoCredito.removeAttribute('required');
        }
        if (retencionIva) {
          retencionIva.removeAttribute('required');
        }
        if (retencionIsr) {
          retencionIsr.removeAttribute('required');
        }
        if (ivaFrontera) {
          ivaFrontera.removeAttribute('required');
        }
        if (codigoPostal) {
          codigoPostal.removeAttribute('required');
        }
        if (pais) {
          pais.removeAttribute('required');
        }
        if (estado) {
          estado.removeAttribute('required');
        }
        if (ciudad) {
          ciudad.removeAttribute('required');
        }
        if (municipio) {
          municipio.removeAttribute('required');
        }
        if (localidad) {
          localidad.removeAttribute('required');
        }
        if (colonia) {
          colonia.removeAttribute('required');
        }
        if (calle) {
          calle.removeAttribute('required');
        }
        if (numeroExterior) {
          numeroExterior.removeAttribute('required');
        }
        if (banco) {
          banco.removeAttribute('required');
        }
        if (cuenta) {
          cuenta.removeAttribute('required');
        }
        if (moneda) {
          moneda.removeAttribute('required');
        }
        if (clabe) {
          clabe.removeAttribute('required');
        }
      }

      // FIELD VALIDATION

      // Validacion empresa origen
      if (empresaOrigen) {
        empresaOrigen.addEventListener('change', () => {
          if (empresaOrigen.value == '') {
            errorEmpresaOrigen.style.display = 'block'
          } else {
            errorEmpresaOrigen.style.display = 'none'
          }
          enableSaveButton()
        })
      }
      
      // Validacion empresa destino
      if (empresaDestino) {
        empresaDestino.addEventListener('change', () => {
          if (empresaDestino.value == '') {
            errorEmpresaDestino.style.display = 'block'
          } else {
            errorEmpresaDestino.style.display = 'none'
          }
          enableSaveButton()
        })
      }
      
      // Validacion rfc migracion
      if (rfcMigracion) {
        rfcMigracion.addEventListener('input', () => {
          if (rfcPattern.test(rfcMigracion.value)) {
            errorRfcMigracion.style.display = 'none'
          } else {
            errorRfcMigracion.style.display = 'block'
          }
          enableSaveButton()
        })
      }
      
      // Validacion empresa
      if (empresa) {
        empresa.addEventListener('change', () => {
          if (empresa.value == '') {
            errorEmpresa.style.display = 'block'
          } else {
            errorEmpresa.style.display = 'none'
          }
          enableSaveButton()
        })
      }
      
      // Validacion tipo alta
      if (tipoAlta) {
        tipoAlta.addEventListener('change', () => {
          if (tipoAlta.value == '') {
            errorTipoAlta.style.display = 'block'
          } else {
            errorTipoAlta.style.display = 'none'
          }
          enableSaveButton()
        })
      }
      
      // Validacion contribuyente
      if (contribuyente) {
        contribuyente.addEventListener('change', () => {
          if (contribuyente.value == '') {
            errorContribuyente.style.display = 'block'
          } else {
            errorContribuyente.style.display = 'none'
            
            // Curp is mandatory only for personas físicas
            if (contribuyente.value == 'Persona física') {
              curp.setAttribute('required', true)
              curp.disabled = false
            }
            else {
              curp.removeAttribute('required')
              curp.disabled = true
              curp.value = ''
              errorCurp.style.display = 'none'
            }
          }
          enableSaveButton()
        })
      }
      
      // Validacion rfc
      if (rfc) {
        rfc.addEventListener('input', () => {
          if (rfcPattern.test(rfc.value)) {
            errorRfc.style.display = 'none'
          } else {
            errorRfc.style.display = 'block'
          }
          enableSaveButton()
        })
      }
      
      // Validacion curp
      if (curp) {
        curp.addEventListener('input', () => {
          if (curpPattern.test(curp.value)) {
            errorCurp.style.display = 'none'
          } else {
            errorCurp.style.display = 'block'
          }
          enableSaveButton()
        })
      }
        
      // Validacion regimen de capital
      if (regimenCapital) {
        regimenCapital.addEventListener('change', () => {
          if (regimenCapital.value == '') {
            errorRegimenCapital.style.display = 'block'
          } else {
            errorRegimenCapital.style.display = 'none'
          }
          enableSaveButton()
        })
      }
      
      // Validacion nombre fiscal
      if (nombreFiscal) {
        nombreFiscal.addEventListener('input', () => {
          if (nombreFiscal.value == '') {
            errorNombreFiscal.style.display = 'block'
          } else {
            errorNombreFiscal.style.display = 'none'
          }
          enableSaveButton()
        })
      }
      
      // Validacion nombre comercial
      if (nombreComercial) {
        nombreComercial.addEventListener('input', () => {
          if (nombreComercial.value == '') {
            errorNombreComercial.style.display = 'block'
          } else {
            errorNombreComercial.style.display = 'none'
          }
          enableSaveButton()
        })
      }
      
      // Validacion regimen fiscal
      if (regimenFiscal) {
        regimenFiscal.addEventListener('change', () => {
          if (regimenFiscal.value == '') {
            errorRegimenFiscal.style.display = 'block'
          } else {
            errorRegimenFiscal.style.display = 'none'
          }
          enableSaveButton()
        })
      }
      
      // Validacion uso cfdi
      if (usoCfdi) {
        usoCfdi.addEventListener('change', () => {
          if (usoCfdi.value == '') {
            errorUsoCfdi.style.display = 'block'
          } else {
            errorUsoCfdi.style.display = 'none'
          }
          enableSaveButton()
        })
      }
      
      // Validacion telefono 1
      if (telefono1) {
        telefono1.addEventListener('input', () => {
          if (telefonoPattern.test(telefono1.value)) {
            errorTelefono1.style.display = 'none'
          } else {
            errorTelefono1.style.display = 'block'
          }
          enableSaveButton()
        })
      }
      
      // Validacion telefono 2
      if (telefono2) {
        telefono2.addEventListener('input', () => {
          if (telefono2.value == '' || telefonoPattern.test(telefono2.value)) {
            errorTelefono2.style.display = 'none'
          } else {
            errorTelefono2.style.display = 'block'
          }
          enableSaveButton()
        })
      }
      
      // Validacion correo general
      if (correoGeneral) {
        correoGeneral.addEventListener('input', () => {
          if (correoPattern.test(correoGeneral.value)) {
            errorCorreoGeneral.style.display = 'none'
          } else {
            errorCorreoGeneral.style.display = 'block'
          }
          enableSaveButton()
        })
      }
      
      // Validacion correo pagos
      if (correoPagos) {
        correoPagos.addEventListener('input', () => {
          if (correoPattern.test(correoPagos.value)) {
            errorCorreoPagos.style.display = 'none'
          } else {
            errorCorreoPagos.style.display = 'block'
          }
          enableSaveButton()
        })
      }
      
      // Validacion rubro
      if (rubro) {
        rubro.addEventListener('change', () => {
          if (rubro.value == '') {
            errorRubro.style.display = 'block'
          } else {
            errorRubro.style.display = 'none'
          }
          enableSaveButton()
        })
      }
      
      // Validacion tipo operacion
      if (tipoOperacion) {
        tipoOperacion.addEventListener('change', () => {
          if (tipoOperacion.value == '') {
            errorTipoOperacion.style.display = 'block'
          } else {
            errorTipoOperacion.style.display = 'none'
          }
          enableSaveButton()
        })
      }
      
      // Validacion agente aduanal
      if (agenteAduanal) {
        agenteAduanal.addEventListener('change', () => {
          if (agenteAduanal.value == '') {
            errorAgenteAduanal.style.display = 'block'
          } else {
            errorAgenteAduanal.style.display = 'none'
          }
          enableSaveButton()
        })
      }
      
      // Validacion limite credito MN
      if (limiteCreditoMN) {
        limiteCreditoMN.addEventListener('input', () => {
          if (limiteCreditoMN.value == '') {
            errorLimiteCreditoMN.style.display = 'block'
          } else {
            errorLimiteCreditoMN.style.display = 'none'
          }
          enableSaveButton()
        })
      }
      
      // Validacion limite credito ME
      if (limiteCreditoME) {
        limiteCreditoME.addEventListener('input', () => {
          if (limiteCreditoME.value == '') {
            errorLimiteCreditoME.style.display = 'block'
          } else {
            errorLimiteCreditoME.style.display = 'none'
          }
          enableSaveButton()
        })
      }
      
      // Validacion dias credito
      if (diasCredito) {
        diasCredito.addEventListener('input', () => {
          if (diasCredito.value == '') {
            errorDiasCredito.style.display = 'block'
          } else {
            errorDiasCredito.style.display = 'none'
          }
          enableSaveButton()
        })
      }
      
      // Validacion monto credito
      if (montoCredito) {
        montoCredito.addEventListener('input', () => {
          if (montoCredito.value == '') {
            errorMontoCredito.style.display = 'block'
          } else {
            errorMontoCredito.style.display = 'none'
          }
          enableSaveButton()
        })
      }
      
      // Validacion retencion iva
      if (retencionIva) {
        retencionIva.addEventListener('change', () => {
          if (retencionIva.value == '') {
            errorRetencionIva.style.display = 'block'
          } else {
            errorRetencionIva.style.display = 'none'
          }
          enableSaveButton()
        })
      }
      
      // Validacion retencion isr
      if (retencionIsr) {
        retencionIsr.addEventListener('change', () => {
          if (retencionIsr.value == '') {
            errorRetencionIsr.style.display = 'block'
          } else {
            errorRetencionIsr.style.display = 'none'
          }
          enableSaveButton()
        })
      }
      
      // Validacion iva frontera
      if (ivaFrontera) {
        ivaFrontera.addEventListener('change', () => {
          if (ivaFrontera.value == '') {
            errorIvaFrontera.style.display = 'block'
          } else {
            errorIvaFrontera.style.display = 'none'
          }
          enableSaveButton()
        })
      }
      
      // Validacion codigo postal
      if (codigoPostal) {
        codigoPostal.addEventListener('input', () => {
          if (codigoPostalPattern.test(codigoPostal.value)) {
            errorCodigoPostal.style.display = 'none'
          } else {
            errorCodigoPostal.style.display = 'block'
          }
          enableSaveButton()
        })
      }
      
      // Validacion pais
      if (pais) {
        pais.addEventListener('input', () => {
          if (pais.value == '') {
            errorPais.style.display = 'block'
          } else {
            errorPais.style.display = 'none'
          }
          enableSaveButton()
        })
      }
      
      // Validacion estado
      if (estado) {
        estado.addEventListener('input', () => {
          if (estado.value == '') {
            errorEstado.style.display = 'block'
          } else {
            errorEstado.style.display = 'none'
          }
          enableSaveButton()
        })
      }
      
      // Validacion ciudad
      if (ciudad) {
        ciudad.addEventListener('input', () => {
          if (ciudad.value == '') {
            errorCiudad.style.display = 'block'
          } else {
            errorCiudad.style.display = 'none'
          }
          enableSaveButton()
        })
      }
      
      // Validacion municipio
      if (municipio) {
        municipio.addEventListener('input', () => {
          if (municipio.value == '') {
            errorMunicipio.style.display = 'block'
          } else {
            errorMunicipio.style.display = 'none'
          }
          enableSaveButton()
        })
      }
      
      // Validacion localidad
      if (localidad) {
        localidad.addEventListener('input', () => {
          if (localidad.value == '') {
            errorLocalidad.style.display = 'block'
          } else {
            errorLocalidad.style.display = 'none'
          }
          enableSaveButton()
        })
      }
      
      // Validacion colonia
      if (colonia) {
        colonia.addEventListener('input', () => {
          if (colonia.value == '') {
            errorColonia.style.display = 'block'
          } else {
            errorColonia.style.display = 'none'
          }
          enableSaveButton()
        })
      }
      
      // Validacion calle
      if (calle) {
        calle.addEventListener('input', () => {
          if (calle.value == '') {
            errorCalle.style.display = 'block'
          } else {
            errorCalle.style.display = 'none'
          }
          enableSaveButton()
        })
      }
      
      // Validacion numero exterior
      if (numeroExterior) {
        numeroExterior.addEventListener('input', () => {
          if (numeroExterior.value == '') {
            errorNumeroExterior.style.display = 'block'
          } else {
            errorNumeroExterior.style.display = 'none'
          }
          enableSaveButton()
        })
      }
      
      // Validacion banco
      if (banco) {
        banco.addEventListener('change', () => {
          if (banco.value == '') {
            errorBanco.style.display = 'block'
          } else {
            errorBanco.style.display = 'none'
          }
          enableSaveButton()
        })
      }
      
      // Validacion cuenta
      if (cuenta) {
        cuenta.addEventListener('input', () => {
          if (cuentaPattern.test(cuenta.value)) {
            errorCuenta.style.display = 'none'
          } else {
            errorCuenta.style.display = 'block'
          }
          enableSaveButton()
        })
      }
      
      // Validacion moneda
      if (moneda) {
        moneda.addEventListener('change', () => {
          if (moneda.value == '') {
            errorMoneda.style.display = 'block'
          } else {
            errorMoneda.style.display = 'none'
          }
          enableSaveButton()
        })
      }
      
      // Validacion clabe
      if (clabe) {
        clabe.addEventListener('input', () => {
          if (clabePattern.test(clabe.value)) {
            errorClabe.style.display = 'none'
          } else {
            errorClabe.style.display = 'block'
          }
          enableSaveButton()
        })
      }
      
      // Añadiendo un segundo banco
      if (addBanco) {
        addBanco.addEventListener('click', () => {
          banco2.selectedIndex = 0
          cuenta2.value = ''
          moneda2.selectedIndex = 0
          clabe2.value = ''
          
          if (addBanco.textContent == 'Agregar otro banco') {
            errorBanco2.style.display = 'none'
            errorCuenta2.style.display = 'none'
            errorMoneda2.style.display = 'none'
            errorClabe2.style.display = 'none'
            banco2Container.style.display = 'block'
            
            banco2.required = true
            cuenta2.required = true
            moneda2.required = true
            clabe2.required = true
            
            addBanco.textContent = 'Eliminar banco'
          } else {
            banco2Container.style.display = 'none'
            
            banco2.required = false
            cuenta2.required = false
            moneda2.required = false
            clabe2.required = false
            
            addBanco.textContent = 'Agregar otro banco'
          }
        })
      }
      
      // Validacion banco 2
      if (banco2) {
        banco2.addEventListener('change', () => {
          if (banco2.value == '') {
            errorBanco2.style.display = 'block'
          } else {
            errorBanco2.style.display = 'none'
          }
          enableSaveButton()
        })
      }
      
      // Validacion cuenta 2
      if (cuenta2) {
        cuenta2.addEventListener('input', () => {
          if (cuentaPattern.test(cuenta2.value)) {
            errorCuenta2.style.display = 'none'
          } else {
            errorCuenta2.style.display = 'block'
          }
          enableSaveButton()
        })
      }
      
      // Validacion moneda 2
      if (moneda2) {
        moneda2.addEventListener('change', () => {
          if (moneda2.value == '') {
            errorMoneda2.style.display = 'block'
          } else {
            errorMoneda2.style.display = 'none'
          }
          enableSaveButton()
        })
      }
      
      // Validacion clabe 2
      if (clabe2) {
        clabe2.addEventListener('input', () => {
          if (clabePattern.test(clabe2.value)) {
            errorClabe2.style.display = 'none'
          } else {
            errorClabe2.style.display = 'block'
          }
          enableSaveButton()
        })
      }

      if (btnDelete) {
        btnDelete.addEventListener('click', () => {
          makeFieldsOptional()
        })
      }

      function enableSaveButton() {
        if(errorEmpresa.style.display == 'block' || errorTipoAlta.style.display == 'block' || errorContribuyente.style.display == 'block' || errorRfc.style.display == 'block' || errorCurp.style.display == 'block' || errorRegimenCapital.style.display == 'block' || errorNombreFiscal.style.display == 'block' || errorNombreComercial.style.display == 'block' || errorRegimenFiscal.style.display == 'block' || errorUsoCfdi.style.display == 'block' || errorRepresentanteLegal.style.display == 'block' || errorTelefono1.style.display == 'block' ||errorTelefono2.style.display == 'block' || errorContacto.style.display == 'block' || errorCorreoGeneral.style.display == 'block' || errorCorreoPagos.style.display == 'block' || errorSitioWeb.style.display == 'block' || errorRubro.style.display == 'block' || errorTipoOperacion.style.display == 'block' || errorIdFiscal.style.display == 'block' || errorAgenteAduanal.style.display == 'block' || errorLimiteCreditoMN.style.display == 'block' || errorLimiteCreditoME.style.display == 'block' || errorDiasCredito.style.display == 'block' || errorMontoCredito.style.display == 'block' || errorRetencionIva.style.display == 'block' || errorRetencionIsr.style.display == 'block' || errorIvaFrontera.style.display == 'block' || errorCodigoPostal.style.display == 'block' || errorPais.style.display == 'block' || errorEstado.style.display == 'block' || errorCiudad.style.display == 'block' || errorMunicipio.style.display == 'block' || errorLocalidad.style.display == 'block' || errorColonia.style.display == 'block' || errorCalle.style.display == 'block' || errorNumeroExterior.style.display == 'block' || errorNumeroInterior.style.display == 'block' || errorBanco.style.display == 'block' || errorCuenta.style.display == 'block' || errorMoneda.style.display == 'block' || errorClabe.style.display == 'block' || errorBanco2.style.display == 'block' || errorCuenta2.style.display == 'block' || errorMoneda2.style.display == 'block' || errorClabe2.style.display == 'block') {
          if(btnSave) {
            btnSave.disabled = true
            btnDelete.disabled = true
          }
          else {
            btnApprove.disabled = true
            btnDecline.disabled = true
          }
        }
        else {
          if(btnSave) {
            btnSave.disabled = false
            btnDelete.disabled = false
          }
          else {
            btnApprove.disabled = false
            btnDecline.disabled = false
          }
        }
      }
    })
  </script>
{% endblock %}
